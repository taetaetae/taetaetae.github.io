<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>공모주 알리미 개발 후기 - 2부 - 👨‍💻꿈꾸는 태태태의 공간</title><meta name=Description content><meta property="og:title" content="공모주 알리미 개발 후기 - 2부"><meta property="og:description" content="﻿혹시 이 포스트를 처음 읽는 독자라면 지난 포스팅을 읽고 오는 것을 추천한다. 정리하자면, 지난 포스트에서는 토이 프로젝트를 시작하게 된 계기와, 어떤 식으로 만들지에 대한 설계. 그리고 데이터를 수집하는 과정에 대해 이야기했었다. 지난 포스팅에서 수집한 데이터를 이제 사용자들에게 알려주는 부분에 대해 정리하고자 한다.
 1부 : 프로젝트 설계, 데이터 수집 2부 : 수집한 데이터 알림 발송 3부 : 서버 선정 및 릴리즈  데이터 정의 　﻿java 라이브러리 중에 jsoup라는 것을 사용하여 웹사이트를 크롤링 하였고, 필요한 데이터를 파싱을 하였다. 아래는 &lsquo;공모주&rsquo;라는 자바 모델을 정의해 보았다. 이렇게 자바 &lsquo;모델&rsquo;로 정의를 하는 이유는 필요한 데이터가 무엇인지 다시 한번 정리를 하기 위함이기도 하고 map 같은 형태의 임시 변수(?)보다 더 직관적이기에 이후 코드를 작성하는데 가이드 역할의 효과도 얻을 수 있을 것 같았기 때문이다.
public class PublicOffering { private String name; // 종목명  private LocalDate startDate; // 일정 시작일  private LocalDate endDate; // 일정 마감일  private LocalDate listingDate; // 상장일  private String publicOfferingPrice; // 확정 공모가  private String expectedOfferingPrice; // 희망 공모가  private List<String> Underwriter; // 주간사  private String detailUrl; // 상세URL  private String competitionRate; // 청약경쟁률 } 　﻿초기에는 위에서 정의한 모델처럼 공모주의 기본 정보만을 서비스해야겠다 생각했고, 관련 뉴스라든지 기타 추가적인 정보나 다른 분들의 요구 사항(?)들이 추가될 경우 점진적으로 설계를 하고서 확장시켜 나가는 방향으로 계획했다. 우선은 기능들이 부족하더라고 돌아가는 서비스를 만들고 싶었기에.
애자일 방법론! 출처 : https://m.blog.naver.com/keycosmos3/221267522930&#34; 애자일 방법론!
출처 : https://m.blog.naver.com/keycosmos3/221267522930  텔레그램 봇/채널 생성 　﻿텔레그램 봇을 만드는 과정은 가볍게 검색을 해보면 너무나 쉽게 찾을 수 있지만, 보다 하나의 글 안에 모든 내용을 담고 싶어 텔레그램 봇을 만들고 → 텔레그램 채널을 만든 다음 → 텔레그램 봇을 이용해서 텔레그램 채널에 메시지를 보내는 걸 이야기해 보고자 한다.
 ﻿아, 여기서 왜 꼭 &lsquo;텔레그램&rsquo;을 선택했는가에 대한 이유는 개인적으로 다른 메신저 (카카오톡, 라인 등)보다도 api를 활용하여 메시지를 보내는 과정이 단순하면서도 빠르고 쉽게 느껴졌기 때문이다. 혹시 텔레그램 이 아닌 다른 메신저로 보내달라는 요청이 있을 경우 그때 가서 고민해 보려 한다.
  텔레그램 봇 생성  　﻿먼저 텔레그램 메신저에서 &lsquo;BotFather&rsquo;라는 사용자를 찾고 &lsquo;/start&rsquo;를 누르면 아래와 같이 사용할 수 있는 명령어가 나온다.
　﻿그다음 우리는 봇을 만들 것이기 때문에 &lsquo;/newbot&rsquo;을 누르고 봇의 이름을 작성하고 그 봇의 사용자 이름을 지정한다. &lsquo;_bot&rsquo;으로 끝나야 한다고 하기에 이름 뒤에 붙여서 만들면 그걸로 끝. 다음으로 친절하게 HTTP API를 사용할 수 있는 토큰이 발급되는데 이 토큰으로 봇을 컨트롤 가능하기 때문에 잘 간직하고(?) 있어야 한다.
친절한 봇 아버지&#34; 친절한 봇 아버지  　﻿이후 해당 토큰을 이용해서 봇의 상태를 확인해보자. 아래의 url에 토큰 경로만 변경하여 입력하면 json 응답을 받을 수 있다.
https://api.telegram.org/bot{token}/getUpdates e.g. https://api.telegram.org/bot17...42:AAH...cQU/getUpdates  텔레그램 채널 생성  　﻿1:N으로 채널에 가입한 사람들에게 메시지를 일방적으로 보내야 하기 때문에 사용할 채널을 만들어 보자. 텔레그램 UI만 봐도 간단하게 생성하기 쉽게 되어있다. 더불어 이 채널에 메시지를 보내야 하기 때문에 위에서 만들었던 봇을 추가하고 관리자로 승격 시키자.
채널 생성 > 봇을 관리자로&#34; 채널 생성 > 봇을 관리자로   ﻿텔레그램 봇으로 텔레그램 채널에 메시지 보내기  　이 부분에서 약간 헤맸는데 결국 위에서 얻은 토큰과 채널의 특정 id를 알아야 메시지를 보낼 수 있다. 앞서 만들었던 채널에 아무 메시지나 작성을 하고 위에서 호출했던 &lsquo;getUpdates&rsquo; api를 다시 호출해보면 아래처럼 채널의 id를 구할 수 있게 된다."><meta property="og:type" content="article"><meta property="og:url" content="https://taetaetae.github.io/posts/public-offering-notice-2/"><meta property="og:image" content="https://taetaetae.github.io/images/public-offering-notice-2/logo.jpg"><meta property="article:published_time" content="2021-03-28T11:41:33+09:00"><meta property="article:modified_time" content="2021-03-28T11:41:33+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/public-offering-notice-2/logo.jpg"><meta name=twitter:title content="공모주 알리미 개발 후기 - 2부"><meta name=twitter:description content="﻿혹시 이 포스트를 처음 읽는 독자라면 지난 포스팅을 읽고 오는 것을 추천한다. 정리하자면, 지난 포스트에서는 토이 프로젝트를 시작하게 된 계기와, 어떤 식으로 만들지에 대한 설계. 그리고 데이터를 수집하는 과정에 대해 이야기했었다. 지난 포스팅에서 수집한 데이터를 이제 사용자들에게 알려주는 부분에 대해 정리하고자 한다.
 1부 : 프로젝트 설계, 데이터 수집 2부 : 수집한 데이터 알림 발송 3부 : 서버 선정 및 릴리즈  데이터 정의 　﻿java 라이브러리 중에 jsoup라는 것을 사용하여 웹사이트를 크롤링 하였고, 필요한 데이터를 파싱을 하였다. 아래는 &lsquo;공모주&rsquo;라는 자바 모델을 정의해 보았다. 이렇게 자바 &lsquo;모델&rsquo;로 정의를 하는 이유는 필요한 데이터가 무엇인지 다시 한번 정리를 하기 위함이기도 하고 map 같은 형태의 임시 변수(?)보다 더 직관적이기에 이후 코드를 작성하는데 가이드 역할의 효과도 얻을 수 있을 것 같았기 때문이다.
public class PublicOffering { private String name; // 종목명  private LocalDate startDate; // 일정 시작일  private LocalDate endDate; // 일정 마감일  private LocalDate listingDate; // 상장일  private String publicOfferingPrice; // 확정 공모가  private String expectedOfferingPrice; // 희망 공모가  private List<String> Underwriter; // 주간사  private String detailUrl; // 상세URL  private String competitionRate; // 청약경쟁률 } 　﻿초기에는 위에서 정의한 모델처럼 공모주의 기본 정보만을 서비스해야겠다 생각했고, 관련 뉴스라든지 기타 추가적인 정보나 다른 분들의 요구 사항(?)들이 추가될 경우 점진적으로 설계를 하고서 확장시켜 나가는 방향으로 계획했다. 우선은 기능들이 부족하더라고 돌아가는 서비스를 만들고 싶었기에.
애자일 방법론! 출처 : https://m.blog.naver.com/keycosmos3/221267522930&#34; 애자일 방법론!
출처 : https://m.blog.naver.com/keycosmos3/221267522930  텔레그램 봇/채널 생성 　﻿텔레그램 봇을 만드는 과정은 가볍게 검색을 해보면 너무나 쉽게 찾을 수 있지만, 보다 하나의 글 안에 모든 내용을 담고 싶어 텔레그램 봇을 만들고 → 텔레그램 채널을 만든 다음 → 텔레그램 봇을 이용해서 텔레그램 채널에 메시지를 보내는 걸 이야기해 보고자 한다.
 ﻿아, 여기서 왜 꼭 &lsquo;텔레그램&rsquo;을 선택했는가에 대한 이유는 개인적으로 다른 메신저 (카카오톡, 라인 등)보다도 api를 활용하여 메시지를 보내는 과정이 단순하면서도 빠르고 쉽게 느껴졌기 때문이다. 혹시 텔레그램 이 아닌 다른 메신저로 보내달라는 요청이 있을 경우 그때 가서 고민해 보려 한다.
  텔레그램 봇 생성  　﻿먼저 텔레그램 메신저에서 &lsquo;BotFather&rsquo;라는 사용자를 찾고 &lsquo;/start&rsquo;를 누르면 아래와 같이 사용할 수 있는 명령어가 나온다.
　﻿그다음 우리는 봇을 만들 것이기 때문에 &lsquo;/newbot&rsquo;을 누르고 봇의 이름을 작성하고 그 봇의 사용자 이름을 지정한다. &lsquo;_bot&rsquo;으로 끝나야 한다고 하기에 이름 뒤에 붙여서 만들면 그걸로 끝. 다음으로 친절하게 HTTP API를 사용할 수 있는 토큰이 발급되는데 이 토큰으로 봇을 컨트롤 가능하기 때문에 잘 간직하고(?) 있어야 한다.
친절한 봇 아버지&#34; 친절한 봇 아버지  　﻿이후 해당 토큰을 이용해서 봇의 상태를 확인해보자. 아래의 url에 토큰 경로만 변경하여 입력하면 json 응답을 받을 수 있다.
https://api.telegram.org/bot{token}/getUpdates e.g. https://api.telegram.org/bot17...42:AAH...cQU/getUpdates  텔레그램 채널 생성  　﻿1:N으로 채널에 가입한 사람들에게 메시지를 일방적으로 보내야 하기 때문에 사용할 채널을 만들어 보자. 텔레그램 UI만 봐도 간단하게 생성하기 쉽게 되어있다. 더불어 이 채널에 메시지를 보내야 하기 때문에 위에서 만들었던 봇을 추가하고 관리자로 승격 시키자.
채널 생성 > 봇을 관리자로&#34; 채널 생성 > 봇을 관리자로   ﻿텔레그램 봇으로 텔레그램 채널에 메시지 보내기  　이 부분에서 약간 헤맸는데 결국 위에서 얻은 토큰과 채널의 특정 id를 알아야 메시지를 보낼 수 있다. 앞서 만들었던 채널에 아무 메시지나 작성을 하고 위에서 호출했던 &lsquo;getUpdates&rsquo; api를 다시 호출해보면 아래처럼 채널의 id를 구할 수 있게 된다."><meta name=application-name content="👨‍💻꿈꾸는 태태태의 공간"><meta name=apple-mobile-web-app-title content="👨‍💻꿈꾸는 태태태의 공간"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/posts/public-offering-notice-2/><link rel=prev href=https://taetaetae.github.io/posts/public-offering-notice-1/><link rel=next href=https://taetaetae.github.io/posts/public-offering-notice-3/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"공모주 알리미 개발 후기 - 2부","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/posts\/public-offering-notice-2\/"},"genre":"posts","keywords":"public-offering-notice, telegram, bitly, archives-2021","wordcount":844,"url":"https:\/\/taetaetae.github.io\/posts\/public-offering-notice-2\/","datePublished":"2021-03-28T11:41:33+09:00","dateModified":"2021-03-28T11:41:33+09:00","publisher":{"@type":"Organization","name":"태태태"},"author":{"@type":"Person","name":"태태태"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:260px;height:600px data-ad-client=ca-pub-5788330009690816 data-ad-slot=2248955907></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><article class="page single"><h1 class="single-title animated flipInX">공모주 알리미 개발 후기 - 2부</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>태태태</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-03-28>2021-03-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;844 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/logo.jpg data-srcset="/images/public-offering-notice-2/logo.jpg, /images/public-offering-notice-2/logo.jpg 1.5x, /images/public-offering-notice-2/logo.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/logo.jpg title=/images/public-offering-notice-2/logo.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#데이터-정의>데이터 정의</a></li><li><a href=#텔레그램-봇채널-생성>텔레그램 봇/채널 생성</a></li><li><a href=#url-인코딩-이슈--bitly-로-활용>URL 인코딩 이슈 > bitly 로 활용</a></li><li><a href=#마치며>마치며</a></li></ul></nav></div></div><div class=content id=content><p>　﻿혹시 이 포스트를 처음 읽는 독자라면 <a href=/posts/public-offering-notice-1 rel>지난 포스팅</a>을 읽고 오는 것을 추천한다. 정리하자면, 지난 포스트에서는 <a href=https://t.me/PublicOfferingNotice target=_blank rel="noopener noreffer">토이 프로젝트</a>를 시작하게 된 계기와, 어떤 식으로 만들지에 대한 설계. 그리고 데이터를 수집하는 과정에 대해 이야기했었다. 지난 포스팅에서 수집한 데이터를 이제 사용자들에게 알려주는 부분에 대해 정리하고자 한다.</p><ul><li>1부 : <a href=/posts/public-offering-notice-1 rel>프로젝트 설계, 데이터 수집</a></li><li>2부 : <a href=/posts/public-offering-notice-2 rel>수집한 데이터 알림 발송</a></li><li>3부 : <a href=/posts/public-offering-notice-3 rel>서버 선정 및 릴리즈</a></li></ul><h2 id=데이터-정의>데이터 정의</h2><p>　﻿java 라이브러리 중에 jsoup라는 것을 사용하여 웹사이트를 크롤링 하였고, 필요한 데이터를 파싱을 하였다. 아래는 &lsquo;공모주&rsquo;라는 자바 모델을 정의해 보았다. 이렇게 자바 &lsquo;모델&rsquo;로 정의를 하는 이유는 필요한 데이터가 무엇인지 다시 한번 정리를 하기 위함이기도 하고 map 같은 형태의 임시 변수(?)보다 더 직관적이기에 이후 코드를 작성하는데 가이드 역할의 효과도 얻을 수 있을 것 같았기 때문이다.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PublicOffering</span> <span class=o>{</span>

  <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span> <span class=c1>// 종목명
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>LocalDate</span> <span class=n>startDate</span><span class=o>;</span> <span class=c1>// 일정 시작일
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>LocalDate</span> <span class=n>endDate</span><span class=o>;</span> <span class=c1>// 일정 마감일
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>LocalDate</span> <span class=n>listingDate</span><span class=o>;</span> <span class=c1>// 상장일
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>String</span> <span class=n>publicOfferingPrice</span><span class=o>;</span> <span class=c1>// 확정 공모가
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>String</span> <span class=n>expectedOfferingPrice</span><span class=o>;</span> <span class=c1>// 희망 공모가
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>Underwriter</span><span class=o>;</span> <span class=c1>// 주간사
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>String</span> <span class=n>detailUrl</span><span class=o>;</span> <span class=c1>// 상세URL
</span><span class=c1></span>  <span class=kd>private</span> <span class=n>String</span> <span class=n>competitionRate</span><span class=o>;</span> <span class=c1>// 청약경쟁률
</span><span class=c1></span><span class=o>}</span>
</code></pre></div><p>　﻿초기에는 위에서 정의한 모델처럼 공모주의 기본 정보만을 서비스해야겠다 생각했고, 관련 뉴스라든지 기타 추가적인 정보나 다른 분들의 요구 사항(?)들이 추가될 경우 점진적으로 설계를 하고서 확장시켜 나가는 방향으로 계획했다. 우선은 기능들이 부족하더라고 돌아가는 서비스를 만들고 싶었기에.</p><figure><a class=lightgallery href=/images/public-offering-notice-2/agile.png title=/images/public-offering-notice-2/agile.png data-thumbnail=/images/public-offering-notice-2/agile.png data-sub-html="<h2>애자일 방법론! 출처 : https://m.blog.naver.com/keycosmos3/221267522930</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/agile.png data-srcset="/images/public-offering-notice-2/agile.png, /images/public-offering-notice-2/agile.png 1.5x, /images/public-offering-notice-2/agile.png 2x" data-sizes=auto alt=/images/public-offering-notice-2/agile.png></a><figcaption class=image-caption>애자일 방법론!<br>출처 : <a href=https://m.blog.naver.com/keycosmos3/221267522930>https://m.blog.naver.com/keycosmos3/221267522930</a></figcaption></figure><h2 id=텔레그램-봇채널-생성>텔레그램 봇/채널 생성</h2><p>　﻿텔레그램 봇을 만드는 과정은 가볍게 검색을 해보면 너무나 쉽게 찾을 수 있지만, 보다 하나의 글 안에 모든 내용을 담고 싶어 텔레그램 봇을 만들고 → 텔레그램 채널을 만든 다음 → 텔레그램 봇을 이용해서 텔레그램 채널에 메시지를 보내는 걸 이야기해 보고자 한다.</p><blockquote><p>﻿아, 여기서 왜 꼭 &lsquo;텔레그램&rsquo;을 선택했는가에 대한 이유는 개인적으로 다른 메신저 (카카오톡, 라인 등)보다도 api를 활용하여 메시지를 보내는 과정이 단순하면서도 빠르고 쉽게 느껴졌기 때문이다. 혹시 텔레그램 이 아닌 다른 메신저로 보내달라는 요청이 있을 경우 그때 가서 고민해 보려 한다.</p></blockquote><ul><li>텔레그램 봇 생성</li></ul><p>　﻿먼저 텔레그램 메신저에서 &lsquo;BotFather&rsquo;라는 사용자를 찾고 &lsquo;/start&rsquo;를 누르면 아래와 같이 사용할 수 있는 명령어가 나온다.</p><p>　﻿그다음 우리는 봇을 만들 것이기 때문에 &lsquo;/newbot&rsquo;을 누르고 봇의 이름을 작성하고 그 봇의 사용자 이름을 지정한다. &lsquo;_bot&rsquo;으로 끝나야 한다고 하기에 이름 뒤에 붙여서 만들면 그걸로 끝. 다음으로 친절하게 HTTP API를 사용할 수 있는 토큰이 발급되는데 이 토큰으로 봇을 컨트롤 가능하기 때문에 잘 간직하고(?) 있어야 한다.</p><figure><a class=lightgallery href=/images/public-offering-notice-2/newbot.jpg title=/images/public-offering-notice-2/newbot.jpg data-thumbnail=/images/public-offering-notice-2/newbot.jpg data-sub-html="<h2>친절한 봇 아버지</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/newbot.jpg data-srcset="/images/public-offering-notice-2/newbot.jpg, /images/public-offering-notice-2/newbot.jpg 1.5x, /images/public-offering-notice-2/newbot.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/newbot.jpg width=70%></a><figcaption class=image-caption>친절한 봇 아버지</figcaption></figure><p>　﻿이후 해당 토큰을 이용해서 봇의 상태를 확인해보자. 아래의 url에 토큰 경로만 변경하여 입력하면 json 응답을 받을 수 있다.</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>https://api.telegram.org/bot{token}/getUpdates
e.g. https://api.telegram.org/bot17...42:AAH...cQU/getUpdates
</code></pre></div><ul><li>텔레그램 채널 생성</li></ul><p>　﻿1:N으로 채널에 가입한 사람들에게 메시지를 일방적으로 보내야 하기 때문에 사용할 채널을 만들어 보자. 텔레그램 UI만 봐도 간단하게 생성하기 쉽게 되어있다. 더불어 이 채널에 메시지를 보내야 하기 때문에 위에서 만들었던 봇을 추가하고 관리자로 승격 시키자.</p><figure><a class=lightgallery href=/images/public-offering-notice-2/newchannel.jpg title=/images/public-offering-notice-2/newchannel.jpg data-thumbnail=/images/public-offering-notice-2/newchannel.jpg data-sub-html="<h2>채널 생성 > 봇을 관리자로</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/newchannel.jpg data-srcset="/images/public-offering-notice-2/newchannel.jpg, /images/public-offering-notice-2/newchannel.jpg 1.5x, /images/public-offering-notice-2/newchannel.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/newchannel.jpg width=70%></a><figcaption class=image-caption>채널 생성 > 봇을 관리자로</figcaption></figure><ul><li>﻿텔레그램 봇으로 텔레그램 채널에 메시지 보내기</li></ul><p>　이 부분에서 약간 헤맸는데 결국 위에서 얻은 토큰과 채널의 특정 id를 알아야 메시지를 보낼 수 있다. 앞서 만들었던 채널에 아무 메시지나 작성을 하고 위에서 호출했던 &lsquo;getUpdates&rsquo; api를 다시 호출해보면 아래처럼 채널의 id를 구할 수 있게 된다.</p><figure><a class=lightgallery href=/images/public-offering-notice-2/channelid.jpg title=/images/public-offering-notice-2/channelid.jpg data-thumbnail=/images/public-offering-notice-2/channelid.jpg data-sub-html="<h2>메세지를 작성하지 않으면 데이터가 안나는 경우가 있었다.</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/channelid.jpg data-srcset="/images/public-offering-notice-2/channelid.jpg, /images/public-offering-notice-2/channelid.jpg 1.5x, /images/public-offering-notice-2/channelid.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/channelid.jpg></a><figcaption class=image-caption>메세지를 작성하지 않으면 데이터가 안나는 경우가 있었다.</figcaption></figure><p>　﻿마지막으로 아래처럼 &lsquo;sendMessage&rsquo; api를 활용해서 메시지를 보내보자. 이 외에 텔레그램의 공식 API 문서를 확인해 보는 게 가장 정확하고 다른 기능들도 둘러보는 것을 추천한다.</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>https://api.telegram.org/bot{token}/sendMessage?chat_id={channelId}<span class=err>&amp;</span>text={text}
e.g. https://api.telegram.org/bot17...42:AAH...cQU/sendMessage?chat_id=-10...33<span class=err>&amp;</span>text=helloWorld
</code></pre></div><figure><a class=lightgallery href=/images/public-offering-notice-2/helloworld.jpg title=/images/public-offering-notice-2/helloworld.jpg data-thumbnail=/images/public-offering-notice-2/helloworld.jpg data-sub-html="<h2>개발의 첫 시작은 언제나 hello world</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/helloworld.jpg data-srcset="/images/public-offering-notice-2/helloworld.jpg, /images/public-offering-notice-2/helloworld.jpg 1.5x, /images/public-offering-notice-2/helloworld.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/helloworld.jpg width=70%></a><figcaption class=image-caption>개발의 첫 시작은 언제나 hello world</figcaption></figure><h2 id=url-인코딩-이슈--bitly-로-활용>URL 인코딩 이슈 > bitly 로 활용</h2><p>　간단하게 될 줄 알았던 이 토이 프로젝트는 꽤 간단한 문제인 것 같은데 나름의 시간을 할애해야만 했던 &lsquo;인코딩 이슈&rsquo;라는 벽이 나타났다. 친절하게 &lsquo;메시지 인코딩이 잘못되었어~'라고 응답이 내려왔으면 인코딩 문제인 줄 알았겠거늘 그냥 400에러&mldr; 한참을 삽질 끝에 url 을 text에 넘기는 과정에서 인코딩 이슈로 api 호출이 잘못되고 있던 것이었다.</p><p>　인코딩을 처리해서 넘기려 했지만 이러한 특수문자 같은 인코딩 이슈가 또 나올 수도 있었기에. 그리고 이 링크를 얼마나 클릭했는지도 보고 싶었기에 방법을 찾다 단축 url 서비스로 잘 알려진 bitly를 사용하기로 하였다. 즉, 공모주 관련 알림을 보낼 때 그 공모주의 상세 URL 을 단축 url로 통해서 (인코딩이 필요 없는) url로 만들어서 보내는 형식이다.</p><p>　bitly를 가입하고 인증 토큰을 발급받은 다음 아래와 같이 작성을 하면 단축 url 이 생성된 후 반환을 받을 수 있다.
﻿</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>private</span> <span class=n>String</span> <span class=nf>getDetailLink</span><span class=o>(</span><span class=n>PublicOffering</span> <span class=n>publicOffering</span><span class=o>)</span> <span class=o>{</span>
	<span class=n>String</span> <span class=n>jsonBody</span> <span class=o>=</span> <span class=s>&#34;{\&#34;long_url\&#34; : \&#34;&#34;</span> <span class=o>+</span> <span class=n>publicOffering</span><span class=o>.</span><span class=na>getDetailUrl</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;\&#34;}&#34;</span><span class=o>;</span>
	<span class=n>JsonNode</span> <span class=n>responseNode</span> <span class=o>=</span> <span class=n>WebClient</span><span class=o>.</span><span class=na>create</span><span class=o>().</span><span class=na>post</span><span class=o>()</span>
	    <span class=o>.</span><span class=na>uri</span><span class=o>(</span><span class=s>&#34;https://api-ssl.bitly.com/v4/shorten&#34;</span><span class=o>)</span>
	    <span class=o>.</span><span class=na>header</span><span class=o>(</span><span class=s>&#34;Authorization&#34;</span><span class=o>,</span> <span class=s>&#34;Bearer f02...71c&#34;</span><span class=o>)</span>
	    <span class=o>.</span><span class=na>contentType</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
	    <span class=o>.</span><span class=na>body</span><span class=o>(</span><span class=n>BodyInserters</span><span class=o>.</span><span class=na>fromValue</span><span class=o>(</span><span class=n>jsonBody</span><span class=o>))</span>
	    <span class=o>.</span><span class=na>retrieve</span><span class=o>()</span>
	    <span class=o>.</span><span class=na>bodyToMono</span><span class=o>(</span><span class=n>JsonNode</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
	    <span class=o>.</span><span class=na>block</span><span class=o>();</span>
	<span class=k>return</span> <span class=n>responseNode</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;link&#34;</span><span class=o>).</span><span class=na>asText</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></div><p>　실제로 사용자들이 알림을 받고 클릭을 한 내역을 보면 어떤 공모주에 더 관심이 가는지 혹은 무슨 요일에 더 알림을 보는지 등 서비스를 만들려고 했던 목적 이상의 데이터를 얻을 수 있게 된다.</p><figure><a class=lightgallery href=/images/public-offering-notice-2/bitly.jpg title=/images/public-offering-notice-2/bitly.jpg data-thumbnail=/images/public-offering-notice-2/bitly.jpg data-sub-html="<h2>bitly 대시보드 화면. 실제 사용자들의 액션(?) 데이터</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/bitly.jpg data-srcset="/images/public-offering-notice-2/bitly.jpg, /images/public-offering-notice-2/bitly.jpg 1.5x, /images/public-offering-notice-2/bitly.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/bitly.jpg></a><figcaption class=image-caption>bitly 대시보드 화면. 실제 사용자들의 액션(?) 데이터</figcaption></figure><h2 id=마치며>마치며</h2><p>　﻿최종 결과물은 아래 화면처럼 데이터를 획득하고 (크롤링) 텔레그램의 봇 api와 bitly의 API를 활용해서 메시지를 채널로 전송하는 데까지 성공하였다. 이제 남은 건 해당 애플리케이션을 서버에 업로드하고 이를 주기적으로 호출하는 방법만 찾으면 끝!</p><figure><a class=lightgallery href=/images/public-offering-notice-2/result.jpg title=/images/public-offering-notice-2/result.jpg data-thumbnail=/images/public-offering-notice-2/result.jpg data-sub-html="<h2>이 화면은 지난 3월 22일에 실제로 서비스 된 화면이다. 자세히 보면 계획했던 오전 8시가 아닌데 이 비하인드는 다음 포스트에 작성하도록 하겠다.</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/public-offering-notice-2/result.jpg data-srcset="/images/public-offering-notice-2/result.jpg, /images/public-offering-notice-2/result.jpg 1.5x, /images/public-offering-notice-2/result.jpg 2x" data-sizes=auto alt=/images/public-offering-notice-2/result.jpg></a><figcaption class=image-caption>이 화면은 지난 3월 22일에 실제로 서비스 된 화면이다. 자세히 보면 계획했던 오전 8시가 아닌데 이 비하인드는 다음 포스트에 작성하도록 하겠다.</figcaption></figure><p>　여기까지만 보면 큰 어려움이 없었고 만들기 전에 생각했던 흐름대로 만들었기 때문에 이제 다음 스탭만 진행하면 모든 게 끝날 거라 기대를 했다. 하지만 서버를 선정(?) 하고 그것을 주기적으로 호출하는 방법을 찾는데 예상치 못한 어려움을 만났고 나름 꽤 많은 시간을 삽질해야만 했다.</p><p>　To Be Contunue&mldr;</p><p>﻿</p></div><center><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:29px!important;height:30px!important;text-decoration:none!important;display:inline-flex!important;color:#000!important;background-color:#fd0!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#000!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><center><br><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/taetaetae><img src=https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg alt="Buy me a coffee"><span style=margin-left:5px>Buy me a coffee</span></a>
<a href=https://bit.ly/ddbSupport target=_blank><img src=https://i.imgur.com/peaYpjh.png style=height:28px></a></center><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-03-28</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/posts/public-offering-notice-2/ data-title="공모주 알리미 개발 후기 - 2부" data-hashtags=public-offering-notice,telegram,bitly,archives-2021><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/posts/public-offering-notice-2/ data-hashtag=public-offering-notice><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/posts/public-offering-notice-2/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/posts/public-offering-notice-2/ data-title="공모주 알리미 개발 후기 - 2부" data-description><i class="fab fa-blogger fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/public-offering-notice/>public-offering-notice</a>,&nbsp;<a href=/tags/telegram/>telegram</a>,&nbsp;<a href=/tags/bitly/>bitly</a>,&nbsp;<a href=/tags/archives-2021/>archives-2021</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/public-offering-notice-1/ class=prev rel=prev title="공모주 알리미 개발 후기 - 1부"><i class="fas fa-angle-left fa-fw"></i>공모주 알리미 개발 후기 - 1부</a>
<a href=/posts/public-offering-notice-3/ class=next rel=next title="공모주 알리미 개발 후기 - 3부">공모주 알리미 개발 후기 - 3부<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>태태태</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment","lightTheme":"github-light","repo":"taetaetae/blog-comment"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-86432198-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
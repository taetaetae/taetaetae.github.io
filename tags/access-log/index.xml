<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>access log - Tag - ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</title><link>https://taetaetae.github.io/tags/access-log/</link><description>access log - Tag - ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Thu, 25 Jan 2018 21:18:35 +0000</lastBuildDate><atom:link href="https://taetaetae.github.io/tags/access-log/" rel="self" type="application/rss+xml"/><item><title>ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì.</title><link>https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/</link><pubDate>Thu, 25 Jan 2018 21:18:35 +0000</pubDate><author>Author</author><guid>https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/</guid><description><![CDATA[apache access log ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ì€ ìƒí™©ì´ ìƒê²¼ë‹¤. ì•„ë‹ˆ ê·¸ë³´ë‹¤ apache accessì— ëŒ€í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ê³ ì‹¶ì—ˆê³ , logë¥¼ ê²€ìƒ‰ &amp; ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ ìœ ì˜ë¯¸í•œ ë¶„ì„ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ ë³´ê³  ì‹¶ì—ˆë‹¤. ê·¸ì— ìƒê°í•œê²ƒì´ (ì—­ì‹œ) ElasticStack.ì²˜ìŒì— ìƒê°í•œ ë°©ì•ˆì€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë‹¨ìˆœí–ˆë‹¤. ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡°" ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡° 
í•˜ì§€ë§Œ, ë‚´ ë‹¨ìˆœí•œ(?) ì˜ˆìƒì€ ì—­ì‹œ ë¹—ë‚˜ê°”ê³  logstashì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ì—ˆë‹¤.
 retrying individual bulk actions that failed or were rejected by the previous bulk request
 requestê°€ ë§ì•„ì§ì— ë”°ë¼ elasticsearchê°€ ë²„ë²…ê±°ë¦¬ë”ë‹ˆ logstashì—ì„œ ëŒ€ëŸ‰ì‘ì—…ì€ ê±°ë¶€í•˜ê² ë‹¤ë©° ì¸ë±ì‹±ì„ ë©ˆì·„ë‹¤. ê³ ë¯¼ê³ ë¯¼í•˜ë‹¤ elasticsearchì— ì¸ë±ì‹±í• ë•Œ ë¶€í•˜ê°€ ë§ì´ ê±¸ë¦¬ëŠ” ìƒí™©ì—ì„œ ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘” ê²½í—˜ì´ ìˆì–´ì„œ facebookê·¸ë£¹ì— ë¬¸ì˜ë¥¼ í•´ë´¤ë‹¤. https://www.facebook.com/groups/elasticsearch.kr/?multi_permalinks=1566735266745641 ì—­ì‹œ ë‚˜ë³´ë‹¤ í•œì°¸ì„ ì•ì„œê°€ì‹œëŠ” ë¶„ë“¤ì€ ì´ë¯¸ ì—ëŸ¬ê°€ ë­”ì§€ ì•Œê³  ìˆìœ¼ì…¨ê³ , ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘ê³  í•˜ë‹ˆ ì˜ëœë‹¤ëŠ” ì˜ê²¬ì´ ìˆì–´ ë‚˜ë„ ë”°ë¼í•´ë´¤ë‹¤. ë¬¼ë¡  ë‹µë³€ì¤‘ì— ë‚˜ì˜¨ redisê°€ ì•„ë‹Œ ê¸°ì¡´ì—ë„ ë¹„ìŠ·í•œ êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë˜ kafkaë¥¼ ì ìš©. ì•„, ê·¸ì „ì— í˜„ì¬êµ¬ì„±ì€ Elasticsearch ë…¸ë“œê°€ ì´ 3ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ë° ë…¸ë“œë¥¼ ì¶”ê°€ë¡œ ëŠ˜ë¦¬ë©° ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ í•´ë³´ê¸°ì „ì— í• ìˆ˜ìˆëŠ” ë§ˆì§€ë§‰ ë°©ë²•ì´ë‹¤ ìƒê°í•˜ê³  ì¤‘ê°„ì— kafkaë¥¼ ë‘¬ì„œ ë¶€í•˜ë¥¼ ì¤„ì—¬ë³´ê³  ì‹¶ì—ˆë‹¤. (ì–¸ì œë¶€í„´ê°€ ë§ˆì¹˜ ì—¬ëŸ¬ê°œì˜ í†±ë‹ˆë°”í€´ê°€ ë§ë¬¼ë ¤ ëŒì•„ê°€ëŠ”ë“¯í•œ ì‹œìŠ¤í…œ ì„¤ê³„ë¥¼ í•˜ëŠ”ê²Œ ì¬ë°Œì—ˆë‹¤.) ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë§ì´ë‹¤.
ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°" ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°  ê·¸ë¬ë”ë‹ˆ ê±°ì§“ë§ ì²˜ëŸ¼ ì—ëŸ¬í•˜ë‚˜ ì—†ì´ ì˜ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. logstashê°€ ì–‘ìª½ì— ìˆëŠ”ê²Œ ì•½ê°„ ê±¸ë¦¬ê¸´ í•˜ì§€ë§Œ, ì²˜ìŒì— ìƒê°í•œ êµ¬ì¡°ë³´ë‹¤ëŠ” ì—ëŸ¬ê°€ ì•ˆë‚˜ë‹ˆ ë‹¤í–‰ì´ë¼ ìƒê°í•œë‹¤.
ì´ êµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ì„œ ì–»ì€ Insightê°€ ìˆê¸°ì—, ê° í•­ëª©ë³„ë¡œ ì ì–´ ë³´ê³ ì í•œë‹¤. ( ì´ê²ƒë§Œ ì ì–´ë†“ê¸°ì—” ë„ˆë¬´ ì—†ì–´ë³´ì—¬ì„œ.. )
access log ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ì—¬ ì¸ë±ì‹± í• ê²ƒì¸ê°€? apache 2.xë¥¼ ì‚¬ìš©í•˜ê³  ë³„ë„ì˜ ë¡œê·¸ í¬ë§·ì„ ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì€ access logê°€ ì°íŒë‹¤. 123.1.1.1 - - [25/Jan/2018:21:55:35 +0900] &quot;GET /api/test?param=12341234 HTTP/1.1&quot; 200 48 1144 &quot;http://www.naver.com/&quot; &quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NAVER(inapp; blog; 100; 4.0.44)&quot; ê·¸ëŸ¼ ì´ ë¡œê·¸ë¥¼ ì•„ë¬´ í¬ë§·íŒ… ì—†ì´ ë¡œê¹…ì„ í•˜ë©´ ê·¸ëƒ¥ í•œì¤„ì˜ í…ìŠ¤íŠ¸ê°€ ì¸ë±ì‹±ì´ ëœë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ elasticsearch ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì¬ê°€ê³µí•˜ê±°ë‚˜ ë³„ë„ì˜ ì‘ì—…ì´ í•„ìš”í• ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì¤‘ê°„ì— ìˆëŠ” logstashì—ê²Œ ì¼ì„ ì‹œì¼œ ì¢€ë” nice í•œ ë°©ë²•ìœ¼ë¡œ ì¸ë±ì‹±ì„ í•´ë³´ì. ë°”ë¡œ logstash ì˜ filter ê¸°ëŠ¥ì´ë‹¤. ê·¸ì¤‘ Grok filter ë¼ëŠ”ê²Œ ìˆëŠ”ë° íŒ¨í„´ì„ ì ìš©í•˜ì—¬ row data ë¥¼ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ ê³ ë§™ê²Œë„ ì•„íŒŒì¹˜ í•„í„° ì˜ˆì œê°€ ìˆì–´ ìˆ˜ì •í•˜ì—¬ ì ìš©í• ìˆ˜ ìˆì—ˆë‹¤. http://grokconstructor.appspot.com/do/match?example=2 ê·¸ë˜ì„œ ì ìš©í•œ í•„í„°ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
filter { grok { match =&gt; { message =&gt; &#34;%{IP:clientIp} (?:-|) (?:-|) \[%{HTTPDATE:timestamp}\] \&#34;(?:%{WORD:httpMethod} %{URIPATH:uri}%{GREEDYDATA}(?: HTTP/%{NUMBER})?|-)\&#34; %{NUMBER:responseCode} (?:-|%{NUMBER})&#34; } } } ì´ë ‡ê²Œ í•˜ê³  elasticsearch ì— ì¸ë±ì‹±ì„ í•˜ë©´ í‚¤ë°”ë‚˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³¼ìˆ˜ ìˆë‹¤. í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log" í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log 
ê° í•„ë“œê°€ ì•„ë‹Œ í•œì¤„ë¡œ ì¸ë±ì‹±ì´ ë˜ì–´ë²„ë¦°ë‹¤. Elasticsearch ì— ì¸ë±ì‹±ì´ ë˜ê¸´ í•˜ëŠ”ë° ë¡œê·¸ í•œì¤„ì´ í†µì§¸ë¡œ ë“¤ì–´ê°€ ë²„ë¦°ë‹¤. messageë¼ëŠ” ì´ë¦„ìœ¼ë¡œ&hellip; ì•Œê³ ë³´ë‹ˆ í˜„ì¬ êµ¬ì¡°ëŠ” logstashê°€ kafka ì• ë’¤ì— ìˆë‹¤ë³´ë‹ˆ producer logstash ì™€ consumer logstash ì˜ codecì´ ë§ì•„ì•¼ ì œëŒ€ë¡œ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. ë¨¼ì € access logì—ì„œ kafka ë¡œ produce í•˜ëŠ” logstash ì—ì„œëŠ” output í• ë•Œ codec ì„ ë§ì¶°ì£¼ê³ 
output { kafka { bootstrap_servers =&gt; &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id =&gt; &#34;apache-log&#34; codec =&gt; json{} } } kafka ì—ì„œ consume í•˜ëŠ” logstash ì—ì„œëŠ” input ì—ì„œ codec ì„ ë§ì¶°ì¤€ë‹¤.
input { kafka { bootstrap_servers =&gt; &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id =&gt; &#34;apache-log&#34; codec =&gt; json{} } } ê·¸ë ‡ê²Œ ë˜ë©´ codecì´ ë§ì•„ ê° í•„ë“œë¡œ ì´ì˜ê²Œ ì¸ë±ì‹±ì„ í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
í•„ìš”ì—†ëŠ” uriëŠ” ì œì™¸í•˜ê³  ì¸ë±ì‹±í• ìˆ˜ ìˆì„ê¹Œ? /ìœ¼ë¡œëŠ” uri ë¼ë˜ì§€ /server-statusê°™ì´ ì•Œê³ ìˆì§€ë§Œ ì¸ë±ì‹±ì€ í•˜ê¸° ì‹«ì€ ê²½ìš°ëŠ” ê°„ë‹¨í•˜ê²Œ ì•„ë˜ì²˜ëŸ¼ ifë¬¸ìœ¼ë¡œ ì œì™¸ì‹œí‚¬ìˆ˜ ìˆì—ˆë‹¤.]]></description></item></channel></rss>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Facebook on</title><link>https://taetaetae.github.io/tags/facebook/</link><description>Recent content in Facebook on</description><generator>Hugo</generator><language>en</language><lastBuildDate>Thu, 31 May 2018 17:03:41 +0000</lastBuildDate><atom:link href="https://taetaetae.github.io/tags/facebook/index.xml" rel="self" type="application/rss+xml"/><item><title>시계열 데이터를 분석하여 미래 예측 하기(Anomaly Detection)</title><link>https://taetaetae.github.io/2018/05/31/anomaly-detection/</link><pubDate>Thu, 31 May 2018 17:03:41 +0000</pubDate><guid>https://taetaetae.github.io/2018/05/31/anomaly-detection/</guid><description>&lt;p>급변하는 날씨를 예측하려면 어떠한 정보가 있어야 할까?
또는 마트를 운영하는 담당자인 경우 매장 운영시간을 정해야 한다면 어떠한 기준으로?
뜨거운 감자인 비트코인 시장에서 수익을 얻으려면 어떤 정보들이 있어야 물리지(?) 않을수 있을까?&lt;/p>
 &lt;!--more --> 
&lt;p>위 질문에 공통된 정답은 &lt;code>예전 기록들&lt;/code>인것 같다. 날씨예측은 기상청에서 과거 기록들을 보고 비가 올지 말지를 결정하고 ( 과거 날씨 서비스를 담당해봤지만 단순히 과거 기록들로 예측한다는건 불가능에 가깝긴 하다. ) 매장 운영시간은 예전에 손님들이 언제왔는지에 대한 데이터를 보고. 비트코인이나 주식은 차트를 보고 어느정도는 상승장일지 하락장일지 추측이 가능하다고 한다. ( 물론 호재/악재에 따라 흔들리지만..ㅠㅠ..?? )
이처럼 시간의 흐름에 따라 만들어진 데이터를 분석하는것을 &lt;code>시계열 데이터 분석&lt;/code>이라 부르고 있다. 필자가 운영하는 서비스에서 시계열 데이터 분석을 통해 장애를 사전에 방지하는 사례를 공유 해보고자 한다.&lt;/p>
&lt;h2 id="상황파악부터">상황파악부터&lt;/h2>
&lt;p>손자병법에는 지피지기 백전불태 라는 말이 있다. 그만큼 현 상황을 잘 알아야 대응을 잘할수 있다는것. 필자가 운영하는 서비스는 PG(Payment Gateway) 서비스로 쇼핑몰같은 온/오프라인 사업자와 실제 카드사와의 중간 역활을 해주고 있다. 이를테면 사용자가 &lt;code>생수를 10,000원에 XX카드로 구매해줘&lt;/code> 라고 요청이 오면 그 정보를 다시 형식에 맞춰 카드사로 전달하여 사용자가 물건을 구매할수 있도록 해준다.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://taetaetae.github.io/images/anomaly-detection/pg.png" title="/images/anomaly-detection/pg.png" data-thumbnail="/images/anomaly-detection/pg.png" data-sub-html="&lt;h2>PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.&lt;/h2>">
 &lt;img
 class="lazyload"
 src="https://taetaetae.github.io/svg/loading.min.svg"
 data-src="https://taetaetae.github.io/images/anomaly-detection/pg.png"
 data-srcset="https://taetaetae.github.io/images/anomaly-detection/pg.png, https://taetaetae.github.io/images/anomaly-detection/pg.png 1.5x, https://taetaetae.github.io/images/anomaly-detection/pg.png 2x"
 data-sizes="auto"
 alt="/images/anomaly-detection/pg.png" />
 &lt;/a>&lt;figcaption class="image-caption">PG서비스 : 쇼핑몰과 카드사의 중간에서 릴레이 해주는 역활이라 보면된다.&lt;/figcaption>
 &lt;/figure>
&lt;h2 id="요구사항-및-과거-데이터-분석">요구사항 및 과거 데이터 분석&lt;/h2>
&lt;p>서비스를 운영해보니 감지하기 어려운 상황들이 있었다.&lt;/p>
&lt;ul>
&lt;li>연동하는 쇼핑몰에서 문제가 발생하거나 네트워크 문제가 발생할경우 즉, 트래픽이 평소보다 적게 들어올 경우&lt;/li>
&lt;li>정상적인 에러(e.g. 잔액부족) 가 갑자기 많이 발생할 경우&lt;/li>
&lt;/ul>
&lt;p>이를 분석하기위해 기존의 트래픽/데이터를 분석해봐야 했다.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://taetaetae.github.io/images/anomaly-detection/trade_count.png" title="/images/anomaly-detection/trade_count.png" data-thumbnail="/images/anomaly-detection/trade_count.png" data-sub-html="&lt;h2>결제건수 Kibana Visualize, 기영이 패턴&lt;/h2>">
 &lt;img
 class="lazyload"
 src="https://taetaetae.github.io/svg/loading.min.svg"
 data-src="https://taetaetae.github.io/images/anomaly-detection/trade_count.png"
 data-srcset="https://taetaetae.github.io/images/anomaly-detection/trade_count.png, https://taetaetae.github.io/images/anomaly-detection/trade_count.png 1.5x, https://taetaetae.github.io/images/anomaly-detection/trade_count.png 2x"
 data-sizes="auto"
 alt="/images/anomaly-detection/trade_count.png" />
 &lt;/a>&lt;figcaption class="image-caption">결제건수 Kibana Visualize, 기영이 패턴&lt;/figcaption>
 &lt;/figure>
&lt;p>위 그래프는 결제데이터 카운트 인데 어느정도 패턴을 찾을수 있다.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://taetaetae.github.io/images/anomaly-detection/error_count.png" title="/images/anomaly-detection/error_count.png" data-thumbnail="/images/anomaly-detection/error_count.png" data-sub-html="&lt;h2>에러건수 Kibana Visualize, 악어 패턴..(무리수..)&lt;/h2>">
 &lt;img
 class="lazyload"
 src="https://taetaetae.github.io/svg/loading.min.svg"
 data-src="https://taetaetae.github.io/images/anomaly-detection/error_count.png"
 data-srcset="https://taetaetae.github.io/images/anomaly-detection/error_count.png, https://taetaetae.github.io/images/anomaly-detection/error_count.png 1.5x, https://taetaetae.github.io/images/anomaly-detection/error_count.png 2x"
 data-sizes="auto"
 alt="/images/anomaly-detection/error_count.png" />
 &lt;/a>&lt;figcaption class="image-caption">에러건수 Kibana Visualize, 악어 패턴..(무리수..)&lt;/figcaption>
 &lt;/figure>
&lt;p>위 그래프는 에러카운트 인데 일정한 패턴 속에서 어느 지점에서는 튀는것을 확인할수 있다. (빨간색 영역) 그렇다면 어떤 방법으로 장애상황보다 앞서서 감지를 할수 있을까? ( 장애 : 어떠한 내/외부 요인으로 인해 정상적인 서비스가 되지 않는 상태 )&lt;/p>
&lt;h2 id="장애발생-전에-먼저-찾아보자">장애발생 전에 먼저 찾아보자!&lt;/h2>
&lt;p>가장 간단하게는 기존 데이터를 보고 수동으로 설정하는 방법이 있을수 있다. 예로들어 자정 즈음에는 결제량이 가장 많기때문에 약 xx건으로 설정해두고, 새벽에는 결제량이 가장 적기 때문에 약 yy건으로 설정해둔 후 에러 건수나 결제건수에 대해 실시간으로 검사를 해가면서 설정한 값보다 벗어날 경우 알림을 주는 방법이다.
하지만 아무리 과거 데이터를 완벽하게 분석했다 할지라도 24시간 모든 시점에서 예측은 벗어날 수밖에 없다. (예로들어 쇼핑 이벤트를 갑작스럽게 하게되면 결제량은 예측하지 못할정도로 늘어날테고&amp;hellip;) 또한 설정한 예측값을 벗어날 경우 수동으로 다시 예측값을 조정해줘야 하는데, 이럴꺼면 24시간 종합 상황실에서 사람이 직접 눈으로 보는것 보다 못할것 같다. (인력 리소스가 충분하다면 뭐&amp;hellip; 그렇게 해도 된다.)&lt;/p>
&lt;h2 id="지난-데이터와-비교하기">지난 데이터와 비교하기&lt;/h2>
&lt;p>일주일 기준으로 지난 일주일과의 데이터를 비교해보는 방법또한 있다. 간단하게 설명하면 이번주 월요일 10시의 데이터와 지난주 월요일 10시의 데이터의 차이를 비교해보는 방법이다. 키바나에서 클릭 몇번만으로 시각화를 도와주는 Visualize 기능을 통해 지난 일주일과 이번주를 비교해보면 아래 그래프처럼 표현이 가능하다.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://taetaetae.github.io/images/anomaly-detection/visualize.png" title="/images/anomaly-detection/visualize.png" data-thumbnail="/images/anomaly-detection/visualize.png" data-sub-html="&lt;h2>일주일 전 데이터와 단순 비교&lt;/h2>">
 &lt;img
 class="lazyload"
 src="https://taetaetae.github.io/svg/loading.min.svg"
 data-src="https://taetaetae.github.io/images/anomaly-detection/visualize.png"
 data-srcset="https://taetaetae.github.io/images/anomaly-detection/visualize.png, https://taetaetae.github.io/images/anomaly-detection/visualize.png 1.5x, https://taetaetae.github.io/images/anomaly-detection/visualize.png 2x"
 data-sizes="auto"
 alt="/images/anomaly-detection/visualize.png" />
 &lt;/a>&lt;figcaption class="image-caption">일주일 전 데이터와 단순 비교&lt;/figcaption>
 &lt;/figure>
&lt;p>이 경우도 지난주 상황과 이번주 상황이 다른 경우에는 원하는 비교 항목 외에 다른 요인이 추가되기 때문에 원하는 비교를 할수가 없고 위에서 수동으로 설정하는 방법과 별반 다를바 없을것으로 생각된다.&lt;/p>
&lt;h2 id="조금더-우아하게-언제부턴가-우아하단-말을-좋아하는것-같다">조금더 우아하게! &lt;code>(언제부턴가 우아하단 말을 좋아하는것 같다..)&lt;/code>&lt;/h2>
&lt;p>개발자는 문제에 대해서 언제나 분석을 토대로 접근을 하는것을 목표로 해야한다. 언제부턴가 Hot한 머신러닝을 도입해 보고 싶었으나 아직 그런 실력이 되질 못하고&amp;hellip; 폭풍 구글링을 통해 알게된 Facebook에서 만든 &lt;a href="https://facebook.github.io/prophet/" target="_blank" rel="noopener noreffer ">Prophet&lt;/a>이라는 모듈을 활용해보고자 한다.
&lt;a href="https://opensource.fb.com/#artificial" target="_blank" rel="noopener noreffer ">https://opensource.fb.com/#artificial&lt;/a> 이곳에 가보면 여러 Artificial Intelligence 관련된 오픈소스들중에 Prophet 모듈을 찾을수 있다. 다행히도 &lt;a href="https://namu.wiki/w/BSD%20%EB%9D%BC%EC%9D%B4%EC%84%A0%EC%8A%A4" target="_blank" rel="noopener noreffer ">BSD License&lt;/a>라서 실무에서도 다양하게 활용할수 있을것으로 보인다. 친절하게도 &lt;code>Quick Start&lt;/code>을 통해 어떤식으로 예측을 하는지 보여준다. 참고로 Python 과 R 을 지원한다. (python 의 대단함을 다시금 느끼며&amp;hellip;)
구성은 CentOS 7 + python3.6 + jenkins 를 활용한다. (python 경험이 부족하므로 코드가 허접할수도 있으니 양해바란다.)
데이터 분석시 가장 많이 사용된다는 &lt;code>Pandas&lt;/code>와 대규모 다차원 배열을 쉽게 처리 할 수 있게 해주는 &lt;code>numpy&lt;/code>, 그리고 &lt;code>bprophet&lt;/code>를 비롯한 필요한 모듈들을 pip로 설치해준다.&lt;/p></description></item></channel></rss>
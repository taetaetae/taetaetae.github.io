<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>retryable - Tag - ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</title><link>https://taetaetae.github.io/tags/retryable/</link><description>retryable - Tag - ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sun, 22 Mar 2020 15:30:35 +0000</lastBuildDate><atom:link href="https://taetaetae.github.io/tags/retryable/" rel="self" type="application/rss+xml"/><item><title>ì¡°ê¸ˆ ë” ê´œì°®ì€ Rest Template 1ë¶€ - Retryable</title><link>https://taetaetae.github.io/2020/03/22/better-rest-template-1-retryable/</link><pubDate>Sun, 22 Mar 2020 15:30:35 +0000</pubDate><author>Author</author><guid>https://taetaetae.github.io/2020/03/22/better-rest-template-1-retryable/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/better-rest-template-1-retryable/icons8.png" referrerpolicy="no-referrer">
            </div>ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë©´ì„œ ê¼­ í•œë²ˆ ì¯¤ ë§Œë‚˜ê²Œ ë˜ëŠ” &ldquo;RestTemplate&rdquo;. ì ‘ê·¼ ê°€ëŠ¥í•œ ì™¸ë¶€ HTTP URL(ë³´í†µ API)ì„ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì¤‘ì— í•˜ë‚˜ë¡œ springframework ì—ì„œ ì œê³µí•´ì£¼ëŠ” ëª¨ë“ˆì´ë‹¤. íŠ¹íˆ í° í•œë©ì–´ë¦¬ë¡œ ê´€ë¦¬ë˜ë˜ Monolithic Architecture ì—ì„œ ìš”ì²­ì„ í•˜ê³ (client) ì‘ë‹µì„ ì£¼ëŠ”(server) ì¦‰, Endpointê°€ ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ë˜ëŠ” Microservice Architecture ë¡œ ë°”ë€Œë©´ì„œ ê° ì„œë¹„ìŠ¤ê°„ í˜¸ì¶œë°©ì‹ì´ HTTP ì¼ ê²½ìš° ìì£¼ ì‚¬ìš©ë˜ê³¤ í•˜ëŠ” ê²ƒ ê°™ë‹¤. (webClient ë“± ë‹¤ë¥¸ ì—¬ëŸ¬ í˜¸ì¶œ ë°©ë²•ë“¤ì´ ìˆë‹¤.) ë§Œì•½, ìš”ì²­ì„ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ ì‘ë‹µì„ ì£¼ëŠ” ì„œë²„ì˜ ìƒíƒœê°€ ë¶ˆì•ˆì • í•˜ë‹¤ê³  ê°€ì •í–ˆì„ë•Œ, ì–´ë–¤ì‹ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í• ê¹Œ? ì˜ˆì»¨ëŒ€, ìš”ì²­ 10ë²ˆì— í•œë²ˆì€ ì–´ë– í•œ ì´ìŠˆë¡œ ì‘ë‹µì´ ì§€ì—°ë˜ê±°ë‚˜ ì„œë²„ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ê³  í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” ê°„í—ì ì¸ ì˜¤ë¥˜ì‘ë‹µì— ë‹µë‹µí•¨ì„ í˜¸ì†Œí•  ìˆ˜ë„ ìˆë‹¤. ê·¸ëŸ¼ ì ì‹œ ëˆˆì„ ê°ê³  ìƒê°í•´ë³´ì. ê°€ë³ê²Œ ìƒê°í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ &ldquo;ì˜ˆì™¸ì²˜ë¦¬&quot;ë¥¼ ì´ìš©í•  ìˆ˜ë„ ìˆë‹¤.
try { // http call } catch (Exception e){ // ì„œë²„ì—ëŸ¬ê°€ ì•„ë‹Œ ì•½ì†ëœ ì—ëŸ¬ì‘ë‹µì„ ë¦¬í„´ } í•˜ì§€ë§Œ ì´ê²ƒë„ ì •ë‹µì´ ì•„ë‹ìˆ˜ ìˆëŠ”ê²Œ, &ldquo;ê°„í—ì ì¸ ì˜¤ë¥˜&quot;ë¡œ ì¸í•´ ì‚¬ìš©ìëŠ” ì˜¤ë¥˜í™”ë©´ì„ ë´ì•¼í•˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì‹ ë¢°ë¥¼ ì €ë²„ë¦´ ìˆ˜ë°–ì— ì—†ë‹¤. ê·¸ëŸ¼ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ì—¬ëŸ¬ê°€ì§€ í•´ê²°ë°©ë²•ì´ ìˆê² ì§€ë§Œ ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•˜ë‹¤ê³  ìƒê°ë˜ëŠ” ë°©ë²•ì´ ë°”ë¡œ &ldquo;ì¬ì‹œë„&rdquo; ë¼ê³  ìƒê°í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ëˆˆì¹˜ ëª»ì±Œë§Œí¼ ë¹ ë¥´ê²Œ ì¬ì‹œë„ë¥¼ í•œë‹¤ë©´ ì—ëŸ¬ê°€ ë‚˜ë„ ë‹¤ì‹œí•œë²ˆ í˜¸ì¶œí•´ì„œ ì„±ê³µí•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì´ë‹¤. (ê·¸ì¹˜ë§Œ ê·¼ë³¸ì ì¸ ì›ì¸ì€ í•´ê²°í•´ì•¼&hellip;)
ì‹¤ì œë¡œ ì¡°ê¸ˆìˆë‹¤ í•´ë³´ë©´ ë˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ ì•ˆë ë•ŒëŠ” ì¡°ê¸ˆ (ì²œì²œíˆ) ì‹œë„í•´ë³´ì. ì¶œì²˜ : http://www.segye.com/newsView/20200302504384" ì‹¤ì œë¡œ ì¡°ê¸ˆìˆë‹¤ í•´ë³´ë©´ ë˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ ì•ˆë ë•ŒëŠ” ì¡°ê¸ˆ (ì²œì²œíˆ) ì‹œë„í•´ë³´ì. ì¶œì²˜ : http://www.segye.com/newsView/20200302504384  ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” RestTemplate ë¥¼ ì´ìš©í• ë•Œ &ldquo;ì¬ì‹œë„&rdquo; í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•œë‹¤. ì•„ì£¼ ê°„ë‹¨í• ì§€ ëª¨ë¥´ì§€ë§Œ ë…¸ë ¥ì— ë¹„í•´ íš¨ê³¼ê°€ ìƒë‹¹í•˜ë‹¤ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì— ì •ë¦¬í•´ ë‘ê³  ì‹¶ì—ˆë‹¤.
Spring Retry ê³µì‹ Githubì— ì†Œê°œë¥¼ ë¹Œë¦¬ìë©´, Spring ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì¬ì‹œë„ ì§€ì›ì„ ì œê³µí•œë‹¤ê³  í•œë‹¤. ìœ„ì—ì„œ ì´ì•¼ê¸° í–ˆë˜ &ldquo;RestTemplate&quot;ê³¼ëŠ” ì‚¬ì‹¤ ë¬´ê´€í•˜ê³ , ì´ë¥¼ í™œìš©í•´ì„œ ì¬ì‹œë„ í•˜ëŠ” &ldquo;RetryRestTemplate&quot;ë¥¼ êµ¬í˜„í•´ë³´ë ¤ í•˜ëŠ”ê²ƒì´ë‹¤. ìš°ì„  ì´ &ldquo;Spring-Retry&quot;ì˜ ì˜ˆì œë¥¼ ë³´ë©´ ì•„ì£¼ ì‹¬í”Œí•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ìš°ì„  pomì— êµ¬í˜„ì— í•„ìš”í•œ dependency ë¥¼ ì¶”ê°€í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ë³´ì.
&lt;dependency&gt; &lt;groupId&gt;org.springframework.retry&lt;/groupId&gt; &lt;artifactId&gt;spring-retry&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; @Configuration @EnableRetry // 1 public class Application { @Bean public Service service() { return new Service(); } } @Service class Service { @Retryable(RemoteAccessException.class) // 2  public void service() { // ... do something  } @Recover // 3  public void recover(RemoteAccessException e) { // ... panic  } }  @EnableRetry ì–´ë…¸í…Œì´ì…˜ì„ @Configurationì„ ì§€ì •í•œ í´ë˜ìŠ¤ ì¤‘ í•˜ë‚˜ì— ì¶”ê°€í•œë‹¤. ì¬ì‹œë„ í•˜ë ¤ëŠ” ë©”ì†Œë“œì— @Retryable ì–´ë…¸í…Œì´ì…˜ì„ ì§€ì •í•´ì¤€ë‹¤. ì¬ì‹œë„ê°€ ì™„ë£Œë˜ëŠ” ì‹œì ì—ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ë•Œ ì„ ì–¸í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜, @Retryable ë™ì¼í•œ í´ë˜ìŠ¤ì—ì„œ ì„ ì–¸ë˜ì–´ì•¼ í•˜ê³  return type ì€ @Retryableì„ ì§€ì •í•œ ë©”ì†Œë“œì™€ ë™ì¼í•´ì•¼ í•œë‹¤.  Retry Rest Template ì´ë ‡ê²Œ springframework ì—ì„œ ì œê³µí•´ì£¼ëŠ” spring-retry ë¥¼ ì´ìš©í•´ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì˜ ëª©í‘œì¸ ì¬ì‹œë„ë¥¼ í•˜ëŠ” Retry Rest Template ë¥¼ êµ¬ì„±í•´ë³´ì. ìš°ì„ , RestTemplate ë¥¼ Bean ìœ¼ë¡œ ë“±ë¡í•˜ê³ , ìœ„ì—ì„œ ì´ì•¼ê¸° í•œ ì–´ë…¸í…Œì´ì…˜ë“¤ë¡œ êµ¬ì„±í•´ë³´ì.
@EnableRetry @Configuration public class RetryableRestTemplateConfiguration { @Bean public RestTemplate retryableRestTemplate() { SimpleClientHttpRequestFactory clientHttpRequestFactory = new SimpleClientHttpRequestFactory(); // 1 	clientHttpRequestFactory.setReadTimeout(2000); clientHttpRequestFactory.setConnectTimeout(500); RestTemplate restTemplate = new RestTemplate(clientHttpRequestFactory) { @Override @Retryable(value = RestClientException.class, maxAttempts = 3, backoff = @Backoff(delay = 1000)) // 2 	public &lt;T&gt; ResponseEntity&lt;T&gt; exchange(URI url, HttpMethod method, HttpEntity&lt;?&gt; requestEntity, Class&lt;T&gt; responseType) throws RestClientException { return super.exchange(url, method, requestEntity, responseType); } @Recover public &lt;T&gt; ResponseEntity&lt;String&gt; exchangeRecover(RestClientException e) { return ResponseEntity.badRequest().body(&#34;bad request T.T&#34;); // 3 	} }; return restTemplate; } }  SimpleClientHttpRequestFactory ë¥¼ ë§Œë“¤ê³  ê° íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•´ì¤€ ë‹¤ìŒ RestTemplate íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì¤€ë‹¤. ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ exchange ë©”ì†Œë“œë¥¼ ì´ìš©í•  ê²ƒì´ë¯€ë¡œ í•´ë‹¹ ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•´ì¤€ë‹¤.]]></description></item></channel></rss>
<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸° -</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://taetaetae.github.io/2019/06/30/controller-common-logging/"><meta property="og:site_name" content="My cool site"><meta property="og:title" content="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°"><meta property="og:description" content='ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë‹¤ ë³´ë©´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ë§¨ ì²˜ìŒì— ìœ„ì¹˜í•˜ê³  ìˆëŠ” Controller(ì´í•˜ ì»¨íŠ¸ë¡¤ëŸ¬)ë¼ëŠ” ë ˆì´ì–´ë¥¼ ë§Œë“¤ê²Œ ëœë‹¤. ê·¸ëŸ´ë•Œë©´ ì‚¬ìš©ìê°€ ì–´ë–¤ ìš”ì²­(Request)ì„ í•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ í™•ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡  í™•ì¸ì„ ì•ˆí•´ë„ ë¬´ë°©í•˜ì§€ë§Œ ê°€ê¸‰ì  ë¡œê¹…ì€ ì‹œìŠ¤í…œ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ìµœëŒ€í•œ ë‹¤ì–‘í•˜ê²Œ ë¯¸ë¦¬ í•´ë‘ëŠ”ê²Œ ë‚˜ì¤‘ì— ìœ ì§€ë³´ìˆ˜ì‹œ í¸í•  ìˆ˜ ìˆë‹¤. (ì˜ˆì „ ì¡°ì§ì¥ë‹˜ê»˜ì„œ ë§ì”€í•˜ì‹ ê²Œ ì•„ì§ë„ ë¨¸ë¦¿ì†ì— ê½‰ ìë¦¬ì¡ê³  ìˆë‹¤â€¦) ì•„~ì£¼ ì¼ë°˜ì ìœ¼ë¡œ, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ì§ì ‘ ë¡œê¹…í•˜ê²Œ ëœë‹¤.
@Slf4j @RestController public class SampleController { @GetMapping("/test1") public String test1(@RequestParam String id) { log.info("id : {}", id); return "length : " + id.length(); } } ì´ë ‡ê²Œ ë˜ë©´ ì‚¬ìš©ìê°€ GET /test1 ì´ë¼ëŠ” ìš”ì²­ì„ ë³´ë‚¼ë•Œ ì–´ë–¤ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œí•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ ë¡œê¹…ì´ ë‚¨ê²Œ ë˜ëŠ”ë° í•­ìƒ log.info("id : {}", id); ê³¼ ê°™ì´ ìˆ˜ë™ìœ¼ë¡œ ë¡œê¹…ì„ ë‚¨ê²¨ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìƒê¸´ë‹¤. ë¬¼ë¡  ê¼¼ê¼¼í•˜ê²Œ ë©”ì†Œë“œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì£¼ë©´ ì „í˜€ ë¬¸ì œë ê²Œ ì—†ì§€ë§Œ ì´ëŸ¬í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ~ ë©”ì†Œë“œê°€ í•œë‘ê°œê°€ ì•„ë‹Œ ìˆ˜ì‹­ ë˜ëŠ” ìˆ˜ë°±ê°œì¼ ê²½ìš°ì—” ê·¸ë•Œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ë˜í•œ ìì¹« ê¹œë°•í•˜ê³  ë¡œê¹…ì„ ë¹¼ë¨¹ê³  ë°°í¬ë¥¼ í•˜ê²Œ ëœ ê²½ìš° ëª¨ë‹ˆí„°ë§ì‹œ ë¡œê¹…ì„ í•˜ì§€ ì•Šì•„ì„œ ë‹¤ì‹œ ë¡œê¹…í•˜ê³  ë°°í¬ë¥¼ í•˜ëŠ”, ë³„ê²ƒë„ ì•„ë‹Œë°(?) â€œì •ë§ ë¶ˆí¸í•œâ€ ìƒí™©ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§ í•˜ê¸° ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ ì½”ë“œë¥¼ ì‘ì„±í•´ê°€ë©° ë¡œê¹…ì„ í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ HttpServletRequestWrapper ë¼ëŠ” ê²ƒê³¼ Filter, AOPë¥¼ ì´ìš©í•˜ì—¬ Requestì˜ ì •ë³´ë¥¼ í•œê³³ì—ì„œ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•œë‹¤.
ìš”êµ¬ì‚¬í•­ ì™€ ê°œë°œí•˜ìì•„!
ì¶œì²˜ : https://gfycat.com/ko/brightevilaoudad íˆ¬ìš°ì‚¬ê°€ í”ë“œëŠ” ë¹¨ê°„ ì²œì„ ë³´ë©° ëŒì§„í•˜ëŠ” í™©ì†Œì²˜ëŸ¼ (ì“°ê³ ë³´ë‹ˆ ë„ˆë¬´ TMI ê°™ë‹¤â€¦.) ë‹¹ì¥ ì½”ë”©ì„ ì‹œì‘í•˜ë©° ê°œë°œì„ í•  ìˆ˜ë„ ìˆì§€ë§Œ ì •ì‘ ì›í•˜ëŠ” ê¸°ëŠ¥ì´ ë¬´ì—‡ì¸ì§€ ì²œì²œíˆ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°ˆ í•„ìš”ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤. (ì–´ì©”ë• ì˜¤íˆë ¤ í›„ìê°€ ë” ë¹ ë¥¸ ê°œë°œì„ í•˜ê²Œ ë˜ëŠ”ê²ƒ ê°™ë‹¤.)
GET, POST ë“± ë‹¤ì–‘í•œ http method ë¡œ êµ¬í˜„ëœ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŒŒë¼ë¯¸í„°ì™€ ê¸°íƒ€ Request ì •ë³´ê°€ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬, ë©”ì†Œë“œê°€ ëŠ˜ì–´ë‚ ë•Œë§ˆë‹¤ ë³„ë„ì˜ ì½”ë“œ ì¶”ê°€ ì—†ì´ í•œê³³ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤. URL ì¤‘ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë¡œê¹…ì„ í•˜ê±°ë‚˜, ë¡œê¹…ì—ì„œ ì œì™¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì•ì„œ ë§í–ˆë“¯ ë‹¤ë¥¸ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•œë‹¤. êµ¬í˜„í•˜ê¸° - Request ì˜ íŒŒë¼ë¯¸í„° ì •ë¦¬ Request ì˜ ëª¨ë“  ë¡œê¹…ì„ í•œê³³ì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ filter(í•„í„°)ë¥¼ í™œìš©í•˜ì˜€ë‹¤. í•„í„°ëŠ” Dispatcher servletì˜ ì•ë‹¨ì— ìœ„ì¹˜í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ëª¨ë“  ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë° ìš©ì´í•˜ë‹¤. ë¬¼ë¡  ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•´ì„œë„ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ë³¸ í¬ìŠ¤íŒ… ì—ì„œëŠ” í•„í„°ë¥¼ í™œìš©í•´ì„œ êµ¬í˜„í•˜ëŠ”ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤. (ì‚¬ì‹¤ ì¸í„°ì…‰í„°ë¡œ ëª‡ë²ˆ ì‹œë„í•´ë³´ë‹¤ê°€ ì‹¤íŒ¨í•´ì„œâ€¦ìœ ìœ  )
Spring MVC Request Life Cycle
ì¶œì²˜ : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/ Filterë¥¼ ë§Œë“¤ê¸° ì „ì— Filterì—ì„œ ì‚¬ìš©í•  ì£¼ìš” í•µì‹¬(?) í´ë˜ìŠ¤ê°€ í•„ìš”í•œë° HttpServletRequest ë¥¼ Wrapping í•´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ HttpServletRequestWrapperë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì. Request ì— ë‹´ê²¨ìˆëŠ” param ê³¼ bodyë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ê²½ìš° bodyì— ìˆëŠ” ë‚´ìš©ì„ param ì— ë‹´ëŠ” ë¡œì§ì´ë‹¤. ì£¼ìš” ì„¤ëª…ì€ ì½”ë“œ ì•ˆì—ì„œ ì£¼ì„ìœ¼ë¡œ ì„¤ëª…í•˜ê² ë‹¤.
public class ReadableRequestWrapper extends HttpServletRequestWrapper { // ìƒì† private final Charset encoding; private byte[] rawData; private Map<String, String[]> params = new HashMap<>(); public ReadableRequestWrapper(HttpServletRequest request) { super(request); this.params.putAll(request.getParameterMap()); // ì›ë˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥ String charEncoding = request.getCharacterEncoding(); // ì¸ì½”ë”© ì„¤ì • this.encoding = StringUtils.isBlank(charEncoding) ? StandardCharsets.UTF_8 : Charset.forName(charEncoding); try { InputStream is = request.getInputStream(); this.rawData = IOUtils.toByteArray(is); // InputStream ì„ ë³„ë„ë¡œ ì €ì¥í•œ ë‹¤ìŒ getReader() ì—ì„œ ìƒˆ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ìƒì„± // body íŒŒì‹± String collect = this.getReader().lines().collect(Collectors.joining(System.lineSeparator())); if (StringUtils.isEmpty(collect)) { // body ê°€ ì—†ì„ê²½ìš° ë¡œê¹… ì œì™¸ return; } if (request.getContentType() != null && request.getContentType().contains( ContentType.MULTIPART_FORM_DATA.getMimeType())) { // íŒŒì¼ ì—…ë¡œë“œì‹œ ë¡œê¹…ì œì™¸ return; } JSONParser jsonParser = new JSONParser(); Object parse = jsonParser.parse(collect); if (parse instanceof JSONArray) { JSONArray jsonArray = (JSONArray)jsonParser.parse(collect); setParameter("requestBody", jsonArray.toJSONString()); } else { JSONObject jsonObject = (JSONObject)jsonParser.parse(collect); Iterator iterator = jsonObject.keySet().iterator(); while (iterator.hasNext()) { String key = (String)iterator.next(); setParameter(key, jsonObject.get(key).toString().replace("\"", "\\\"")); } } } catch (Exception e) { log.error("ReadableRequestWrapper init error", e); } } @Override public String getParameter(String name) { String[] paramArray = getParameterValues(name); if (paramArray != null && paramArray.length > 0) { return paramArray[0]; } else { return null; } } @Override public Map<String, String[]> getParameterMap() { return Collections.unmodifiableMap(params); } @Override public Enumeration<String> getParameterNames() { return Collections.enumeration(params.keySet()); } @Override public String[] getParameterValues(String name) { String[] result = null; String[] dummyParamValue = params.get(name); if (dummyParamValue != null) { result = new String[dummyParamValue.length]; System.arraycopy(dummyParamValue, 0, result, 0, dummyParamValue.length); } return result; } public void setParameter(String name, String value) { String[] param = {value}; setParameter(name, param); } public void setParameter(String name, String[] values) { params.put(name, values); } @Override public ServletInputStream getInputStream() { final ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(this.rawData); return new ServletInputStream() { @Override public boolean isFinished() { return false; } @Override public boolean isReady() { return false; } @Override public void setReadListener(ReadListener readListener) { // Do nothing } public int read() { return byteArrayInputStream.read(); } }; } @Override public BufferedReader getReader() { return new BufferedReader(new InputStreamReader(this.getInputStream(), this.encoding)); } } ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ IOUtils.toByteArray(is) ìš” ë¶€ë¶„ì¸ë°, InputStreamì€ í•œë²ˆë°–ì— ì½ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì´ í•„í„°ì—ì„œ ìŠ¤íŠ¸ë¦¼ì„ ì½ëŠ” ëŒ€ì‹ , ë˜í¼ êµ¬í˜„ìœ¼ë¡œ ìƒˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±í•˜ë„ë¡ ì‘ì—…ì„ í•˜ì˜€ë‹¤. ìì¹« ì˜ëª»í•˜ë‹¤ê°„ bodyì˜ ë‚´ìš©ì´ ìœ ì‹¤ë  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ì°¸ì¡° : http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-30T18:39:47+00:00"><meta property="article:modified_time" content="2019-06-30T18:39:47+00:00"><meta property="article:tag" content="Spring"><meta property="article:tag" content="Logging"><meta property="article:tag" content="HttpServletRequestWrapper"><meta property="article:tag" content="Filter"><meta property="article:tag" content="AOP"><meta property="article:tag" content="Archives-2019"><meta property="og:image" content="https://taetaetae.github.io/images/controller-common-logging/spring_boot_logging.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/controller-common-logging/spring_boot_logging.png"><meta name=twitter:title content="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°"><meta name=twitter:description content='ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë‹¤ ë³´ë©´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ë§¨ ì²˜ìŒì— ìœ„ì¹˜í•˜ê³  ìˆëŠ” Controller(ì´í•˜ ì»¨íŠ¸ë¡¤ëŸ¬)ë¼ëŠ” ë ˆì´ì–´ë¥¼ ë§Œë“¤ê²Œ ëœë‹¤. ê·¸ëŸ´ë•Œë©´ ì‚¬ìš©ìê°€ ì–´ë–¤ ìš”ì²­(Request)ì„ í•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ í™•ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡  í™•ì¸ì„ ì•ˆí•´ë„ ë¬´ë°©í•˜ì§€ë§Œ ê°€ê¸‰ì  ë¡œê¹…ì€ ì‹œìŠ¤í…œ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ìµœëŒ€í•œ ë‹¤ì–‘í•˜ê²Œ ë¯¸ë¦¬ í•´ë‘ëŠ”ê²Œ ë‚˜ì¤‘ì— ìœ ì§€ë³´ìˆ˜ì‹œ í¸í•  ìˆ˜ ìˆë‹¤. (ì˜ˆì „ ì¡°ì§ì¥ë‹˜ê»˜ì„œ ë§ì”€í•˜ì‹ ê²Œ ì•„ì§ë„ ë¨¸ë¦¿ì†ì— ê½‰ ìë¦¬ì¡ê³  ìˆë‹¤â€¦) ì•„~ì£¼ ì¼ë°˜ì ìœ¼ë¡œ, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ì§ì ‘ ë¡œê¹…í•˜ê²Œ ëœë‹¤.
@Slf4j @RestController public class SampleController { @GetMapping("/test1") public String test1(@RequestParam String id) { log.info("id : {}", id); return "length : " + id.length(); } } ì´ë ‡ê²Œ ë˜ë©´ ì‚¬ìš©ìê°€ GET /test1 ì´ë¼ëŠ” ìš”ì²­ì„ ë³´ë‚¼ë•Œ ì–´ë–¤ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œí•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ ë¡œê¹…ì´ ë‚¨ê²Œ ë˜ëŠ”ë° í•­ìƒ log.info("id : {}", id); ê³¼ ê°™ì´ ìˆ˜ë™ìœ¼ë¡œ ë¡œê¹…ì„ ë‚¨ê²¨ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìƒê¸´ë‹¤. ë¬¼ë¡  ê¼¼ê¼¼í•˜ê²Œ ë©”ì†Œë“œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì£¼ë©´ ì „í˜€ ë¬¸ì œë ê²Œ ì—†ì§€ë§Œ ì´ëŸ¬í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ~ ë©”ì†Œë“œê°€ í•œë‘ê°œê°€ ì•„ë‹Œ ìˆ˜ì‹­ ë˜ëŠ” ìˆ˜ë°±ê°œì¼ ê²½ìš°ì—” ê·¸ë•Œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ë˜í•œ ìì¹« ê¹œë°•í•˜ê³  ë¡œê¹…ì„ ë¹¼ë¨¹ê³  ë°°í¬ë¥¼ í•˜ê²Œ ëœ ê²½ìš° ëª¨ë‹ˆí„°ë§ì‹œ ë¡œê¹…ì„ í•˜ì§€ ì•Šì•„ì„œ ë‹¤ì‹œ ë¡œê¹…í•˜ê³  ë°°í¬ë¥¼ í•˜ëŠ”, ë³„ê²ƒë„ ì•„ë‹Œë°(?) â€œì •ë§ ë¶ˆí¸í•œâ€ ìƒí™©ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§ í•˜ê¸° ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ ì½”ë“œë¥¼ ì‘ì„±í•´ê°€ë©° ë¡œê¹…ì„ í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ HttpServletRequestWrapper ë¼ëŠ” ê²ƒê³¼ Filter, AOPë¥¼ ì´ìš©í•˜ì—¬ Requestì˜ ì •ë³´ë¥¼ í•œê³³ì—ì„œ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•œë‹¤.
ìš”êµ¬ì‚¬í•­ ì™€ ê°œë°œí•˜ìì•„!
ì¶œì²˜ : https://gfycat.com/ko/brightevilaoudad íˆ¬ìš°ì‚¬ê°€ í”ë“œëŠ” ë¹¨ê°„ ì²œì„ ë³´ë©° ëŒì§„í•˜ëŠ” í™©ì†Œì²˜ëŸ¼ (ì“°ê³ ë³´ë‹ˆ ë„ˆë¬´ TMI ê°™ë‹¤â€¦.) ë‹¹ì¥ ì½”ë”©ì„ ì‹œì‘í•˜ë©° ê°œë°œì„ í•  ìˆ˜ë„ ìˆì§€ë§Œ ì •ì‘ ì›í•˜ëŠ” ê¸°ëŠ¥ì´ ë¬´ì—‡ì¸ì§€ ì²œì²œíˆ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°ˆ í•„ìš”ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤. (ì–´ì©”ë• ì˜¤íˆë ¤ í›„ìê°€ ë” ë¹ ë¥¸ ê°œë°œì„ í•˜ê²Œ ë˜ëŠ”ê²ƒ ê°™ë‹¤.)
GET, POST ë“± ë‹¤ì–‘í•œ http method ë¡œ êµ¬í˜„ëœ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŒŒë¼ë¯¸í„°ì™€ ê¸°íƒ€ Request ì •ë³´ê°€ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬, ë©”ì†Œë“œê°€ ëŠ˜ì–´ë‚ ë•Œë§ˆë‹¤ ë³„ë„ì˜ ì½”ë“œ ì¶”ê°€ ì—†ì´ í•œê³³ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤. URL ì¤‘ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë¡œê¹…ì„ í•˜ê±°ë‚˜, ë¡œê¹…ì—ì„œ ì œì™¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì•ì„œ ë§í–ˆë“¯ ë‹¤ë¥¸ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•œë‹¤. êµ¬í˜„í•˜ê¸° - Request ì˜ íŒŒë¼ë¯¸í„° ì •ë¦¬ Request ì˜ ëª¨ë“  ë¡œê¹…ì„ í•œê³³ì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ filter(í•„í„°)ë¥¼ í™œìš©í•˜ì˜€ë‹¤. í•„í„°ëŠ” Dispatcher servletì˜ ì•ë‹¨ì— ìœ„ì¹˜í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ëª¨ë“  ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë° ìš©ì´í•˜ë‹¤. ë¬¼ë¡  ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•´ì„œë„ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ë³¸ í¬ìŠ¤íŒ… ì—ì„œëŠ” í•„í„°ë¥¼ í™œìš©í•´ì„œ êµ¬í˜„í•˜ëŠ”ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤. (ì‚¬ì‹¤ ì¸í„°ì…‰í„°ë¡œ ëª‡ë²ˆ ì‹œë„í•´ë³´ë‹¤ê°€ ì‹¤íŒ¨í•´ì„œâ€¦ìœ ìœ  )
Spring MVC Request Life Cycle
ì¶œì²˜ : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/ Filterë¥¼ ë§Œë“¤ê¸° ì „ì— Filterì—ì„œ ì‚¬ìš©í•  ì£¼ìš” í•µì‹¬(?) í´ë˜ìŠ¤ê°€ í•„ìš”í•œë° HttpServletRequest ë¥¼ Wrapping í•´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ HttpServletRequestWrapperë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì. Request ì— ë‹´ê²¨ìˆëŠ” param ê³¼ bodyë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ê²½ìš° bodyì— ìˆëŠ” ë‚´ìš©ì„ param ì— ë‹´ëŠ” ë¡œì§ì´ë‹¤. ì£¼ìš” ì„¤ëª…ì€ ì½”ë“œ ì•ˆì—ì„œ ì£¼ì„ìœ¼ë¡œ ì„¤ëª…í•˜ê² ë‹¤.
public class ReadableRequestWrapper extends HttpServletRequestWrapper { // ìƒì† private final Charset encoding; private byte[] rawData; private Map<String, String[]> params = new HashMap<>(); public ReadableRequestWrapper(HttpServletRequest request) { super(request); this.params.putAll(request.getParameterMap()); // ì›ë˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥ String charEncoding = request.getCharacterEncoding(); // ì¸ì½”ë”© ì„¤ì • this.encoding = StringUtils.isBlank(charEncoding) ? StandardCharsets.UTF_8 : Charset.forName(charEncoding); try { InputStream is = request.getInputStream(); this.rawData = IOUtils.toByteArray(is); // InputStream ì„ ë³„ë„ë¡œ ì €ì¥í•œ ë‹¤ìŒ getReader() ì—ì„œ ìƒˆ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ìƒì„± // body íŒŒì‹± String collect = this.getReader().lines().collect(Collectors.joining(System.lineSeparator())); if (StringUtils.isEmpty(collect)) { // body ê°€ ì—†ì„ê²½ìš° ë¡œê¹… ì œì™¸ return; } if (request.getContentType() != null && request.getContentType().contains( ContentType.MULTIPART_FORM_DATA.getMimeType())) { // íŒŒì¼ ì—…ë¡œë“œì‹œ ë¡œê¹…ì œì™¸ return; } JSONParser jsonParser = new JSONParser(); Object parse = jsonParser.parse(collect); if (parse instanceof JSONArray) { JSONArray jsonArray = (JSONArray)jsonParser.parse(collect); setParameter("requestBody", jsonArray.toJSONString()); } else { JSONObject jsonObject = (JSONObject)jsonParser.parse(collect); Iterator iterator = jsonObject.keySet().iterator(); while (iterator.hasNext()) { String key = (String)iterator.next(); setParameter(key, jsonObject.get(key).toString().replace("\"", "\\\"")); } } } catch (Exception e) { log.error("ReadableRequestWrapper init error", e); } } @Override public String getParameter(String name) { String[] paramArray = getParameterValues(name); if (paramArray != null && paramArray.length > 0) { return paramArray[0]; } else { return null; } } @Override public Map<String, String[]> getParameterMap() { return Collections.unmodifiableMap(params); } @Override public Enumeration<String> getParameterNames() { return Collections.enumeration(params.keySet()); } @Override public String[] getParameterValues(String name) { String[] result = null; String[] dummyParamValue = params.get(name); if (dummyParamValue != null) { result = new String[dummyParamValue.length]; System.arraycopy(dummyParamValue, 0, result, 0, dummyParamValue.length); } return result; } public void setParameter(String name, String value) { String[] param = {value}; setParameter(name, param); } public void setParameter(String name, String[] values) { params.put(name, values); } @Override public ServletInputStream getInputStream() { final ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(this.rawData); return new ServletInputStream() { @Override public boolean isFinished() { return false; } @Override public boolean isReady() { return false; } @Override public void setReadListener(ReadListener readListener) { // Do nothing } public int read() { return byteArrayInputStream.read(); } }; } @Override public BufferedReader getReader() { return new BufferedReader(new InputStreamReader(this.getInputStream(), this.encoding)); } } ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ IOUtils.toByteArray(is) ìš” ë¶€ë¶„ì¸ë°, InputStreamì€ í•œë²ˆë°–ì— ì½ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì´ í•„í„°ì—ì„œ ìŠ¤íŠ¸ë¦¼ì„ ì½ëŠ” ëŒ€ì‹ , ë˜í¼ êµ¬í˜„ìœ¼ë¡œ ìƒˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±í•˜ë„ë¡ ì‘ì—…ì„ í•˜ì˜€ë‹¤. ìì¹« ì˜ëª»í•˜ë‹¤ê°„ bodyì˜ ë‚´ìš©ì´ ìœ ì‹¤ë  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ì°¸ì¡° : http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge'><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2019/06/30/controller-common-logging/><link rel=prev href=https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/><link rel=next href=https://taetaetae.github.io/2019/07/07/review-first-half-2019/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2019\/06\/30\/controller-common-logging\/"},"genre":"posts","keywords":"spring, logging, HttpServletRequestWrapper, Filter, AOP, archives-2019","wordcount":1215,"url":"https:\/\/taetaetae.github.io\/2019\/06\/30\/controller-common-logging\/","datePublished":"2019-06-30T18:39:47+00:00","dateModified":"2019-06-30T18:39:47+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"íƒœíƒœíƒœ"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>íƒœíƒœíƒœ</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw" aria-hidden=true></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2019-06-30>2019-06-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1215 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/spring_boot_logging.png data-srcset="/images/controller-common-logging/spring_boot_logging.png, /images/controller-common-logging/spring_boot_logging.png 1.5x, /images/controller-common-logging/spring_boot_logging.png 2x" data-sizes=auto alt=/images/controller-common-logging/spring_boot_logging.png title=/images/controller-common-logging/spring_boot_logging.png></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#ìš”êµ¬ì‚¬í•­>ìš”êµ¬ì‚¬í•­</a></li><li><a href=#êµ¬í˜„í•˜ê¸°---request-ì˜-íŒŒë¼ë¯¸í„°-ì •ë¦¬>êµ¬í˜„í•˜ê¸° - Request ì˜ íŒŒë¼ë¯¸í„° ì •ë¦¬</a></li><li><a href=#êµ¬í˜„í•˜ê¸°---ì»¨íŠ¸ë¡¤ëŸ¬ì—-aop-ì…‹íŒ…>êµ¬í˜„í•˜ê¸° - ì»¨íŠ¸ë¡¤ëŸ¬ì— AOP ì…‹íŒ…</a></li><li><a href=#ë§ˆì¹˜ë©°>ë§ˆì¹˜ë©°</a></li></ul></nav></div></div><div class=content id=content><p>ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë‹¤ ë³´ë©´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ë§¨ ì²˜ìŒì— ìœ„ì¹˜í•˜ê³  ìˆëŠ” <code>Controller</code>(ì´í•˜ ì»¨íŠ¸ë¡¤ëŸ¬)ë¼ëŠ” ë ˆì´ì–´ë¥¼ ë§Œë“¤ê²Œ ëœë‹¤. ê·¸ëŸ´ë•Œë©´ ì‚¬ìš©ìê°€ ì–´ë–¤ ìš”ì²­(Request)ì„ í•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ í™•ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡  í™•ì¸ì„ ì•ˆí•´ë„ ë¬´ë°©í•˜ì§€ë§Œ ê°€ê¸‰ì  ë¡œê¹…ì€ ì‹œìŠ¤í…œ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ìµœëŒ€í•œ ë‹¤ì–‘í•˜ê²Œ <code>ë¯¸ë¦¬</code> í•´ë‘ëŠ”ê²Œ ë‚˜ì¤‘ì— ìœ ì§€ë³´ìˆ˜ì‹œ í¸í•  ìˆ˜ ìˆë‹¤. (ì˜ˆì „ ì¡°ì§ì¥ë‹˜ê»˜ì„œ ë§ì”€í•˜ì‹ ê²Œ ì•„ì§ë„ ë¨¸ë¦¿ì†ì— ê½‰ ìë¦¬ì¡ê³  ìˆë‹¤&mldr;)
ì•„~ì£¼ ì¼ë°˜ì ìœ¼ë¡œ, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ì§ì ‘ ë¡œê¹…í•˜ê²Œ ëœë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SampleController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/test1&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>test1</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;id : {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=s>&#34;length : &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>id</span><span class=p>.</span><span class=na>length</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ì´ë ‡ê²Œ ë˜ë©´ ì‚¬ìš©ìê°€ <code>GET /test1</code> ì´ë¼ëŠ” ìš”ì²­ì„ ë³´ë‚¼ë•Œ ì–´ë–¤ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œí•˜ì˜€ëŠ”ì§€ì— ëŒ€í•´ ë¡œê¹…ì´ ë‚¨ê²Œ ë˜ëŠ”ë° í•­ìƒ <code>log.info("id : {}", id);</code> ê³¼ ê°™ì´ ìˆ˜ë™ìœ¼ë¡œ ë¡œê¹…ì„ ë‚¨ê²¨ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìƒê¸´ë‹¤. ë¬¼ë¡  ê¼¼ê¼¼í•˜ê²Œ ë©”ì†Œë“œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì£¼ë©´ ì „í˜€ ë¬¸ì œë ê²Œ ì—†ì§€ë§Œ ì´ëŸ¬í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ~ ë©”ì†Œë“œê°€ í•œë‘ê°œê°€ ì•„ë‹Œ ìˆ˜ì‹­ ë˜ëŠ” ìˆ˜ë°±ê°œì¼ ê²½ìš°ì—” ê·¸ë•Œë§ˆë‹¤ ë¡œê¹…ì„ ì ì–´ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆì„ ìˆ˜ ìˆë‹¤. ë˜í•œ ìì¹« ê¹œë°•í•˜ê³  ë¡œê¹…ì„ ë¹¼ë¨¹ê³  ë°°í¬ë¥¼ í•˜ê²Œ ëœ ê²½ìš° ëª¨ë‹ˆí„°ë§ì‹œ ë¡œê¹…ì„ í•˜ì§€ ì•Šì•„ì„œ ë‹¤ì‹œ ë¡œê¹…í•˜ê³  ë°°í¬ë¥¼ í•˜ëŠ”, ë³„ê²ƒë„ ì•„ë‹Œë°(?) &ldquo;ì •ë§ ë¶ˆí¸í•œ&rdquo; ìƒí™©ì´ ìˆì„ ìˆ˜ ìˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§ í•˜ê¸° ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ ì½”ë“œë¥¼ ì‘ì„±í•´ê°€ë©° ë¡œê¹…ì„ í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ <code>HttpServletRequestWrapper</code> ë¼ëŠ” ê²ƒê³¼ <code>Filter</code>, <code>AOP</code>ë¥¼ ì´ìš©í•˜ì—¬ <strong>Requestì˜ ì •ë³´ë¥¼ í•œê³³ì—ì„œ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ëŠ” ë°©ë²•</strong>ì— ëŒ€í•´ ì•Œì•„ë³´ê³ ì í•œë‹¤.</p><h2 id=ìš”êµ¬ì‚¬í•­>ìš”êµ¬ì‚¬í•­</h2><figure><a class=lightgallery href=/images/controller-common-logging/bull_fighting.gif title=/images/controller-common-logging/bull_fighting.gif data-thumbnail=/images/controller-common-logging/bull_fighting.gif data-sub-html="<h2>ì™€ ê°œë°œí•˜ìì•„!ì¶œì²˜ : https://gfycat.com/ko/brightevilaoudad</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/bull_fighting.gif data-srcset="/images/controller-common-logging/bull_fighting.gif, /images/controller-common-logging/bull_fighting.gif 1.5x, /images/controller-common-logging/bull_fighting.gif 2x" data-sizes=auto alt=/images/controller-common-logging/bull_fighting.gif width=80%></a><figcaption class=image-caption>ì™€ ê°œë°œí•˜ìì•„!<br>ì¶œì²˜ : <a href=https://gfycat.com/ko/brightevilaoudad target=_blank rel="noopener noreffer">https://gfycat.com/ko/brightevilaoudad</a></figcaption></figure><p>íˆ¬ìš°ì‚¬ê°€ í”ë“œëŠ” ë¹¨ê°„ ì²œì„ ë³´ë©° ëŒì§„í•˜ëŠ” í™©ì†Œì²˜ëŸ¼ (ì“°ê³ ë³´ë‹ˆ ë„ˆë¬´ TMI ê°™ë‹¤&mldr;.) ë‹¹ì¥ ì½”ë”©ì„ ì‹œì‘í•˜ë©° ê°œë°œì„ í•  ìˆ˜ë„ ìˆì§€ë§Œ ì •ì‘ ì›í•˜ëŠ” ê¸°ëŠ¥ì´ ë¬´ì—‡ì¸ì§€ ì²œì²œíˆ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°ˆ í•„ìš”ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤. (ì–´ì©”ë• ì˜¤íˆë ¤ í›„ìê°€ ë” ë¹ ë¥¸ ê°œë°œì„ í•˜ê²Œ ë˜ëŠ”ê²ƒ ê°™ë‹¤.)</p><ol><li>GET, POST ë“± ë‹¤ì–‘í•œ http method ë¡œ êµ¬í˜„ëœ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŒŒë¼ë¯¸í„°ì™€ ê¸°íƒ€ Request ì •ë³´ê°€ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤.</li><li>ì»¨íŠ¸ë¡¤ëŸ¬, ë©”ì†Œë“œê°€ ëŠ˜ì–´ë‚ ë•Œë§ˆë‹¤ ë³„ë„ì˜ ì½”ë“œ ì¶”ê°€ ì—†ì´ í•œê³³ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë¡œê¹…ì´ ë˜ì•¼ í•œë‹¤.</li><li>URL ì¤‘ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë¡œê¹…ì„ í•˜ê±°ë‚˜, ë¡œê¹…ì—ì„œ ì œì™¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.</li><li>ì•ì„œ ë§í–ˆë“¯ ë‹¤ë¥¸ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ í•œë‹¤.</li></ol><h2 id=êµ¬í˜„í•˜ê¸°---request-ì˜-íŒŒë¼ë¯¸í„°-ì •ë¦¬>êµ¬í˜„í•˜ê¸° - Request ì˜ íŒŒë¼ë¯¸í„° ì •ë¦¬</h2><p>Request ì˜ ëª¨ë“  ë¡œê¹…ì„ í•œê³³ì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ filter(í•„í„°)ë¥¼ í™œìš©í•˜ì˜€ë‹¤. í•„í„°ëŠ” Dispatcher servletì˜ ì•ë‹¨ì— ìœ„ì¹˜í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ëª¨ë“  ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë° ìš©ì´í•˜ë‹¤. ë¬¼ë¡  ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•´ì„œë„ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ë³¸ í¬ìŠ¤íŒ… ì—ì„œëŠ” í•„í„°ë¥¼ í™œìš©í•´ì„œ êµ¬í˜„í•˜ëŠ”ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤. (ì‚¬ì‹¤ ì¸í„°ì…‰í„°ë¡œ ëª‡ë²ˆ ì‹œë„í•´ë³´ë‹¤ê°€ ì‹¤íŒ¨í•´ì„œ&mldr;ìœ ìœ  )</p><figure><a class=lightgallery href=/images/controller-common-logging/spring-request-lifecycle.jpg title=/images/controller-common-logging/spring-request-lifecycle.jpg data-thumbnail=/images/controller-common-logging/spring-request-lifecycle.jpg data-sub-html="<h2>Spring MVC Request Life Cycleì¶œì²˜ : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/spring-request-lifecycle.jpg data-srcset="/images/controller-common-logging/spring-request-lifecycle.jpg, /images/controller-common-logging/spring-request-lifecycle.jpg 1.5x, /images/controller-common-logging/spring-request-lifecycle.jpg 2x" data-sizes=auto alt=/images/controller-common-logging/spring-request-lifecycle.jpg width=80%></a><figcaption class=image-caption>Spring MVC Request Life Cycle<br>ì¶œì²˜ : <a href=https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/ target=_blank rel="noopener noreffer">https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</a></figcaption></figure><p>Filterë¥¼ ë§Œë“¤ê¸° ì „ì— Filterì—ì„œ ì‚¬ìš©í•  ì£¼ìš” í•µì‹¬(?) í´ë˜ìŠ¤ê°€ í•„ìš”í•œë° <code>HttpServletRequest</code> ë¥¼ Wrapping í•´ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <code>HttpServletRequestWrapper</code>ë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì. Request ì— ë‹´ê²¨ìˆëŠ” param ê³¼ bodyë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ê²½ìš° bodyì— ìˆëŠ” ë‚´ìš©ì„ param ì— ë‹´ëŠ” ë¡œì§ì´ë‹¤. ì£¼ìš” ì„¤ëª…ì€ ì½”ë“œ ì•ˆì—ì„œ ì£¼ì„ìœ¼ë¡œ ì„¤ëª…í•˜ê² ë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReadableRequestWrapper</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>HttpServletRequestWrapper</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// ìƒì†</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Charset</span><span class=w> </span><span class=n>encoding</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>rawData</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=nf>ReadableRequestWrapper</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=kd>super</span><span class=p>(</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>this</span><span class=p>.</span><span class=na>params</span><span class=p>.</span><span class=na>putAll</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getParameterMap</span><span class=p>());</span><span class=w> </span><span class=c1>// ì›ë˜ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>String</span><span class=w> </span><span class=n>charEncoding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getCharacterEncoding</span><span class=p>();</span><span class=w> </span><span class=c1>// ì¸ì½”ë”© ì„¤ì •</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>this</span><span class=p>.</span><span class=na>encoding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StringUtils</span><span class=p>.</span><span class=na>isBlank</span><span class=p>(</span><span class=n>charEncoding</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>StandardCharsets</span><span class=p>.</span><span class=na>UTF_8</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>Charset</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>charEncoding</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>InputStream</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>this</span><span class=p>.</span><span class=na>rawData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IOUtils</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>(</span><span class=n>is</span><span class=p>);</span><span class=w> </span><span class=c1>// InputStream ì„ ë³„ë„ë¡œ ì €ì¥í•œ ë‹¤ìŒ getReader() ì—ì„œ ìƒˆ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ìƒì„±</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=c1>// body íŒŒì‹±</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>String</span><span class=w> </span><span class=n>collect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getReader</span><span class=p>().</span><span class=na>lines</span><span class=p>().</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>lineSeparator</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>(</span><span class=n>collect</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// body ê°€ ì—†ì„ê²½ìš° ë¡œê¹… ì œì™¸</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getContentType</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getContentType</span><span class=p>().</span><span class=na>contains</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>ContentType</span><span class=p>.</span><span class=na>MULTIPART_FORM_DATA</span><span class=p>.</span><span class=na>getMimeType</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// íŒŒì¼ ì—…ë¡œë“œì‹œ ë¡œê¹…ì œì™¸</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>JSONParser</span><span class=w> </span><span class=n>jsonParser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JSONParser</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>Object</span><span class=w> </span><span class=n>parse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jsonParser</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=n>collect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>parse</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>JSONArray</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>JSONArray</span><span class=w> </span><span class=n>jsonArray</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>JSONArray</span><span class=p>)</span><span class=n>jsonParser</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=n>collect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>setParameter</span><span class=p>(</span><span class=s>&#34;requestBody&#34;</span><span class=p>,</span><span class=w> </span><span class=n>jsonArray</span><span class=p>.</span><span class=na>toJSONString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>JSONObject</span><span class=p>)</span><span class=n>jsonParser</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=n>collect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>Iterator</span><span class=w> </span><span class=n>iterator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>keySet</span><span class=p>().</span><span class=na>iterator</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>iterator</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=n>iterator</span><span class=p>.</span><span class=na>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=n>setParameter</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>).</span><span class=na>toString</span><span class=p>().</span><span class=na>replace</span><span class=p>(</span><span class=s>&#34;\&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;\\\&#34;&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;ReadableRequestWrapper init error&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getParameter</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>paramArray</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getParameterValues</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>paramArray</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>paramArray</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w> </span><span class=n>paramArray</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]&gt;</span><span class=w> </span><span class=nf>getParameterMap</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>unmodifiableMap</span><span class=p>(</span><span class=n>params</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>Enumeration</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getParameterNames</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>enumeration</span><span class=p>(</span><span class=n>params</span><span class=p>.</span><span class=na>keySet</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=nf>getParameterValues</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>dummyParamValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dummyParamValue</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=o>[</span><span class=n>dummyParamValue</span><span class=p>.</span><span class=na>length</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>dummyParamValue</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>dummyParamValue</span><span class=p>.</span><span class=na>length</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setParameter</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>param</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>value</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>setParameter</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>param</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setParameter</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>values</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>values</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>ServletInputStream</span><span class=w> </span><span class=nf>getInputStream</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=kd>final</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=w> </span><span class=n>byteArrayInputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>rawData</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ServletInputStream</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isFinished</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isReady</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setReadListener</span><span class=p>(</span><span class=n>ReadListener</span><span class=w> </span><span class=n>readListener</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=c1>// Do nothing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>read</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>return</span><span class=w> </span><span class=n>byteArrayInputStream</span><span class=p>.</span><span class=na>read</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>BufferedReader</span><span class=w> </span><span class=nf>getReader</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BufferedReader</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>InputStreamReader</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>(),</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>encoding</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ <code>IOUtils.toByteArray(is)</code> ìš” ë¶€ë¶„ì¸ë°, InputStreamì€ í•œë²ˆë°–ì— ì½ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì´ í•„í„°ì—ì„œ ìŠ¤íŠ¸ë¦¼ì„ ì½ëŠ” ëŒ€ì‹ , ë˜í¼ êµ¬í˜„ìœ¼ë¡œ ìƒˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±í•˜ë„ë¡ ì‘ì—…ì„ í•˜ì˜€ë‹¤. ìì¹« ì˜ëª»í•˜ë‹¤ê°„ bodyì˜ ë‚´ìš©ì´ ìœ ì‹¤ë  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
ì°¸ì¡° :
<a href=http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once target=_blank rel="noopener noreffer">http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once</a>
<a href=http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge target=_blank rel="noopener noreffer">http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge</a></p><p>ìœ„ì—ì„œ ë§Œë“  ë˜í¼ í´ë˜ìŠ¤ë¥¼ ì´ì œ í•„í„°ì—ì„œ ì ìš©í•´ë³´ì.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ReadableRequestWrapperFilter</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Filter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>(</span><span class=n>FilterConfig</span><span class=w> </span><span class=n>filterConfig</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Do nothing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>doFilter</span><span class=p>(</span><span class=n>ServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>ServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=n>FilterChain</span><span class=w> </span><span class=n>chain</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=p>,</span><span class=w> </span><span class=n>ServletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>ReadableRequestWrapper</span><span class=w> </span><span class=n>wrapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReadableRequestWrapper</span><span class=p>((</span><span class=n>HttpServletRequest</span><span class=p>)</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>chain</span><span class=p>.</span><span class=na>doFilter</span><span class=p>(</span><span class=n>wrapper</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>destroy</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Do nothing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ì´ë ‡ê²Œ ë˜ë©´ paramìœ¼ë¡œ ë„˜ì–´ì˜¨ íŒŒë¼ë¯¸í„°ë‚˜ bodyë¡œ ë„˜ì–´ì˜¨ ì •ë³´ë“¤ì´ íŒŒì‹±ë˜ì–´ paramì— ë‹´ê¸°ê²Œ ëœë‹¤.
(JSONìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ë¶€ë¶„ì€ ì¡°ê¸ˆ ì§€ì €ë¶„í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´ì„œ ì–»ì€ ê²°ê³¼ë¬¼ì´ë‹¤. ë” ì¢‹ì€ ë°©ì‹ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ PullRequest ë˜ëŠ” ëŒ“ê¸€ í™˜ì˜!)</p><h2 id=êµ¬í˜„í•˜ê¸°---ì»¨íŠ¸ë¡¤ëŸ¬ì—-aop-ì…‹íŒ…>êµ¬í˜„í•˜ê¸° - ì»¨íŠ¸ë¡¤ëŸ¬ì— AOP ì…‹íŒ…</h2><p>ì´ì œ Request ì˜ params ë¥¼ í•œê³³ì—ì„œ ë¡œê¹…í•  ì°¨ë¡€ì´ë‹¤. ë¬¼ë¡  ìœ„ì—ì„œ ë§Œë“  í•„í„°ì—ì„œ ë¡œê¹…ì„ í•´ë„ ë˜ì§€ë§Œ í•„í„°ì— ë¡œì§ì´ ë“¤ì–´ê°€ëŠ” ê²ƒë³´ë‹¤ ë³„ë„ì˜ ë¡œì§ì—ì„œ ì²˜ë¦¬í•˜ëŠ”ê²Œ ë§ë‹¤ê³  ìƒê°ë˜ì–´ ë¶„ë¦¬ë¥¼ í•˜ì˜€ë‹¤. (ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬)
AOPë¥¼ í™œìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ë¡œì§ì„ ì‘ì„±í•˜ì˜€ë‹¤. ì•„ë˜ ë¡œì§ì€ ì´í•´í•˜ê¸°ì— í° ì–´ë ¤ì›€ì€ ì—†ì„ê²ƒ ê°™ì§€ë§Œ ì£¼ì„ìœ¼ë¡œ ì„¤ëª…ì„ í•˜ê² ë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Aspect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LoggerAspect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.taetaetae..*Controller.*(..))&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>// ì´ëŸ° íŒ¨í„´ì´ ì‹¤í–‰ë  ê²½ìš° ìˆ˜í–‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>loggerPointCut</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Around</span><span class=p>(</span><span class=s>&#34;loggerPointCut()&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>methodLogger</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>proceedingJoinPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>proceedingJoinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>ServletRequestAttributes</span><span class=p>)</span><span class=n>RequestContextHolder</span><span class=p>.</span><span class=na>getRequestAttributes</span><span class=p>()).</span><span class=na>getRequest</span><span class=p>();</span><span class=w> </span><span class=c1>// request ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>String</span><span class=w> </span><span class=n>controllerName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>proceedingJoinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getDeclaringType</span><span class=p>().</span><span class=na>getSimpleName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>String</span><span class=w> </span><span class=n>methodName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>proceedingJoinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>().</span><span class=na>getName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;controller&#34;</span><span class=p>,</span><span class=w> </span><span class=n>controllerName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>methodName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;params&#34;</span><span class=p>,</span><span class=w> </span><span class=n>getParams</span><span class=p>(</span><span class=n>request</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;log_time&#34;</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;request_uri&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getRequestURI</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>params</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;http_method&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getMethod</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;LoggerAspect error&#34;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;params : {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>params</span><span class=p>);</span><span class=w> </span><span class=c1>// paramì— ë‹´ê¸´ ì •ë³´ë“¤ì„ í•œë²ˆì— ë¡œê¹…í•œë‹¤.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>throwable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>throw</span><span class=w> </span><span class=n>throwable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>	 * request ì— ë‹´ê¸´ ì •ë³´ë¥¼ JSONObject í˜•íƒœë¡œ ë°˜í™˜í•œë‹¤.
</span></span></span><span class=line><span class=cl><span class=cm>	 * @param request
</span></span></span><span class=line><span class=cl><span class=cm>	 * @return
</span></span></span><span class=line><span class=cl><span class=cm>	 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>JSONObject</span><span class=w> </span><span class=nf>getParams</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JSONObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>Enumeration</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getParameterNames</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>params</span><span class=p>.</span><span class=na>hasMoreElements</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>String</span><span class=w> </span><span class=n>param</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=na>nextElement</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>String</span><span class=w> </span><span class=n>replaceParam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>param</span><span class=p>.</span><span class=na>replaceAll</span><span class=p>(</span><span class=s>&#34;\\.&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;-&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>replaceParam</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>param</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>jsonObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>ìœ„ ì½”ë“œì—ì„œëŠ” ë‹¨ìˆœíˆ console logë¥¼ ì°ì—ˆì§€ë§Œ í•„ìê°€ ìš´ì˜í•˜ê³  ìˆëŠ” ì–´ë“œë¯¼ íˆ´ì—ì„œëŠ” Request ì •ë³´ë¥¼ Elasticsearch ì— ì¸ë±ì‹±í•˜ê³  ì´ë¥¼ í‚¤ë°”ë‚˜ì—ì„œ ë³´ë‹¤ ì‰½ê²Œ ì¡°íšŒ ë° ëª¨ë‹ˆí„°ë§ì´ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤. ë¡œê¹…ì„ ì–´ë–¤ì‹ìœ¼ë¡œ ë‚¨ê¸¸ì§€, ë¡œê¹…ì´ ì•„ë‹Œ íŠ¹ì • ìƒí™©ì—ì„œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤ê±°ë‚˜ ë“±ë“± ì´ ë¶€ë¶„ì€ ì‹¤ì œ êµ¬í˜„ì‹œì— ìƒí™©ì— ë§ì¶°ì„œ ë§Œë“¤ë©´ ë  ê²ƒ ê°™ë‹¤.
ë˜í•œ <code>Pointcut</code> ë¶€ë¶„ì„ ë‹¤ë¥´ê²Œ í™œìš©í•˜ì—¬ ìœ„ì—ì„œ ì´ì•¼ê¸°í•œ ìš”êµ¬ì‚¬í•­ì˜ 3ë²ˆ (URL ì¤‘ íŠ¹ì • íŒ¨í„´ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë¡œê¹…ì„ í•˜ê±°ë‚˜, ë¡œê¹…ì—ì„œ ì œì™¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.) ë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
ì•„ì°¸, AOPì˜ ê°œë…ì„ ì¢€ë” ì•Œê³  ì‹¶ë‹¤ë©´ jojoldu ë‹˜ì˜ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„ ì¶”ì²œí•œë‹¤.
<a href=https://jojoldu.tistory.com/71 target=_blank rel="noopener noreffer">https://jojoldu.tistory.com/71</a></p><p>ê·¸ë˜ì„œ ì•„ë˜ì²˜ëŸ¼ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´ GET ì´ë˜ POST ì´ë˜ ë¡œê¹…ì´ ë˜ëŠ”ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆë‹¤.</p><figure><a class=lightgallery href=/images/controller-common-logging/test.jpg title=/images/controller-common-logging/test.jpg data-thumbnail=/images/controller-common-logging/test.jpg data-sub-html="<h2>ë” ì´ì˜ê²Œ ë¡œê¹…ì„ í•˜ëŠ”ê±´ ììœ !</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/test.jpg data-srcset="/images/controller-common-logging/test.jpg, /images/controller-common-logging/test.jpg 1.5x, /images/controller-common-logging/test.jpg 2x" data-sizes=auto alt=/images/controller-common-logging/test.jpg width=80%></a><figcaption class=image-caption>ë” ì´ì˜ê²Œ ë¡œê¹…ì„ í•˜ëŠ”ê±´ ììœ !</figcaption></figure><h2 id=ë§ˆì¹˜ë©°>ë§ˆì¹˜ë©°</h2><p>ì‚¬ì‹¤ ì´ ë¡œì§ì„ ë§Œë“¤ê²Œ ëœ ê³„ê¸°ëŠ” íŒ€ì›ì¤‘ì— í•œë¶„ì´ &ldquo;GET ì˜ íŒŒë¼ë¯¸í„°ëŠ” ë¡œê¹…ì´ ë˜ëŠ”ë° POST ì˜ íŒŒë¼ë¯¸í„°ëŠ” ë¡œê¹…ì´ ì•ˆë˜ìš”&rdquo; ë¼ëŠ” ë§ì— íˆ¬ìš°ì‚¬ ì•ì— ìˆëŠ” í™©ì†Œë§ˆëƒ¥ ì°¾ì•„ë³´ë‹¤ ë§Œë“¤ê²Œ ë˜ì—ˆë‹¤. ì°¸ê³ ë¡œ ì´ ë¶€ë¶„ì€ í•˜ë‚˜ì˜ <code>ë¬´ê¸°</code>ê°€ ë ê²ƒ ê°™ì•„ githubì— ê³µê°œë¥¼ í•˜ì˜€ê³  ìœ„ì—ì„œ ì ì—ˆë˜ ìš”êµ¬ì‚¬í•­ë³´ë‹¤ ë” ì¢‹ì€ ë‚´ìš©ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ PullRequest ë¥¼ ë‚ ë ¤ì£¼ê¸°ë¥¼ ë°”ë€ë‹¤. Spring Boot í™˜ê²½ì—ì„œ Filterë¥¼ ì¶”ê°€í•˜ë©° êµ¬ì„±í•˜ì˜€ë‹¤.
<a href=https://github.com/taetaetae/request_logging target=_blank rel="noopener noreffer">https://github.com/taetaetae/request_logging</a>
í•„í„°ì™€ ì¸í„°ì…‰í„°, AOP ë“± í‰ì†Œ ìì£¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ (ì´ë¯¸ ëˆ„êµ°ê°€ ë‹¤ ë§Œë“¤ì–´ ë‘”) ë¶€ë¶„ì„ ë§Œì§€ë©´ì„œ ë‹¤ì‹œí•œë²ˆ Springì˜ ì£¼ìš” ê°œë…ì„ ìˆ™ì§€í•˜ëŠ”ë° ë„ì›€ì´ ë˜ì—ˆë˜ ê²½í—˜ìœ¼ë¡œ ë‚¨ì„ ê²ƒ ê°™ë‹¤.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2019-06-30</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°" data-hashtags=spring,logging,HttpServletRequestWrapper,Filter,AOP,archives-2019><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-hashtag=spring><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on å¾®åš" data-sharer=weibo data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°" data-image=/images/controller-common-logging/spring_boot_logging.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Springì—ì„œ Requestë¥¼ ìš°ì•„í•˜ê²Œ ë¡œê¹…í•˜ê¸°" data-description><i class="fab fa-blogger fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/spring/>Spring</a>,&nbsp;<a href=/tags/logging/>Logging</a>,&nbsp;<a href=/tags/httpservletrequestwrapper/>HttpServletRequestWrapper</a>,&nbsp;<a href=/tags/filter/>Filter</a>,&nbsp;<a href=/tags/aop/>AOP</a>,&nbsp;<a href=/tags/archives-2019/>Archives-2019</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2019/05/19/d-light-togetherthon-2019/ class=prev rel=prev title="D.light íˆ¬ê²Œë”í†¤ ì°¸ê°€í›„ê¸°"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>D.light íˆ¬ê²Œë”í†¤ ì°¸ê°€í›„ê¸°</a>
<a href=/2019/07/07/review-first-half-2019/ class=next rel=next title="2019 ìƒë°˜ê¸° ë¦¬ë·° (feat. ê¸€ë˜)">2019 ìƒë°˜ê¸° ë¦¬ë·° (feat. ê¸€ë˜)<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.147.9">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2016 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>íƒœíƒœíƒœ</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:500},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"Comment",lightTheme:"github-light",repo:"taetaetae/blog-comment"}},lightgallery:!0}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-86432198-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
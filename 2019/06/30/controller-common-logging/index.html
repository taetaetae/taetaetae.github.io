<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Spring에서 Request를 우아하게 로깅하기 - 👨‍💻꿈꾸는 태태태의 공간</title><meta name=Description content><meta property="og:title" content="Spring에서 Request를 우아하게 로깅하기"><meta property="og:description" content="스프링 기반의 웹 어플리케이션을 만들다 보면 요청을 처리하는데 맨 처음에 위치하고 있는 Controller(이하 컨트롤러)라는 레이어를 만들게 된다. 그럴때면 사용자가 어떤 요청(Request)을 하였는지에 대해 확인이 필요할 수 있다. 물론 확인을 안해도 무방하지만 가급적 로깅은 시스템 로직에 영향을 주지 않는 범위에서 최대한 다양하게 미리 해두는게 나중에 유지보수시 편할 수 있다. (예전 조직장님께서 말씀하신게 아직도 머릿속에 꽉 자리잡고 있다&mldr;) 아~주 일반적으로, 컨트롤러에서는 다음과 같이 메소드 단위로 파라미터를 직접 로깅하게 된다.
@Slf4j @RestController public class SampleController { @GetMapping(&#34;/test1&#34;) public String test1(@RequestParam String id) { log.info(&#34;id : {}&#34;, id); return &#34;length : &#34; + id.length(); } } 이렇게 되면 사용자가 GET /test1 이라는 요청을 보낼때 어떤 파라미터로 호출하였는지에 대해 로깅이 남게 되는데 항상 log.info(&#34;id : {}&#34;, id); 과 같이 수동으로 로깅을 남겨야 하는 불편함이 생긴다. 물론 꼼꼼하게 메소드마다 로깅을 적어주면 전혀 문제될게 없지만 이러한 컨트롤러 ~ 메소드가 한두개가 아닌 수십 또는 수백개일 경우엔 그때마다 로깅을 적어줘야 하는 불편함이 있을 수 있다. 또한 자칫 깜박하고 로깅을 빼먹고 배포를 하게 된 경우 모니터링시 로깅을 하지 않아서 다시 로깅하고 배포를 하는, 별것도 아닌데(?) &ldquo;정말 불편한&rdquo; 상황이 있을 수 있다. 이번 포스팅에서는 사용자의 요청을 모니터링 하기 위해 컨트롤러마다 코드를 작성해가며 로깅을 하는것이 아니라 HttpServletRequestWrapper 라는 것과 Filter, AOP를 이용하여 Request의 정보를 한곳에서 우아하게 로깅하는 방법에 대해 알아보고자 한다.
요구사항 와 개발하자아!출처 : https://gfycat.com/ko/brightevilaoudad&#34; 와 개발하자아!
출처 : https://gfycat.com/ko/brightevilaoudad  투우사가 흔드는 빨간 천을 보며 돌진하는 황소처럼 (쓰고보니 너무 TMI 같다&mldr;.) 당장 코딩을 시작하며 개발을 할 수도 있지만 정작 원하는 기능이 무엇인지 천천히 정리하고 넘어갈 필요가 있는 것 같다. (어쩔땐 오히려 후자가 더 빠른 개발을 하게 되는것 같다.)
 GET, POST 등 다양한 http method 로 구현된 모든 컨트롤러의 파라미터와 기타 Request 정보가 로깅이 되야 한다. 컨트롤러, 메소드가 늘어날때마다 별도의 코드 추가 없이 한곳에서 공통적으로 로깅이 되야 한다. URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다. 앞서 말했듯 다른 비지니스 로직에 영향을 주지 않아야 한다.  구현하기 - Request 의 파라미터 정리 Request 의 모든 로깅을 한곳에서 처리하기 위해서 filter(필터)를 활용하였다. 필터는 Dispatcher servlet의 앞단에 위치하고 있기 때문에 모든 정보를 확인할 수 있는데 용이하다. 물론 인터셉터를 활용해서도 방법이 있겠지만 본 포스팅 에서는 필터를 활용해서 구현하는것을 목적으로 한다. (사실 인터셉터로 몇번 시도해보다가 실패해서&mldr;유유 )
Spring MVC Request Life Cycle출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/&#34; Spring MVC Request Life Cycle
출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/  Filter를 만들기 전에 Filter에서 사용할 주요 핵심(?) 클래스가 필요한데 HttpServletRequest 를 Wrapping 해서 사용하기 위해 HttpServletRequestWrapper를 상속받는 클래스를 만들자. Request 에 담겨있는 param 과 body로 요청이 들어올 경우 body에 있는 내용을 param 에 담는 로직이다. 주요 설명은 코드 안에서 주석으로 설명하겠다.
public class ReadableRequestWrapper extends HttpServletRequestWrapper { // 상속 	private final Charset encoding; private byte[] rawData; private Map<String, String[]> params = new HashMap<>(); public ReadableRequestWrapper(HttpServletRequest request) { super(request); this.params.putAll(request.getParameterMap()); // 원래의 파라미터를 저장  String charEncoding = request.getCharacterEncoding(); // 인코딩 설정 	this.encoding = StringUtils.isBlank(charEncoding) ? StandardCharsets.UTF_8 : Charset.forName(charEncoding); try { InputStream is = request.getInputStream(); this.rawData = IOUtils.toByteArray(is); // InputStream 을 별도로 저장한 다음 getReader() 에서 새 스트림으로 생성  // body 파싱 	String collect = this.getReader().lines().collect(Collectors.joining(System.lineSeparator())); if (StringUtils.isEmpty(collect)) { // body 가 없을경우 로깅 제외 	return; } if (request.getContentType() != null && request."><meta property="og:type" content="article"><meta property="og:url" content="https://taetaetae.github.io/2019/06/30/controller-common-logging/"><meta property="og:image" content="https://taetaetae.github.io/images/controller-common-logging/spring_boot_logging.png"><meta property="article:published_time" content="2019-06-30T18:39:47+00:00"><meta property="article:modified_time" content="2019-06-30T18:39:47+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/controller-common-logging/spring_boot_logging.png"><meta name=twitter:title content="Spring에서 Request를 우아하게 로깅하기"><meta name=twitter:description content="스프링 기반의 웹 어플리케이션을 만들다 보면 요청을 처리하는데 맨 처음에 위치하고 있는 Controller(이하 컨트롤러)라는 레이어를 만들게 된다. 그럴때면 사용자가 어떤 요청(Request)을 하였는지에 대해 확인이 필요할 수 있다. 물론 확인을 안해도 무방하지만 가급적 로깅은 시스템 로직에 영향을 주지 않는 범위에서 최대한 다양하게 미리 해두는게 나중에 유지보수시 편할 수 있다. (예전 조직장님께서 말씀하신게 아직도 머릿속에 꽉 자리잡고 있다&mldr;) 아~주 일반적으로, 컨트롤러에서는 다음과 같이 메소드 단위로 파라미터를 직접 로깅하게 된다.
@Slf4j @RestController public class SampleController { @GetMapping(&#34;/test1&#34;) public String test1(@RequestParam String id) { log.info(&#34;id : {}&#34;, id); return &#34;length : &#34; + id.length(); } } 이렇게 되면 사용자가 GET /test1 이라는 요청을 보낼때 어떤 파라미터로 호출하였는지에 대해 로깅이 남게 되는데 항상 log.info(&#34;id : {}&#34;, id); 과 같이 수동으로 로깅을 남겨야 하는 불편함이 생긴다. 물론 꼼꼼하게 메소드마다 로깅을 적어주면 전혀 문제될게 없지만 이러한 컨트롤러 ~ 메소드가 한두개가 아닌 수십 또는 수백개일 경우엔 그때마다 로깅을 적어줘야 하는 불편함이 있을 수 있다. 또한 자칫 깜박하고 로깅을 빼먹고 배포를 하게 된 경우 모니터링시 로깅을 하지 않아서 다시 로깅하고 배포를 하는, 별것도 아닌데(?) &ldquo;정말 불편한&rdquo; 상황이 있을 수 있다. 이번 포스팅에서는 사용자의 요청을 모니터링 하기 위해 컨트롤러마다 코드를 작성해가며 로깅을 하는것이 아니라 HttpServletRequestWrapper 라는 것과 Filter, AOP를 이용하여 Request의 정보를 한곳에서 우아하게 로깅하는 방법에 대해 알아보고자 한다.
요구사항 와 개발하자아!출처 : https://gfycat.com/ko/brightevilaoudad&#34; 와 개발하자아!
출처 : https://gfycat.com/ko/brightevilaoudad  투우사가 흔드는 빨간 천을 보며 돌진하는 황소처럼 (쓰고보니 너무 TMI 같다&mldr;.) 당장 코딩을 시작하며 개발을 할 수도 있지만 정작 원하는 기능이 무엇인지 천천히 정리하고 넘어갈 필요가 있는 것 같다. (어쩔땐 오히려 후자가 더 빠른 개발을 하게 되는것 같다.)
 GET, POST 등 다양한 http method 로 구현된 모든 컨트롤러의 파라미터와 기타 Request 정보가 로깅이 되야 한다. 컨트롤러, 메소드가 늘어날때마다 별도의 코드 추가 없이 한곳에서 공통적으로 로깅이 되야 한다. URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다. 앞서 말했듯 다른 비지니스 로직에 영향을 주지 않아야 한다.  구현하기 - Request 의 파라미터 정리 Request 의 모든 로깅을 한곳에서 처리하기 위해서 filter(필터)를 활용하였다. 필터는 Dispatcher servlet의 앞단에 위치하고 있기 때문에 모든 정보를 확인할 수 있는데 용이하다. 물론 인터셉터를 활용해서도 방법이 있겠지만 본 포스팅 에서는 필터를 활용해서 구현하는것을 목적으로 한다. (사실 인터셉터로 몇번 시도해보다가 실패해서&mldr;유유 )
Spring MVC Request Life Cycle출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/&#34; Spring MVC Request Life Cycle
출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/  Filter를 만들기 전에 Filter에서 사용할 주요 핵심(?) 클래스가 필요한데 HttpServletRequest 를 Wrapping 해서 사용하기 위해 HttpServletRequestWrapper를 상속받는 클래스를 만들자. Request 에 담겨있는 param 과 body로 요청이 들어올 경우 body에 있는 내용을 param 에 담는 로직이다. 주요 설명은 코드 안에서 주석으로 설명하겠다.
public class ReadableRequestWrapper extends HttpServletRequestWrapper { // 상속 	private final Charset encoding; private byte[] rawData; private Map<String, String[]> params = new HashMap<>(); public ReadableRequestWrapper(HttpServletRequest request) { super(request); this.params.putAll(request.getParameterMap()); // 원래의 파라미터를 저장  String charEncoding = request.getCharacterEncoding(); // 인코딩 설정 	this.encoding = StringUtils.isBlank(charEncoding) ? StandardCharsets.UTF_8 : Charset.forName(charEncoding); try { InputStream is = request.getInputStream(); this.rawData = IOUtils.toByteArray(is); // InputStream 을 별도로 저장한 다음 getReader() 에서 새 스트림으로 생성  // body 파싱 	String collect = this.getReader().lines().collect(Collectors.joining(System.lineSeparator())); if (StringUtils.isEmpty(collect)) { // body 가 없을경우 로깅 제외 	return; } if (request.getContentType() != null && request."><meta name=application-name content="👨‍💻꿈꾸는 태태태의 공간"><meta name=apple-mobile-web-app-title content="👨‍💻꿈꾸는 태태태의 공간"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2019/06/30/controller-common-logging/><link rel=prev href=https://taetaetae.github.io/2019/05/19/d-light-togetherthon-2019/><link rel=next href=https://taetaetae.github.io/2019/07/07/review-first-half-2019/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Spring에서 Request를 우아하게 로깅하기","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2019\/06\/30\/controller-common-logging\/"},"genre":"posts","keywords":"spring, logging, HttpServletRequestWrapper, Filter, AOP, archives-2019","wordcount":1231,"url":"https:\/\/taetaetae.github.io\/2019\/06\/30\/controller-common-logging\/","datePublished":"2019-06-30T18:39:47+00:00","dateModified":"2019-06-30T18:39:47+00:00","publisher":{"@type":"Organization","name":"태태태"},"author":{"@type":"Person","name":"태태태"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:260px;height:600px data-ad-client=ca-pub-5788330009690816 data-ad-slot=2248955907></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><article class="page single"><h1 class="single-title animated flipInX">Spring에서 Request를 우아하게 로깅하기</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>태태태</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2019-06-30>2019-06-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1231 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/spring_boot_logging.png data-srcset="/images/controller-common-logging/spring_boot_logging.png, /images/controller-common-logging/spring_boot_logging.png 1.5x, /images/controller-common-logging/spring_boot_logging.png 2x" data-sizes=auto alt=/images/controller-common-logging/spring_boot_logging.png title=/images/controller-common-logging/spring_boot_logging.png></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#요구사항>요구사항</a></li><li><a href=#구현하기---request-의-파라미터-정리>구현하기 - Request 의 파라미터 정리</a></li><li><a href=#구현하기---컨트롤러에-aop-셋팅>구현하기 - 컨트롤러에 AOP 셋팅</a></li><li><a href=#마치며>마치며</a></li></ul></nav></div></div><div class=content id=content><script src=https://ads-partners.coupang.com/g.js></script><script>new PartnersCoupang.G({"id":195296,"trackingCode":"AF5596407","subId":null,"template":"carousel","width":"680","height":"140"});</script><p>※ 쿠팡 파트너스 활동을 통해 일정액의 수수료를 제공받을 수 있습니다.</p><p>스프링 기반의 웹 어플리케이션을 만들다 보면 요청을 처리하는데 맨 처음에 위치하고 있는 <code>Controller</code>(이하 컨트롤러)라는 레이어를 만들게 된다. 그럴때면 사용자가 어떤 요청(Request)을 하였는지에 대해 확인이 필요할 수 있다. 물론 확인을 안해도 무방하지만 가급적 로깅은 시스템 로직에 영향을 주지 않는 범위에서 최대한 다양하게 <code>미리</code> 해두는게 나중에 유지보수시 편할 수 있다. (예전 조직장님께서 말씀하신게 아직도 머릿속에 꽉 자리잡고 있다&mldr;)
아~주 일반적으로, 컨트롤러에서는 다음과 같이 메소드 단위로 파라미터를 직접 로깅하게 된다.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Slf4j</span>
<span class=nd>@RestController</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SampleController</span> <span class=o>{</span>

	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/test1&#34;</span><span class=o>)</span>
	<span class=kd>public</span> <span class=n>String</span> <span class=nf>test1</span><span class=o>(</span><span class=nd>@RequestParam</span> <span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;id : {}&#34;</span><span class=o>,</span> <span class=n>id</span><span class=o>);</span>
		<span class=k>return</span> <span class=s>&#34;length : &#34;</span> <span class=o>+</span> <span class=n>id</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
	<span class=o>}</span>
<span class=o>}</span>

</code></pre></div><p>이렇게 되면 사용자가 <code>GET /test1</code> 이라는 요청을 보낼때 어떤 파라미터로 호출하였는지에 대해 로깅이 남게 되는데 항상 <code>log.info("id : {}", id);</code> 과 같이 수동으로 로깅을 남겨야 하는 불편함이 생긴다. 물론 꼼꼼하게 메소드마다 로깅을 적어주면 전혀 문제될게 없지만 이러한 컨트롤러 ~ 메소드가 한두개가 아닌 수십 또는 수백개일 경우엔 그때마다 로깅을 적어줘야 하는 불편함이 있을 수 있다. 또한 자칫 깜박하고 로깅을 빼먹고 배포를 하게 된 경우 모니터링시 로깅을 하지 않아서 다시 로깅하고 배포를 하는, 별것도 아닌데(?) &ldquo;정말 불편한&rdquo; 상황이 있을 수 있다.
이번 포스팅에서는 사용자의 요청을 모니터링 하기 위해 컨트롤러마다 코드를 작성해가며 로깅을 하는것이 아니라 <code>HttpServletRequestWrapper</code> 라는 것과 <code>Filter</code>, <code>AOP</code>를 이용하여 <strong>Request의 정보를 한곳에서 우아하게 로깅하는 방법</strong>에 대해 알아보고자 한다.</p><h2 id=요구사항>요구사항</h2><figure><a class=lightgallery href=/images/controller-common-logging/bull_fighting.gif title=/images/controller-common-logging/bull_fighting.gif data-thumbnail=/images/controller-common-logging/bull_fighting.gif data-sub-html="<h2>와 개발하자아!출처 : https://gfycat.com/ko/brightevilaoudad</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/bull_fighting.gif data-srcset="/images/controller-common-logging/bull_fighting.gif, /images/controller-common-logging/bull_fighting.gif 1.5x, /images/controller-common-logging/bull_fighting.gif 2x" data-sizes=auto alt=/images/controller-common-logging/bull_fighting.gif width=80%></a><figcaption class=image-caption>와 개발하자아!<br>출처 : <a href=https://gfycat.com/ko/brightevilaoudad>https://gfycat.com/ko/brightevilaoudad</a></figcaption></figure><p>투우사가 흔드는 빨간 천을 보며 돌진하는 황소처럼 (쓰고보니 너무 TMI 같다&mldr;.) 당장 코딩을 시작하며 개발을 할 수도 있지만 정작 원하는 기능이 무엇인지 천천히 정리하고 넘어갈 필요가 있는 것 같다. (어쩔땐 오히려 후자가 더 빠른 개발을 하게 되는것 같다.)</p><ol><li>GET, POST 등 다양한 http method 로 구현된 모든 컨트롤러의 파라미터와 기타 Request 정보가 로깅이 되야 한다.</li><li>컨트롤러, 메소드가 늘어날때마다 별도의 코드 추가 없이 한곳에서 공통적으로 로깅이 되야 한다.</li><li>URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다.</li><li>앞서 말했듯 다른 비지니스 로직에 영향을 주지 않아야 한다.</li></ol><h2 id=구현하기---request-의-파라미터-정리>구현하기 - Request 의 파라미터 정리</h2><p>Request 의 모든 로깅을 한곳에서 처리하기 위해서 filter(필터)를 활용하였다. 필터는 Dispatcher servlet의 앞단에 위치하고 있기 때문에 모든 정보를 확인할 수 있는데 용이하다. 물론 인터셉터를 활용해서도 방법이 있겠지만 본 포스팅 에서는 필터를 활용해서 구현하는것을 목적으로 한다. (사실 인터셉터로 몇번 시도해보다가 실패해서&mldr;유유 )</p><figure><a class=lightgallery href=/images/controller-common-logging/spring-request-lifecycle.jpg title=/images/controller-common-logging/spring-request-lifecycle.jpg data-thumbnail=/images/controller-common-logging/spring-request-lifecycle.jpg data-sub-html="<h2>Spring MVC Request Life Cycle출처 : https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/spring-request-lifecycle.jpg data-srcset="/images/controller-common-logging/spring-request-lifecycle.jpg, /images/controller-common-logging/spring-request-lifecycle.jpg 1.5x, /images/controller-common-logging/spring-request-lifecycle.jpg 2x" data-sizes=auto alt=/images/controller-common-logging/spring-request-lifecycle.jpg width=80%></a><figcaption class=image-caption>Spring MVC Request Life Cycle<br>출처 : <a href=https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/>https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/</a></figcaption></figure><p>Filter를 만들기 전에 Filter에서 사용할 주요 핵심(?) 클래스가 필요한데 <code>HttpServletRequest</code> 를 Wrapping 해서 사용하기 위해 <code>HttpServletRequestWrapper</code>를 상속받는 클래스를 만들자. Request 에 담겨있는 param 과 body로 요청이 들어올 경우 body에 있는 내용을 param 에 담는 로직이다. 주요 설명은 코드 안에서 주석으로 설명하겠다.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ReadableRequestWrapper</span> <span class=kd>extends</span> <span class=n>HttpServletRequestWrapper</span> <span class=o>{</span> <span class=c1>// 상속
</span><span class=c1></span>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Charset</span> <span class=n>encoding</span><span class=o>;</span>
	<span class=kd>private</span> <span class=kt>byte</span><span class=o>[]</span> <span class=n>rawData</span><span class=o>;</span>
	<span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>[]&gt;</span> <span class=n>params</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>

	<span class=kd>public</span> <span class=nf>ReadableRequestWrapper</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>)</span> <span class=o>{</span>
		<span class=kd>super</span><span class=o>(</span><span class=n>request</span><span class=o>);</span>
		<span class=k>this</span><span class=o>.</span><span class=na>params</span><span class=o>.</span><span class=na>putAll</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getParameterMap</span><span class=o>());</span> <span class=c1>// 원래의 파라미터를 저장
</span><span class=c1></span>
		<span class=n>String</span> <span class=n>charEncoding</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getCharacterEncoding</span><span class=o>();</span> <span class=c1>// 인코딩 설정
</span><span class=c1></span>		<span class=k>this</span><span class=o>.</span><span class=na>encoding</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=o>.</span><span class=na>isBlank</span><span class=o>(</span><span class=n>charEncoding</span><span class=o>)</span> <span class=o>?</span> <span class=n>StandardCharsets</span><span class=o>.</span><span class=na>UTF_8</span> <span class=o>:</span> <span class=n>Charset</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>charEncoding</span><span class=o>);</span>

		<span class=k>try</span> <span class=o>{</span>
			<span class=n>InputStream</span> <span class=n>is</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
			<span class=k>this</span><span class=o>.</span><span class=na>rawData</span> <span class=o>=</span> <span class=n>IOUtils</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>(</span><span class=n>is</span><span class=o>);</span> <span class=c1>// InputStream 을 별도로 저장한 다음 getReader() 에서 새 스트림으로 생성
</span><span class=c1></span>
			<span class=c1>// body 파싱
</span><span class=c1></span>			<span class=n>String</span> <span class=n>collect</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>getReader</span><span class=o>().</span><span class=na>lines</span><span class=o>().</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>lineSeparator</span><span class=o>()));</span>
			<span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>(</span><span class=n>collect</span><span class=o>))</span> <span class=o>{</span> <span class=c1>// body 가 없을경우 로깅 제외
</span><span class=c1></span>				<span class=k>return</span><span class=o>;</span>
			<span class=o>}</span>
			<span class=k>if</span> <span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getContentType</span><span class=o>()</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>request</span><span class=o>.</span><span class=na>getContentType</span><span class=o>().</span><span class=na>contains</span><span class=o>(</span>
				<span class=n>ContentType</span><span class=o>.</span><span class=na>MULTIPART_FORM_DATA</span><span class=o>.</span><span class=na>getMimeType</span><span class=o>()))</span> <span class=o>{</span> <span class=c1>// 파일 업로드시 로깅제외
</span><span class=c1></span>				<span class=k>return</span><span class=o>;</span>
			<span class=o>}</span>
			<span class=n>JSONParser</span> <span class=n>jsonParser</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONParser</span><span class=o>();</span>
			<span class=n>Object</span> <span class=n>parse</span> <span class=o>=</span> <span class=n>jsonParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>collect</span><span class=o>);</span>
			<span class=k>if</span> <span class=o>(</span><span class=n>parse</span> <span class=k>instanceof</span> <span class=n>JSONArray</span><span class=o>)</span> <span class=o>{</span>
				<span class=n>JSONArray</span> <span class=n>jsonArray</span> <span class=o>=</span> <span class=o>(</span><span class=n>JSONArray</span><span class=o>)</span><span class=n>jsonParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>collect</span><span class=o>);</span>
				<span class=n>setParameter</span><span class=o>(</span><span class=s>&#34;requestBody&#34;</span><span class=o>,</span> <span class=n>jsonArray</span><span class=o>.</span><span class=na>toJSONString</span><span class=o>());</span>
			<span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
				<span class=n>JSONObject</span> <span class=n>jsonObject</span> <span class=o>=</span> <span class=o>(</span><span class=n>JSONObject</span><span class=o>)</span><span class=n>jsonParser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>collect</span><span class=o>);</span>
				<span class=n>Iterator</span> <span class=n>iterator</span> <span class=o>=</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>keySet</span><span class=o>().</span><span class=na>iterator</span><span class=o>();</span>
				<span class=k>while</span> <span class=o>(</span><span class=n>iterator</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
					<span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span><span class=n>iterator</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
					<span class=n>setParameter</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>jsonObject</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>key</span><span class=o>).</span><span class=na>toString</span><span class=o>().</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;\&#34;&#34;</span><span class=o>,</span> <span class=s>&#34;\\\&#34;&#34;</span><span class=o>));</span>
				<span class=o>}</span>
			<span class=o>}</span>
		<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
			<span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;ReadableRequestWrapper init error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
		<span class=o>}</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getParameter</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>String</span><span class=o>[]</span> <span class=n>paramArray</span> <span class=o>=</span> <span class=n>getParameterValues</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
		<span class=k>if</span> <span class=o>(</span><span class=n>paramArray</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>paramArray</span><span class=o>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>
			<span class=k>return</span> <span class=n>paramArray</span><span class=o>[</span><span class=n>0</span><span class=o>];</span>
		<span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
			<span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
		<span class=o>}</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>[]&gt;</span> <span class=nf>getParameterMap</span><span class=o>()</span> <span class=o>{</span>
		<span class=k>return</span> <span class=n>Collections</span><span class=o>.</span><span class=na>unmodifiableMap</span><span class=o>(</span><span class=n>params</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Enumeration</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>getParameterNames</span><span class=o>()</span> <span class=o>{</span>
		<span class=k>return</span> <span class=n>Collections</span><span class=o>.</span><span class=na>enumeration</span><span class=o>(</span><span class=n>params</span><span class=o>.</span><span class=na>keySet</span><span class=o>());</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>String</span><span class=o>[]</span> <span class=nf>getParameterValues</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>String</span><span class=o>[]</span> <span class=n>result</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
		<span class=n>String</span><span class=o>[]</span> <span class=n>dummyParamValue</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>

		<span class=k>if</span> <span class=o>(</span><span class=n>dummyParamValue</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
			<span class=n>result</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>[</span><span class=n>dummyParamValue</span><span class=o>.</span><span class=na>length</span><span class=o>];</span>
			<span class=n>System</span><span class=o>.</span><span class=na>arraycopy</span><span class=o>(</span><span class=n>dummyParamValue</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>result</span><span class=o>,</span> <span class=n>0</span><span class=o>,</span> <span class=n>dummyParamValue</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
		<span class=o>}</span>
		<span class=k>return</span> <span class=n>result</span><span class=o>;</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setParameter</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>String</span><span class=o>[]</span> <span class=n>param</span> <span class=o>=</span> <span class=o>{</span><span class=n>value</span><span class=o>};</span>
		<span class=n>setParameter</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>param</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setParameter</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span><span class=o>[]</span> <span class=n>values</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>values</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>ServletInputStream</span> <span class=nf>getInputStream</span><span class=o>()</span> <span class=o>{</span>
		<span class=kd>final</span> <span class=n>ByteArrayInputStream</span> <span class=n>byteArrayInputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>rawData</span><span class=o>);</span>

		<span class=k>return</span> <span class=k>new</span> <span class=n>ServletInputStream</span><span class=o>()</span> <span class=o>{</span>
			<span class=nd>@Override</span>
			<span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isFinished</span><span class=o>()</span> <span class=o>{</span>
				<span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
			<span class=o>}</span>

			<span class=nd>@Override</span>
			<span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isReady</span><span class=o>()</span> <span class=o>{</span>
				<span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
			<span class=o>}</span>

			<span class=nd>@Override</span>
			<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setReadListener</span><span class=o>(</span><span class=n>ReadListener</span> <span class=n>readListener</span><span class=o>)</span> <span class=o>{</span>
				<span class=c1>// Do nothing
</span><span class=c1></span>			<span class=o>}</span>

			<span class=kd>public</span> <span class=kt>int</span> <span class=nf>read</span><span class=o>()</span> <span class=o>{</span>
				<span class=k>return</span> <span class=n>byteArrayInputStream</span><span class=o>.</span><span class=na>read</span><span class=o>();</span>
			<span class=o>}</span>
		<span class=o>};</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>BufferedReader</span> <span class=nf>getReader</span><span class=o>()</span> <span class=o>{</span>
		<span class=k>return</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>(),</span> <span class=k>this</span><span class=o>.</span><span class=na>encoding</span><span class=o>));</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>가장 중요한 부분은 <code>IOUtils.toByteArray(is)</code> 요 부분인데, InputStream은 한번밖에 읽을 수 없기 때문에 이 필터에서 스트림을 읽는 대신, 래퍼 구현으로 새 스트림 생성하도록 작업을 하였다. 자칫 잘못하다간 body의 내용이 유실될 수도 있기 때문이다.
참조 :
<a href=http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once>http://stackoverflow.com/questions/10210645/http-servlet-request-lose-params-from-post-body-after-read-it-once</a>
<a href=http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge>http://stackoverflow.com/questions/3769259/why-is-the-parameter-value-an-object-hash-code-for-request-getparametermap-ge</a></p><p>위에서 만든 래퍼 클래스를 이제 필터에서 적용해보자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ReadableRequestWrapperFilter</span> <span class=kd>implements</span> <span class=n>Filter</span> <span class=o>{</span>
	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>init</span><span class=o>(</span><span class=n>FilterConfig</span> <span class=n>filterConfig</span><span class=o>)</span> <span class=o>{</span>
		<span class=c1>// Do nothing
</span><span class=c1></span>	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>doFilter</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>chain</span><span class=o>)</span>
		<span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ServletException</span> <span class=o>{</span>
		<span class=n>ReadableRequestWrapper</span> <span class=n>wrapper</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReadableRequestWrapper</span><span class=o>((</span><span class=n>HttpServletRequest</span><span class=o>)</span><span class=n>request</span><span class=o>);</span>
		<span class=n>chain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>wrapper</span><span class=o>,</span> <span class=n>response</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>destroy</span><span class=o>()</span> <span class=o>{</span>
		<span class=c1>// Do nothing
</span><span class=c1></span>	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>이렇게 되면 param으로 넘어온 파라미터나 body로 넘어온 정보들이 파싱되어 param에 담기게 된다.
(JSON으로 파싱하는 부분은 조금 지저분해 보일 수 있지만 다양한 테스트를 해보면서 얻은 결과물이다. 더 좋은 방식이 있다면 언제든지 PullRequest 또는 댓글 환영!)</p><h2 id=구현하기---컨트롤러에-aop-셋팅>구현하기 - 컨트롤러에 AOP 셋팅</h2><p>이제 Request 의 params 를 한곳에서 로깅할 차례이다. 물론 위에서 만든 필터에서 로깅을 해도 되지만 필터에 로직이 들어가는 것보다 별도의 로직에서 처리하는게 맞다고 생각되어 분리를 하였다. (관심사의 분리)
AOP를 활용하여 다음과 같이 로직을 작성하였다. 아래 로직은 이해하기에 큰 어려움은 없을것 같지만 주석으로 설명을 하겠다.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Component</span>
<span class=nd>@Aspect</span>
<span class=nd>@Slf4j</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LoggerAspect</span> <span class=o>{</span>
	<span class=nd>@Pointcut</span><span class=o>(</span><span class=s>&#34;execution(* com.taetaetae..*Controller.*(..))&#34;</span><span class=o>)</span> <span class=c1>// 이런 패턴이 실행될 경우 수행
</span><span class=c1></span>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>loggerPointCut</span><span class=o>()</span> <span class=o>{</span>
	<span class=o>}</span>

	<span class=nd>@Around</span><span class=o>(</span><span class=s>&#34;loggerPointCut()&#34;</span><span class=o>)</span>
	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>methodLogger</span><span class=o>(</span><span class=n>ProceedingJoinPoint</span> <span class=n>proceedingJoinPoint</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
		<span class=k>try</span> <span class=o>{</span>
			<span class=n>Object</span> <span class=n>result</span> <span class=o>=</span> <span class=n>proceedingJoinPoint</span><span class=o>.</span><span class=na>proceed</span><span class=o>();</span>
			<span class=n>HttpServletRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=o>((</span><span class=n>ServletRequestAttributes</span><span class=o>)</span><span class=n>RequestContextHolder</span><span class=o>.</span><span class=na>getRequestAttributes</span><span class=o>()).</span><span class=na>getRequest</span><span class=o>();</span> <span class=c1>// request 정보를 가져온다.
</span><span class=c1></span>
			<span class=n>String</span> <span class=n>controllerName</span> <span class=o>=</span> <span class=n>proceedingJoinPoint</span><span class=o>.</span><span class=na>getSignature</span><span class=o>().</span><span class=na>getDeclaringType</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>();</span>
			<span class=n>String</span> <span class=n>methodName</span> <span class=o>=</span> <span class=n>proceedingJoinPoint</span><span class=o>.</span><span class=na>getSignature</span><span class=o>().</span><span class=na>getName</span><span class=o>();</span>

			<span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>params</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>

			<span class=k>try</span> <span class=o>{</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;controller&#34;</span><span class=o>,</span> <span class=n>controllerName</span><span class=o>);</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;method&#34;</span><span class=o>,</span> <span class=n>methodName</span><span class=o>);</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;params&#34;</span><span class=o>,</span> <span class=n>getParams</span><span class=o>(</span><span class=n>request</span><span class=o>));</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;log_time&#34;</span><span class=o>,</span> <span class=k>new</span> <span class=n>Date</span><span class=o>());</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;request_uri&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURI</span><span class=o>());</span>
				<span class=n>params</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;http_method&#34;</span><span class=o>,</span> <span class=n>request</span><span class=o>.</span><span class=na>getMethod</span><span class=o>());</span>
			<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
				<span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;LoggerAspect error&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
			<span class=o>}</span>
			<span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;params : {}&#34;</span><span class=o>,</span> <span class=n>params</span><span class=o>);</span> <span class=c1>// param에 담긴 정보들을 한번에 로깅한다.
</span><span class=c1></span>
			<span class=k>return</span> <span class=n>result</span><span class=o>;</span>

		<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Throwable</span> <span class=n>throwable</span><span class=o>)</span> <span class=o>{</span>
			<span class=k>throw</span> <span class=n>throwable</span><span class=o>;</span>
		<span class=o>}</span>
	<span class=o>}</span>

	<span class=cm>/**
</span><span class=cm>	 * request 에 담긴 정보를 JSONObject 형태로 반환한다.
</span><span class=cm>	 * @param request
</span><span class=cm>	 * @return
</span><span class=cm>	 */</span>
	<span class=kd>private</span> <span class=kd>static</span> <span class=n>JSONObject</span> <span class=nf>getParams</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>JSONObject</span> <span class=n>jsonObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>();</span>
		<span class=n>Enumeration</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>params</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getParameterNames</span><span class=o>();</span>
		<span class=k>while</span> <span class=o>(</span><span class=n>params</span><span class=o>.</span><span class=na>hasMoreElements</span><span class=o>())</span> <span class=o>{</span>
			<span class=n>String</span> <span class=n>param</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=na>nextElement</span><span class=o>();</span>
			<span class=n>String</span> <span class=n>replaceParam</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=na>replaceAll</span><span class=o>(</span><span class=s>&#34;\\.&#34;</span><span class=o>,</span> <span class=s>&#34;-&#34;</span><span class=o>);</span>
			<span class=n>jsonObject</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>replaceParam</span><span class=o>,</span> <span class=n>request</span><span class=o>.</span><span class=na>getParameter</span><span class=o>(</span><span class=n>param</span><span class=o>));</span>
		<span class=o>}</span>
		<span class=k>return</span> <span class=n>jsonObject</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>위 코드에서는 단순히 console log를 찍었지만 필자가 운영하고 있는 어드민 툴에서는 Request 정보를 Elasticsearch 에 인덱싱하고 이를 키바나에서 보다 쉽게 조회 및 모니터링이 가능하도록 구현하였다. 로깅을 어떤식으로 남길지, 로깅이 아닌 특정 상황에서 알림을 보낸다거나 등등 이 부분은 실제 구현시에 상황에 맞춰서 만들면 될 것 같다.
또한 <code>Pointcut</code> 부분을 다르게 활용하여 위에서 이야기한 요구사항의 3번 (URL 중 특정 패턴으로 들어오는 요청은 다른 방식으로 로깅을 하거나, 로깅에서 제외할 수 있어야 한다.) 를 해결할 수 있다.
아참, AOP의 개념을 좀더 알고 싶다면 jojoldu 님의 블로그 포스팅을 추천한다.
<a href=https://jojoldu.tistory.com/71>https://jojoldu.tistory.com/71</a></p><p>그래서 아래처럼 테스트를 해보면 GET 이던 POST 이던 로깅이 되는것을 확인할수 있다.</p><figure><a class=lightgallery href=/images/controller-common-logging/test.jpg title=/images/controller-common-logging/test.jpg data-thumbnail=/images/controller-common-logging/test.jpg data-sub-html="<h2>더 이쁘게 로깅을 하는건 자유!</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/controller-common-logging/test.jpg data-srcset="/images/controller-common-logging/test.jpg, /images/controller-common-logging/test.jpg 1.5x, /images/controller-common-logging/test.jpg 2x" data-sizes=auto alt=/images/controller-common-logging/test.jpg width=80%></a><figcaption class=image-caption>더 이쁘게 로깅을 하는건 자유!</figcaption></figure><h2 id=마치며>마치며</h2><p>사실 이 로직을 만들게 된 계기는 팀원중에 한분이 &ldquo;GET 의 파라미터는 로깅이 되는데 POST 의 파라미터는 로깅이 안되요&rdquo; 라는 말에 투우사 앞에 있는 황소마냥 찾아보다 만들게 되었다. 참고로 이 부분은 하나의 <code>무기</code>가 될것 같아 github에 공개를 하였고 위에서 적었던 요구사항보다 더 좋은 내용이 있다면 언제든지 PullRequest 를 날려주기를 바란다. Spring Boot 환경에서 Filter를 추가하며 구성하였다.
<a href=https://github.com/taetaetae/request_logging>https://github.com/taetaetae/request_logging</a>
필터와 인터셉터, AOP 등 평소 자주 사용하지 않은 (이미 누군가 다 만들어 둔) 부분을 만지면서 다시한번 Spring의 주요 개념을 숙지하는데 도움이 되었던 경험으로 남을 것 같다.</p><script src=https://ads-partners.coupang.com/g.js></script><script>new PartnersCoupang.G({"id":195296,"trackingCode":"AF5596407","subId":null,"template":"carousel","width":"680","height":"140"});</script><p>※ 쿠팡 파트너스 활동을 통해 일정액의 수수료를 제공받을 수 있습니다.</p></div><center><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:29px!important;height:30px!important;text-decoration:none!important;display:inline-flex!important;color:#000!important;background-color:#fd0!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#000!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><center><br><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/taetaetae><img src=https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg alt="Buy me a coffee"><span style=margin-left:5px>Buy me a coffee</span></a>
<a href=https://bit.ly/ddbSupport target=_blank><img src=https://i.imgur.com/peaYpjh.png style=height:28px></a></center><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2019-06-30</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Spring에서 Request를 우아하게 로깅하기" data-hashtags=spring,logging,HttpServletRequestWrapper,Filter,AOP,archives-2019><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-hashtag=spring><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2019/06/30/controller-common-logging/ data-title="Spring에서 Request를 우아하게 로깅하기" data-description><i class="fab fa-blogger fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/spring/>spring</a>,&nbsp;<a href=/tags/logging/>logging</a>,&nbsp;<a href=/tags/httpservletrequestwrapper/>HttpServletRequestWrapper</a>,&nbsp;<a href=/tags/filter/>Filter</a>,&nbsp;<a href=/tags/aop/>AOP</a>,&nbsp;<a href=/tags/archives-2019/>archives-2019</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2019/05/19/d-light-togetherthon-2019/ class=prev rel=prev title="D.light 투게더톤 참가후기"><i class="fas fa-angle-left fa-fw"></i>D.light 투게더톤 참가후기</a>
<a href=/2019/07/07/review-first-half-2019/ class=next rel=next title="2019 상반기 리뷰 (feat. 글또)">2019 상반기 리뷰 (feat. 글또)<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>태태태</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment","lightTheme":"github-light","repo":"taetaetae/blog-comment"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-86432198-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
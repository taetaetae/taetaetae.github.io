<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>조금 더 괜찮은 Rest Template 2부 - Circuit-breaker - 👨‍💻꿈꾸는 태태태의 공간</title><meta name=Description content><meta property="og:title" content="조금 더 괜찮은 Rest Template 2부 - Circuit-breaker"><meta property="og:description" content="지난 포스팅에서는 Retryable 를 활용해서 간헐적인 네트워크 오류를 &ldquo;재시도&#34;를 함으로써 아주 간단하면서도 강력하게 해결할 수 있는 방법에 대해 알아보았다. 실제로 필자가 운영하는 서비스 에서도 Retryable 를 이용하기 전과 후를 비교해보면 간헐적인 네트워크 오류의 빈도수가 확실히 줄어든것을 확인할 수 있었다. 이렇게 &ldquo;재시도&#34;를 해서 요청했을때 성공 응답을 받을 경우엔 문제가 안되지만 네트워크 오류가 아닌 실제로 호출을 받는 해당 서버에서 문제가 발생했다면 어떨까? 예컨대, 해당 서버에서 DB를 조회하는 API를 호출한다고 가정했을때 DB 자체에서 어떠한 오류가 난다면. 이런 경우는 단순히 &ldquo;재시도&#34;로 해결할 수 없는 문제다.
물론 Retryable 의 Recover 어노테이션을 활용했기 때문에 클라이언트 즉, 사용자에게는 오류응답이 발생을 안했겠지만 호출 받는 서버 자체에서의 에러가 발생하는데 이런식의 재시도를 계속 시도한다면 호출 받는 서버 입장에서는 이 &ldquo;재시도&rdquo; request 또한 &ldquo;부하&rdquo; 로 받게 되고 결국 2차, 3차 장애가 이어질 수 밖에 없다.
기존 한덩어리로 관리되던 Monolithic Architecture 에서는 자체적으로 관리하기 때문에 이러한 에러 컨트롤 또한 자체적으로 관리를 할 수 있지만, 모듈이 모듈을 호출하게 되는 Microservice Architecture 로 바뀌다보니 이런 &ldquo;연쇄 장애(?)&rdquo; 같은 현상이 발생하게 되는 경우가 있다. 호출을 받는 서버의 상태가 이상하면 (에러응답이 지정한 임계치를 벗어나는 수준으로 맞춰서 발생한다면) 적절하게 호출을 하지 않고 (2차 장애를 내지 않도록 호출 자체를 하지 않고) 어느정도 기다리다 클라이언트에게는 에러응답이 아닌 미리 정해둔 응답을 내려주고, 에러가 복구되면 다시 호출하도록 하는 &ldquo;무언가&rdquo; 가 필요하지 않을까?
연쇄 장애. 제발 멈춰&mldr; 출처 : http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389&#34; 연쇄 장애. 제발 멈춰&mldr; 출처 : http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389  지난 포스팅에 이어 이번 포스팅 에서는 그 &ldquo;무언가&rdquo;. 즉, Circuit-breaker 에 대해 알아보고 직접 구현 및 테스트 하면서 돌아가는 원리에 대해 이해 해보고자 한다. 막상 개념은 머릿속에 있지만 직접 구현해보지 않으면 내것이 아니기에, 직접 구현하고 설정값들을 바꿔가면서 언젠가 필요한 순간에 꺼내서 사용할 수 있는 나만의 &ldquo;무기&rdquo; 를 만들어 보고자 한다.
Circuit breaker ? (한국 발음으로) 서킷브레이커를 검색해보면 주식시장 관련된 내용이 꽤 나온다. (앗, 잠깐 눈물좀&mldr;) 서킷 브레이커. 이 용어는 다양한 곳에서 사용되는데 &ldquo;회로 차단기&rdquo; 라고도 검색이 된다. 해당 내용을 발췌해보면 다음과 같다.
 회로 차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다. 과부하 차단기와 누전 차단기로 나뉜다. 퓨즈와 다른 점은, 차단기는 어느 정도 시간이 지난 뒤, 원래의 기능이 동작하도록 복귀된다.
 여기서 가장 중요한 문장은 &ldquo;피해를 막기 위해 자동으로 회로를 정지시키는&rdquo;, &ldquo;어느정도 시간이 지난뒤 원래의 기능이 동작하도록 복귀된다&rdquo; 이 부분이 가장 중요한 것 같다. 시스템 구성이 점점 Microservice Architecture 로 바뀌어 가는 시점에서 이러한 &ldquo;서킷브레이커&#34;는 자동으로 모듈간의 호출 에러를 감지하고 위에서 말한 &ldquo;연쇄 장애&#34;를 사전에 막을 수 있는 아주 중요한 기능이라 생각된다.
&ldquo;circuit breaker spring&rdquo; 이라는 키워드로 검색해보면 이러한 고민을 이미 Netflix 라는 회사에서 Hystrix 라는 이름으로 개발이 된것을 알 수 있다. 이 core 모듈을 Spring 에서 한번 더 감싸서 Spring Boot 에서 사용하기 좋게 spring-cloud-starter-netflix-hystrix 라는 이름으로 만들어 둔 것이 있는데 이것을 활용해 보기로 하자.
구현 늘 그랬듯이 SpringBoot 프로젝트를 만들고 테스트할 Controller 를 만들어 주자. 원래대로라면 호출을 하는 모듈과 호출을 받는 모듈, 2개의 모듈을 만들어서 테스트 해야 하지만 편의를 위해 하나의 모듈에서 두개의 Controller 을 만들고 테스트 해보는 것으로 하자.
@RestController public class MainController { private final MainService mainService; @GetMapping(&#34;index&#34;) public String index(String key){ return mainService.getResult(key); } public MainController(MainService mainService) { this.mainService = mainService; } } @Slf4j @Service public class MainService { private RestTemplate restTemplate; public String getResult(String key) { return restTemplate."><meta property="og:type" content="article"><meta property="og:url" content="https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/"><meta property="og:image" content="https://taetaetae.github.io/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg"><meta property="article:published_time" content="2020-03-29T23:09:16+00:00"><meta property="article:modified_time" content="2020-03-29T23:09:16+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg"><meta name=twitter:title content="조금 더 괜찮은 Rest Template 2부 - Circuit-breaker"><meta name=twitter:description content="지난 포스팅에서는 Retryable 를 활용해서 간헐적인 네트워크 오류를 &ldquo;재시도&#34;를 함으로써 아주 간단하면서도 강력하게 해결할 수 있는 방법에 대해 알아보았다. 실제로 필자가 운영하는 서비스 에서도 Retryable 를 이용하기 전과 후를 비교해보면 간헐적인 네트워크 오류의 빈도수가 확실히 줄어든것을 확인할 수 있었다. 이렇게 &ldquo;재시도&#34;를 해서 요청했을때 성공 응답을 받을 경우엔 문제가 안되지만 네트워크 오류가 아닌 실제로 호출을 받는 해당 서버에서 문제가 발생했다면 어떨까? 예컨대, 해당 서버에서 DB를 조회하는 API를 호출한다고 가정했을때 DB 자체에서 어떠한 오류가 난다면. 이런 경우는 단순히 &ldquo;재시도&#34;로 해결할 수 없는 문제다.
물론 Retryable 의 Recover 어노테이션을 활용했기 때문에 클라이언트 즉, 사용자에게는 오류응답이 발생을 안했겠지만 호출 받는 서버 자체에서의 에러가 발생하는데 이런식의 재시도를 계속 시도한다면 호출 받는 서버 입장에서는 이 &ldquo;재시도&rdquo; request 또한 &ldquo;부하&rdquo; 로 받게 되고 결국 2차, 3차 장애가 이어질 수 밖에 없다.
기존 한덩어리로 관리되던 Monolithic Architecture 에서는 자체적으로 관리하기 때문에 이러한 에러 컨트롤 또한 자체적으로 관리를 할 수 있지만, 모듈이 모듈을 호출하게 되는 Microservice Architecture 로 바뀌다보니 이런 &ldquo;연쇄 장애(?)&rdquo; 같은 현상이 발생하게 되는 경우가 있다. 호출을 받는 서버의 상태가 이상하면 (에러응답이 지정한 임계치를 벗어나는 수준으로 맞춰서 발생한다면) 적절하게 호출을 하지 않고 (2차 장애를 내지 않도록 호출 자체를 하지 않고) 어느정도 기다리다 클라이언트에게는 에러응답이 아닌 미리 정해둔 응답을 내려주고, 에러가 복구되면 다시 호출하도록 하는 &ldquo;무언가&rdquo; 가 필요하지 않을까?
연쇄 장애. 제발 멈춰&mldr; 출처 : http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389&#34; 연쇄 장애. 제발 멈춰&mldr; 출처 : http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389  지난 포스팅에 이어 이번 포스팅 에서는 그 &ldquo;무언가&rdquo;. 즉, Circuit-breaker 에 대해 알아보고 직접 구현 및 테스트 하면서 돌아가는 원리에 대해 이해 해보고자 한다. 막상 개념은 머릿속에 있지만 직접 구현해보지 않으면 내것이 아니기에, 직접 구현하고 설정값들을 바꿔가면서 언젠가 필요한 순간에 꺼내서 사용할 수 있는 나만의 &ldquo;무기&rdquo; 를 만들어 보고자 한다.
Circuit breaker ? (한국 발음으로) 서킷브레이커를 검색해보면 주식시장 관련된 내용이 꽤 나온다. (앗, 잠깐 눈물좀&mldr;) 서킷 브레이커. 이 용어는 다양한 곳에서 사용되는데 &ldquo;회로 차단기&rdquo; 라고도 검색이 된다. 해당 내용을 발췌해보면 다음과 같다.
 회로 차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다. 과부하 차단기와 누전 차단기로 나뉜다. 퓨즈와 다른 점은, 차단기는 어느 정도 시간이 지난 뒤, 원래의 기능이 동작하도록 복귀된다.
 여기서 가장 중요한 문장은 &ldquo;피해를 막기 위해 자동으로 회로를 정지시키는&rdquo;, &ldquo;어느정도 시간이 지난뒤 원래의 기능이 동작하도록 복귀된다&rdquo; 이 부분이 가장 중요한 것 같다. 시스템 구성이 점점 Microservice Architecture 로 바뀌어 가는 시점에서 이러한 &ldquo;서킷브레이커&#34;는 자동으로 모듈간의 호출 에러를 감지하고 위에서 말한 &ldquo;연쇄 장애&#34;를 사전에 막을 수 있는 아주 중요한 기능이라 생각된다.
&ldquo;circuit breaker spring&rdquo; 이라는 키워드로 검색해보면 이러한 고민을 이미 Netflix 라는 회사에서 Hystrix 라는 이름으로 개발이 된것을 알 수 있다. 이 core 모듈을 Spring 에서 한번 더 감싸서 Spring Boot 에서 사용하기 좋게 spring-cloud-starter-netflix-hystrix 라는 이름으로 만들어 둔 것이 있는데 이것을 활용해 보기로 하자.
구현 늘 그랬듯이 SpringBoot 프로젝트를 만들고 테스트할 Controller 를 만들어 주자. 원래대로라면 호출을 하는 모듈과 호출을 받는 모듈, 2개의 모듈을 만들어서 테스트 해야 하지만 편의를 위해 하나의 모듈에서 두개의 Controller 을 만들고 테스트 해보는 것으로 하자.
@RestController public class MainController { private final MainService mainService; @GetMapping(&#34;index&#34;) public String index(String key){ return mainService.getResult(key); } public MainController(MainService mainService) { this.mainService = mainService; } } @Slf4j @Service public class MainService { private RestTemplate restTemplate; public String getResult(String key) { return restTemplate."><meta name=application-name content="👨‍💻꿈꾸는 태태태의 공간"><meta name=apple-mobile-web-app-title content="👨‍💻꿈꾸는 태태태의 공간"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/><link rel=prev href=https://taetaetae.github.io/2020/03/26/7-years-of-development-1st-day-of-manager/><link rel=next href=https://taetaetae.github.io/2020/04/06/spring-boot-filter/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"조금 더 괜찮은 Rest Template 2부 - Circuit-breaker","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2020\/03\/29\/better-rest-template-2-netflix-hystrix\/"},"genre":"posts","keywords":"spring boot, circuit breaker, Netflix, Hystrix, archives-2020","wordcount":2417,"url":"https:\/\/taetaetae.github.io\/2020\/03\/29\/better-rest-template-2-netflix-hystrix\/","datePublished":"2020-03-29T23:09:16+00:00","dateModified":"2020-03-29T23:09:16+00:00","publisher":{"@type":"Organization","name":"태태태"},"author":{"@type":"Person","name":"태태태"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:260px;height:600px data-ad-client=ca-pub-5788330009690816 data-ad-slot=2248955907></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><article class="page single"><h1 class="single-title animated flipInX">조금 더 괜찮은 Rest Template 2부 - Circuit-breaker</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>태태태</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-03-29>2020-03-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2417 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg data-srcset="/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg, /images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg 1.5x, /images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg 2x" data-sizes=auto alt=/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg title=/images/better-rest-template-2-netflix-hystrix/netflix_hystrix.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#circuit-breaker->Circuit breaker ?</a></li><li><a href=#구현>구현</a></li><li><a href=#테스트>테스트</a></li><li><a href=#모니터링>모니터링</a></li><li><a href=#마치며>마치며</a></li></ul></nav></div></div><div class=content id=content><p><a href=/2020/03/22/better-rest-template-1-retryable/ rel>지난 포스팅</a>에서는 Retryable 를 활용해서 간헐적인 네트워크 오류를 &ldquo;재시도"를 함으로써 아주 간단하면서도 강력하게 해결할 수 있는 방법에 대해 알아보았다. 실제로 필자가 운영하는 서비스 에서도 Retryable 를 이용하기 전과 후를 비교해보면 간헐적인 네트워크 오류의 빈도수가 확실히 줄어든것을 확인할 수 있었다.</p><p>이렇게 &ldquo;재시도"를 해서 요청했을때 성공 응답을 받을 경우엔 문제가 안되지만 네트워크 오류가 아닌 실제로 호출을 받는 해당 서버에서 문제가 발생했다면 어떨까? 예컨대, 해당 서버에서 DB를 조회하는 API를 호출한다고 가정했을때 DB 자체에서 어떠한 오류가 난다면. 이런 경우는 단순히 &ldquo;재시도"로 해결할 수 없는 문제다.</p><p>물론 Retryable 의 Recover 어노테이션을 활용했기 때문에 클라이언트 즉, 사용자에게는 오류응답이 발생을 안했겠지만 호출 받는 서버 자체에서의 에러가 발생하는데 이런식의 재시도를 계속 시도한다면 호출 받는 서버 입장에서는 이 &ldquo;재시도&rdquo; request 또한 &ldquo;부하&rdquo; 로 받게 되고 결국 2차, 3차 장애가 이어질 수 밖에 없다.</p><p>기존 한덩어리로 관리되던 Monolithic Architecture 에서는 자체적으로 관리하기 때문에 이러한 에러 컨트롤 또한 자체적으로 관리를 할 수 있지만, 모듈이 모듈을 호출하게 되는 Microservice Architecture 로 바뀌다보니 이런 &ldquo;연쇄 장애(?)&rdquo; 같은 현상이 발생하게 되는 경우가 있다. 호출을 받는 서버의 상태가 이상하면 (에러응답이 지정한 임계치를 벗어나는 수준으로 맞춰서 발생한다면) 적절하게 호출을 하지 않고 (2차 장애를 내지 않도록 호출 자체를 하지 않고) 어느정도 기다리다 클라이언트에게는 에러응답이 아닌 미리 정해둔 응답을 내려주고, 에러가 복구되면 다시 호출하도록 하는 &ldquo;무언가&rdquo; 가 필요하지 않을까?</p><figure><a class=lightgallery href=/images/better-rest-template-2-netflix-hystrix/domino.gif title=/images/better-rest-template-2-netflix-hystrix/domino.gif data-thumbnail=/images/better-rest-template-2-netflix-hystrix/domino.gif data-sub-html="<h2>연쇄 장애. 제발 멈춰&mldr;  출처 : http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/better-rest-template-2-netflix-hystrix/domino.gif data-srcset="/images/better-rest-template-2-netflix-hystrix/domino.gif, /images/better-rest-template-2-netflix-hystrix/domino.gif 1.5x, /images/better-rest-template-2-netflix-hystrix/domino.gif 2x" data-sizes=auto alt=/images/better-rest-template-2-netflix-hystrix/domino.gif width=30%></a><figcaption class=image-caption>연쇄 장애. 제발 멈춰&mldr;<br>출처 : <a href="http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389">http://dpg.danawa.com/mobile/community/view?boardSeq=175&listSeq=4066389</a></figcaption></figure><p>지난 포스팅에 이어 이번 포스팅 에서는 그 &ldquo;무언가&rdquo;. 즉, Circuit-breaker 에 대해 알아보고 직접 구현 및 테스트 하면서 돌아가는 원리에 대해 이해 해보고자 한다. 막상 개념은 머릿속에 있지만 직접 구현해보지 않으면 내것이 아니기에, 직접 구현하고 설정값들을 바꿔가면서 언젠가 필요한 순간에 꺼내서 사용할 수 있는 나만의 &ldquo;무기&rdquo; 를 만들어 보고자 한다.</p><h2 id=circuit-breaker->Circuit breaker ?</h2><p>(한국 발음으로) 서킷브레이커를 검색해보면 주식시장 관련된 내용이 꽤 나온다. (앗, 잠깐 눈물좀&mldr;) <a href=http://bitly.kr/kSm6Y target=_blank rel="noopener noreffer">서킷 브레이커</a>. 이 용어는 다양한 곳에서 사용되는데 &ldquo;회로 차단기&rdquo; 라고도 검색이 된다. 해당 내용을 발췌해보면 다음과 같다.</p><blockquote><p>회로 차단기는 전기 회로에서 과부하가 걸리거나 단락으로 인한 피해를 막기 위해 자동으로 회로를 정지시키는 장치이다. 과부하 차단기와 누전 차단기로 나뉜다. 퓨즈와 다른 점은, 차단기는 어느 정도 시간이 지난 뒤, 원래의 기능이 동작하도록 복귀된다.</p></blockquote><p>여기서 가장 중요한 문장은 &ldquo;피해를 막기 위해 자동으로 회로를 정지시키는&rdquo;, &ldquo;어느정도 시간이 지난뒤 원래의 기능이 동작하도록 복귀된다&rdquo; 이 부분이 가장 중요한 것 같다. 시스템 구성이 점점 Microservice Architecture 로 바뀌어 가는 시점에서 이러한 &ldquo;서킷브레이커"는 자동으로 모듈간의 호출 에러를 감지하고 위에서 말한 &ldquo;연쇄 장애"를 사전에 막을 수 있는 아주 중요한 기능이라 생각된다.</p><p>&ldquo;circuit breaker spring&rdquo; 이라는 키워드로 검색해보면 이러한 고민을 이미 Netflix 라는 회사에서 <a href=https://github.com/Netflix/Hystrix target=_blank rel="noopener noreffer">Hystrix</a> 라는 이름으로 개발이 된것을 알 수 있다. 이 core 모듈을 Spring 에서 한번 더 감싸서 Spring Boot 에서 사용하기 좋게 spring-cloud-starter-netflix-hystrix 라는 이름으로 만들어 둔 것이 있는데 이것을 활용해 보기로 하자.</p><h2 id=구현>구현</h2><p>늘 그랬듯이 SpringBoot 프로젝트를 만들고 테스트할 Controller 를 만들어 주자. 원래대로라면 호출을 하는 모듈과 호출을 받는 모듈, 2개의 모듈을 만들어서 테스트 해야 하지만 편의를 위해 하나의 모듈에서 두개의 Controller 을 만들고 테스트 해보는 것으로 하자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@RestController</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainController</span> <span class=o>{</span>

	<span class=kd>private</span> <span class=kd>final</span> <span class=n>MainService</span> <span class=n>mainService</span><span class=o>;</span>

	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;index&#34;</span><span class=o>)</span>
	<span class=kd>public</span> <span class=n>String</span> <span class=nf>index</span><span class=o>(</span><span class=n>String</span> <span class=n>key</span><span class=o>){</span>
		<span class=k>return</span> <span class=n>mainService</span><span class=o>.</span><span class=na>getResult</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=nf>MainController</span><span class=o>(</span><span class=n>MainService</span> <span class=n>mainService</span><span class=o>)</span> <span class=o>{</span>
		<span class=k>this</span><span class=o>.</span><span class=na>mainService</span> <span class=o>=</span> <span class=n>mainService</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>

<span class=nd>@Slf4j</span>
<span class=nd>@Service</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainService</span> <span class=o>{</span>

	<span class=kd>private</span> <span class=n>RestTemplate</span> <span class=n>restTemplate</span><span class=o>;</span>

	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getResult</span><span class=o>(</span><span class=n>String</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>
		<span class=k>return</span> <span class=n>restTemplate</span><span class=o>.</span><span class=na>getForObject</span><span class=o>(</span><span class=s>&#34;http://localhost:8080/target?key=&#34;</span> <span class=o>+</span> <span class=n>key</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=nf>MainService</span><span class=o>(</span><span class=n>RestTemplate</span> <span class=n>restTemplate</span><span class=o>)</span> <span class=o>{</span>
		<span class=k>this</span><span class=o>.</span><span class=na>restTemplate</span> <span class=o>=</span> <span class=n>restTemplate</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>


<span class=nd>@Slf4j</span>
<span class=nd>@RestController</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TargetContoller</span> <span class=o>{</span>

	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/target&#34;</span><span class=o>)</span>
	<span class=kd>public</span> <span class=n>String</span> <span class=nf>target</span><span class=o>(</span><span class=n>String</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;input key : {}&#34;</span><span class=o>,</span> <span class=n>key</span><span class=o>);</span>
		<span class=k>if</span> <span class=o>(!</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;taetaetae&#34;</span><span class=o>,</span> <span class=n>key</span><span class=o>))</span> <span class=o>{</span>
			<span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;Invalid key&#34;</span><span class=o>);</span>
		<span class=o>}</span>
		<span class=k>return</span> <span class=s>&#34;target&#34;</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>

</code></pre></div><p>사실 설명할 부분도 없긴 하지만 그래도 적어보면, <code>/index</code>라는 주소와 <code>key</code>라는 파라미터로 요청을 하면 <code>/target</code>이라는 컨트롤러가 받아서 <code>key</code> 값에 따라 정상 응답을 줄지 아니면 에러를 응답하는 코드이다. 목표로 하는건, 파라미터를 일부러 잘못줘서 에러를 발생하는데 Hystrix를 적용해서 설정한 기준에 따라 응답은 미리 정해둔 응답을, <code>TargetContoller</code>에서는 잠시동안 요청을 받지 않다가 조금있다가 다시 호출하면 요청을 받는 시나리오로 작성해 보려 한다.
우선 필요한 dependency를 추가해준다.</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;dependency&gt;</span>
	<span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
	<span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-web<span class=nt>&lt;/artifactId&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
	<span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
	<span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix<span class=nt>&lt;/artifactId&gt;</span>
	<span class=nt>&lt;version&gt;</span>2.2.2.RELEASE<span class=nt>&lt;/version&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>

</code></pre></div><p>처음에 한참 했갈렸는데 &ldquo;spring-cloud-starter-hystrix"가 아니고 &ldquo;spring-cloud-starter-netflix-hystrix"를 적용해야 이상없이 돌아간다. (참고 : <a href=https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-hystrix>https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-hystrix</a>) 그 다음 실제 적용할 코드에 Hystrix 설정을 적용해 주자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@EnableCircuitBreaker</span> <span class=c1>// 1
</span><span class=c1></span><span class=nd>@SpringBootApplication</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HystrixApplication</span> <span class=o>{</span>
	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>SpringApplication</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=n>HystrixApplication</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><ol><li>SpringBoot를 사용하면서 비슷하게 적용되는 EnableXXX 어노테이션, 이번에도 @EnableCircuitBreaker 어노테이션을 적용해 주면서 CircuitBreaker 를 사용하겠다고 지정해 주자.</li></ol><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Service</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainService</span> <span class=o>{</span>

	<span class=kd>private</span> <span class=n>RestTemplate</span> <span class=n>restTemplate</span><span class=o>;</span>

	<span class=nd>@HystrixCommand</span><span class=o>(</span> <span class=c1>// 1
</span><span class=c1></span>		<span class=n>fallbackMethod</span> <span class=o>=</span> <span class=s>&#34;fallbackMethod&#34;</span><span class=o>,</span> <span class=c1>// 2
</span><span class=c1></span>		<span class=n>commandProperties</span> <span class=o>=</span> <span class=o>{</span>
			<span class=nd>@HystrixProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;execution.isolation.thread.timeoutInMilliseconds&#34;</span><span class=o>,</span> <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;500&#34;</span><span class=o>),</span> <span class=c1>// 3
</span><span class=c1></span>			<span class=nd>@HystrixProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;circuitBreaker.requestVolumeThreshold&#34;</span><span class=o>,</span> <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;2&#34;</span><span class=o>),</span> <span class=c1>// 4
</span><span class=c1></span>			<span class=nd>@HystrixProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;circuitBreaker.sleepWindowInMilliseconds&#34;</span><span class=o>,</span> <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;2000&#34;</span><span class=o>),</span> <span class=c1>// 5
</span><span class=c1></span>			<span class=nd>@HystrixProperty</span><span class=o>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;circuitBreaker.errorThresholdPercentage&#34;</span><span class=o>,</span> <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;30&#34;</span><span class=o>)</span> <span class=c1>// 6
</span><span class=c1></span>		<span class=o>})</span>
	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getResult</span><span class=o>(</span><span class=n>String</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>
		<span class=k>return</span> <span class=n>restTemplate</span><span class=o>.</span><span class=na>getForObject</span><span class=o>(</span><span class=s>&#34;http://localhost:8080/target?key=&#34;</span> <span class=o>+</span> <span class=n>key</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=n>String</span> <span class=nf>fallbackMethod</span><span class=o>(</span><span class=n>String</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>
		<span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;fallbackMethod, param : {}&#34;</span><span class=o>,</span> <span class=n>key</span><span class=o>);</span>
		<span class=k>return</span> <span class=s>&#34;defaultResult&#34;</span><span class=o>;</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=nf>MainService</span><span class=o>(</span><span class=n>RestTemplate</span> <span class=n>restTemplate</span><span class=o>)</span> <span class=o>{</span>
		<span class=k>this</span><span class=o>.</span><span class=na>restTemplate</span> <span class=o>=</span> <span class=n>restTemplate</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><ol><li><a href=https://spring.io/guides/gs/circuit-breaker/ target=_blank rel="noopener noreffer">스프링 가이드</a>에 따르면 <code>@Component</code> 나 <code>@Service</code> 하위에서 <code>@HystrixCommand</code>어노테이션을 찾아 작동한다고 나와있다. 때문에 우리가 적용할 &ldquo;MainService.getResult()&ldquo;에 지정해 주도록 하자.</li></ol><blockquote><p>Spring Cloud Netflix Hystrix looks for any method annotated with the @HystrixCommand annotation and wraps that method in a proxy connected to a circuit breaker so that Hystrix can monitor it. This currently works only in a class marked with @Component or @Service.</p></blockquote><ol start=2><li><p>fallbackMethod 을 이용하여 호출했을때 에러가 발생하면 실행할 메소드를 지정해주자. 즉, 설정한 기준에 도달하여 에러응답 대신 지정한 응답을 내려줄 경우 해당 메소드를 사용하게 된다.</p></li><li><p>타임아웃을 지정해 준다. 여기서는 500ms 안에 응답이 없을 경우 에러라고 판단.</p></li><li><p>서킷브레이커가 open 되는 최소 단위. 필자는 테스트를 위해 극단적(2)으로 지정하였지만 상황에 따라 해당 값을 커스터마징 할 필요가 있다.</p></li><li><p>서킷브레이커가 지속되는 시간. 2초동안 지속되도록 한다.</p></li><li><p>서킷브레이커가 open 되는 에러율. 다른값들과 우선순위를 잘 따져봐야 한다. 테스트를 위해 무조건 한번이라도 에러 발생할 경우 open 해도록 지정해두었다.</p></li></ol><p>이 외에도 정말 <a href=https://github.com/Netflix/Hystrix/wiki/configuration target=_blank rel="noopener noreffer">다양한 설정값</a>들이 있는데 기본 설정값으로 했을때 시스템 성격에 맞지 않는다면 커스터마이징을 통해 현 시스템에 가장 적절한 값을 찾아야 할 것이다.</p><h2 id=테스트>테스트</h2><p>자. 뭔가 여러가지 설정을 했는데 이제 테스트를 해보자. 테스트를 하면서 설정값들을 이해하는게 가장 빠르다. 자세한 로그를 확인하기 위해 편의상 application.properties 에 <code>debug=true</code> 설정을 해두었다.</p><p>우선 정상응답을 얻기 위해 &ldquo;/index?key=taetaetae&rdquo; 라고 호출해보면 response 또한 &ldquo;ok&rdquo; 라고 나오는 것을 알 수 있다.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>2020-03-30 01:55:29.866 DEBUG <span class=m>13496</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taetaetae&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 01:55:29.871 DEBUG <span class=m>13496</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 01:55:30.057 DEBUG <span class=m>13496</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : HTTP GET http://localhost:8080/target?key<span class=o>=</span>taetaetae
2020-03-30 01:55:30.059 DEBUG <span class=m>13496</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : <span class=nv>Accept</span><span class=o>=[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span>
2020-03-30 01:55:30.065 DEBUG <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/target?key=taetaetae&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 01:55:30.065 DEBUG <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.target.TargetContoller#target<span class=o>(</span>String<span class=o>)</span>
2020-03-30 01:55:30.066  INFO <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> c.t.hystrix.target.TargetContoller       : input key : taetaetae
2020-03-30 01:55:30.073 DEBUG <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/plain&#39;</span>, given <span class=o>[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 01:55:30.074 DEBUG <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;ok&#34;</span><span class=o>]</span>
2020-03-30 01:55:30.077 DEBUG <span class=m>13496</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK
2020-03-30 01:55:30.079 DEBUG <span class=m>13496</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : Response <span class=m>200</span> OK
2020-03-30 01:55:30.080 DEBUG <span class=m>13496</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : Reading to <span class=o>[</span>java.lang.String<span class=o>]</span> as <span class=s2>&#34;text/plain;charset=UTF-8&#34;</span>
2020-03-30 01:55:30.087 DEBUG <span class=m>13496</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 01:55:30.087 DEBUG <span class=m>13496</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;ok&#34;</span><span class=o>]</span>
2020-03-30 01:55:30.089 DEBUG <span class=m>13496</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK
</code></pre></div><p>자 이제 실패가 되도록 잘못된 파라미터를 호출하게 되면 어떻게 될까? &ldquo;/index?key=taekwan&rdquo;</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>2020-03-30 01:57:48.025 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 01:57:48.031 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 01:57:48.222 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : HTTP GET http://localhost:8080/target?key<span class=o>=</span>taekwan
2020-03-30 01:57:48.224 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : <span class=nv>Accept</span><span class=o>=[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span>
2020-03-30 01:57:48.229 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/target?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 01:57:48.229 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.target.TargetContoller#target<span class=o>(</span>String<span class=o>)</span>
2020-03-30 01:57:48.230  INFO <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> c.t.hystrix.target.TargetContoller       : input key : taekwan
2020-03-30 01:57:48.237 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Failed to <span class=nb>complete</span> request: java.lang.RuntimeException: Invalid key
2020-03-30 01:57:48.244 ERROR <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.a.c.c.C.<span class=o>[</span>.<span class=o>[</span>.<span class=o>[</span>/<span class=o>]</span>.<span class=o>[</span>dispatcherServlet<span class=o>]</span>    : Servlet.service<span class=o>()</span> <span class=k>for</span> servlet <span class=o>[</span>dispatcherServlet<span class=o>]</span> in context with path <span class=o>[]</span> threw exception <span class=o>[</span>Request processing failed<span class=p>;</span> nested exception is java.lang.RuntimeException: Invalid key<span class=o>]</span> with root cause

java.lang.RuntimeException: Invalid key
	at com.taetaetae.hystrix.target.TargetContoller.target<span class=o>(</span>TargetContoller.java:19<span class=o>)</span> ~<span class=o>[</span>classes/:na<span class=o>]</span>
	... 중략

2020-03-30 01:57:48.247 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : <span class=s2>&#34;ERROR&#34;</span> dispatch <span class=k>for</span> GET <span class=s2>&#34;/error?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 01:57:48.250 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error<span class=o>(</span>HttpServletRequest<span class=o>)</span>
2020-03-30 01:57:48.256 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Using <span class=s1>&#39;application/json&#39;</span>, given <span class=o>[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span> and supported <span class=o>[</span>application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 01:57:48.257 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Writing <span class=o>[{</span><span class=nv>timestamp</span><span class=o>=</span>Mon Mar <span class=m>30</span> 01:57:48 KST 2020, <span class=nv>status</span><span class=o>=</span>500, <span class=nv>error</span><span class=o>=</span>Internal Server Error, <span class=nv>message</span><span class=o>=</span>Invalid ke <span class=o>(</span>truncated<span class=o>)</span>...<span class=o>]</span>
2020-03-30 01:57:48.267 DEBUG <span class=m>19084</span> --- <span class=o>[</span>io-8080-exec-10<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Exiting from <span class=s2>&#34;ERROR&#34;</span> dispatch, status <span class=m>500</span>
2020-03-30 01:57:48.267 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> o.s.web.client.RestTemplate              : Response <span class=m>500</span> INTERNAL_SERVER_ERROR
2020-03-30 01:57:48.277  INFO <span class=m>19084</span> --- <span class=o>[</span>x-MainService-1<span class=o>]</span> com.taetaetae.hystrix.main.MainService   : fallbackMethod, param : taekwan
2020-03-30 01:57:48.282 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 01:57:48.282 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;defaultResult&#34;</span><span class=o>]</span>
2020-03-30 01:57:48.283 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-9<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK
</code></pre></div><p>(로그가 길지만&mldr;) 위 내용을 보면 fallbackMethod 가 호출된 것을 확인할 수 있고, 응답 또한 200 OK 에 미리 지정해 둔 &ldquo;defaultResult"를 내려준 것을 확인할 수 있다. 하지만 <code>TargetContoller</code> 에서 요청이 들어오면 로깅하려고 한 부분이 찍힌것을 보면, 에러 응답에 대한 fallbackMethod 는 호출 되었지만 실제로 서킷브레이커는 open 이 안된것을 확인할 수 있다. 그럼 좀더 빠른 시간내에 여러번 호출해보면 어떻게 될까??</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>2020-03-30 02:03:28.040 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:28.040 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 02:03:28.042 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-5<span class=o>]</span> o.s.web.client.RestTemplate              : HTTP GET http://localhost:8080/target?key<span class=o>=</span>taekwan
2020-03-30 02:03:28.042 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-5<span class=o>]</span> o.s.web.client.RestTemplate              : <span class=nv>Accept</span><span class=o>=[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span>
2020-03-30 02:03:28.046 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/target?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:28.047 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.target.TargetContoller#target<span class=o>(</span>String<span class=o>)</span>
2020-03-30 02:03:28.047  INFO <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> c.t.hystrix.target.TargetContoller       : input key : taekwan
2020-03-30 02:03:28.047 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Failed to <span class=nb>complete</span> request: java.lang.RuntimeException: Invalid key
2020-03-30 02:03:28.048 ERROR <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.a.c.c.C.<span class=o>[</span>.<span class=o>[</span>.<span class=o>[</span>/<span class=o>]</span>.<span class=o>[</span>dispatcherServlet<span class=o>]</span>    : Servlet.service<span class=o>()</span> <span class=k>for</span> servlet <span class=o>[</span>dispatcherServlet<span class=o>]</span> in context with path <span class=o>[]</span> threw exception <span class=o>[</span>Request processing failed<span class=p>;</span> nested exception is java.lang.RuntimeException: Invalid key<span class=o>]</span> with root cause

java.lang.RuntimeException: Invalid key
	at com.taetaetae.hystrix.target.TargetContoller.target<span class=o>(</span>TargetContoller.java:19<span class=o>)</span> ~<span class=o>[</span>classes/:na<span class=o>]</span>
	... 중략	

2020-03-30 02:03:28.048 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : <span class=s2>&#34;ERROR&#34;</span> dispatch <span class=k>for</span> GET <span class=s2>&#34;/error?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:28.048 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error<span class=o>(</span>HttpServletRequest<span class=o>)</span>
2020-03-30 02:03:28.049 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Using <span class=s1>&#39;application/json&#39;</span>, given <span class=o>[</span>text/plain, application/json, application/*+json, */*<span class=o>]</span> and supported <span class=o>[</span>application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 02:03:28.049 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.w.s.m.m.a.HttpEntityMethodProcessor  : Writing <span class=o>[{</span><span class=nv>timestamp</span><span class=o>=</span>Mon Mar <span class=m>30</span> 02:03:28 KST 2020, <span class=nv>status</span><span class=o>=</span>500, <span class=nv>error</span><span class=o>=</span>Internal Server Error, <span class=nv>message</span><span class=o>=</span>Invalid ke <span class=o>(</span>truncated<span class=o>)</span>...<span class=o>]</span>
2020-03-30 02:03:28.049 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Exiting from <span class=s2>&#34;ERROR&#34;</span> dispatch, status <span class=m>500</span>
2020-03-30 02:03:28.049 DEBUG <span class=m>19084</span> --- <span class=o>[</span>x-MainService-5<span class=o>]</span> o.s.web.client.RestTemplate              : Response <span class=m>500</span> INTERNAL_SERVER_ERROR
2020-03-30 02:03:28.050  INFO <span class=m>19084</span> --- <span class=o>[</span>x-MainService-5<span class=o>]</span> com.taetaetae.hystrix.main.MainService   : fallbackMethod, param : taekwan
2020-03-30 02:03:28.051 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 02:03:28.051 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;defaultResult&#34;</span><span class=o>]</span>
2020-03-30 02:03:28.052 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK


2020-03-30 02:03:28.679 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:28.679 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 02:03:28.680  INFO <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> com.taetaetae.hystrix.main.MainService   : fallbackMethod, param : taekwan
2020-03-30 02:03:28.681 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 02:03:28.681 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;defaultResult&#34;</span><span class=o>]</span>
2020-03-30 02:03:28.682 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK


2020-03-30 02:03:29.327 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:29.327 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 02:03:29.328  INFO <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> com.taetaetae.hystrix.main.MainService   : fallbackMethod, param : taekwan
2020-03-30 02:03:29.328 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 02:03:29.328 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;defaultResult&#34;</span><span class=o>]</span>
2020-03-30 02:03:29.329 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-5<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK


2020-03-30 02:03:30.071 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : GET <span class=s2>&#34;/index?key=taekwan&#34;</span>, <span class=nv>parameters</span><span class=o>={</span>masked<span class=o>}</span>
2020-03-30 02:03:30.072 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.taetaetae.hystrix.main.MainController#index<span class=o>(</span>String<span class=o>)</span>
2020-03-30 02:03:30.072  INFO <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> com.taetaetae.hystrix.main.MainService   : fallbackMethod, param : taekwan
2020-03-30 02:03:30.073 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Using <span class=s1>&#39;text/html&#39;</span>, given <span class=o>[</span>text/html, application/xhtml+xml, image/webp, image/apng, application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9, */*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8<span class=o>]</span> and supported <span class=o>[</span>text/plain, */*, text/plain, */*, application/json, application/*+json, application/json, application/*+json<span class=o>]</span>
2020-03-30 02:03:30.073 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> m.m.a.RequestResponseBodyMethodProcessor : Writing <span class=o>[</span><span class=s2>&#34;defaultResult&#34;</span><span class=o>]</span>
2020-03-30 02:03:30.073 DEBUG <span class=m>19084</span> --- <span class=o>[</span>nio-8080-exec-1<span class=o>]</span> o.s.web.servlet.DispatcherServlet        : Completed <span class=m>200</span> OK
</code></pre></div><p>로그를 자세히 보면, 처음엔 <code>TargetContoller</code>에서 찍은 로그가 있으면서 fallbackMethod 의 로그가 있지만 그 뒤에는 <code>TargetContoller</code>에서 찍은 로그는 없고 fallbackMethod 의 로그만 있는 것을 확인할 수 있다. 즉, 위에서 설정한 타임아웃 500ms 안에 2번 에러가 발생하였기 때문에 서킷브레이커가 동작해서 <code>TargetContoller</code> 로의 요청을 하지 않았기 때문이다. 이렇게 되면 <code>TargetContoller</code>입장에서는 연속적으로 요청이 오지 않기 때문에 부담이 줄어드는 효과가 있다.</p><h2 id=모니터링>모니터링</h2><p>서비스를 운영하면서 서킷브레이커가 동작되었는지를 확인하기 위해서 위에서 했던것 처럼 곳곳에 심어둔 로그를 눈이 빠져라 보고 있어야만 할까? Netflix 의 Hystrix 는 아주 우아하게 이를 웹에서 모니터링 할 수 있게도 구현해놨다. (참 대단하다&mldr;) 그럼 모니터링을 해보자.
모니터링을 하기 위해서는 dependency 를 추가해야 한다.</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;dependency&gt;</span>
	<span class=nt>&lt;groupId&gt;</span>org.springframework.cloud<span class=nt>&lt;/groupId&gt;</span>
	<span class=nt>&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class=nt>&lt;/artifactId&gt;</span>
	<span class=nt>&lt;version&gt;</span>2.2.2.RELEASE<span class=nt>&lt;/version&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
<span class=nt>&lt;dependency&gt;</span>
	<span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
	<span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class=nt>&lt;/artifactId&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></div><p>SpringBoot에서 제공하는 actuator 를 활용하여 정보를 받도록 해주고, application.properties 설정에서도 Hystrix 관련된 정보를 받아볼 수 있게 아래처럼 추가해주자.</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>management.endpoints.web.exposure.include<span class=o>=</span>hystrix.stream
</code></pre></div><p>그럼 끝이다. (응? 이게 끝이라고?) 그렇다. 필자도 아주 놀랬는데 생각해보니 모니터링을 위해 별도의 코드가 들어가는 자체가 이상한 부분같다. 아주 심플하게 모듈과 설정만 추가해주면 모니터링이 가능하다. 그럼 진짜 모니터링을 해보자. 일부러 여러번 호출해서 서킷브레이커를 발동시키면 모니터링 페이지에서는 어떤식으로 나오는지 확인해보자. 우선 이렇게 설정한뒤 실행을 하면 <code>/hystrix</code>로 접근이 가능하고 귀엽지만 뭔가 놀랜 표정의 곰돌이가 반기는 것을 확인할 수 있다. 그다음 url 에 <code>http://localhost:8080/actuator/hystrix.stream</code> 를 입력후 &ldquo;Monitor Stream"을 클릭하면 아래와 같은 화면을 볼 수 있다.</p><figure><a class=lightgallery href=/images/better-rest-template-2-netflix-hystrix/hystrix.jpg title=/images/better-rest-template-2-netflix-hystrix/hystrix.jpg data-thumbnail=/images/better-rest-template-2-netflix-hystrix/hystrix.jpg data-sub-html="<h2>곰돌이가 조금 화난것 같다. (코딩좀 잘하라고?)</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/better-rest-template-2-netflix-hystrix/hystrix.jpg data-srcset="/images/better-rest-template-2-netflix-hystrix/hystrix.jpg, /images/better-rest-template-2-netflix-hystrix/hystrix.jpg 1.5x, /images/better-rest-template-2-netflix-hystrix/hystrix.jpg 2x" data-sizes=auto alt=/images/better-rest-template-2-netflix-hystrix/hystrix.jpg width=80%></a><figcaption class=image-caption>곰돌이가 조금 화난것 같다. (코딩좀 잘하라고?)</figcaption></figure><p>뭔가 로딩중인것 같은데 올바른 요청 <code>/index?key=taetaetae</code> 을 해보면 그래프가 바뀌고 잘못된 요청 <code>/index?key=taekwan</code> 을 여러번 해보다가 잠시 멈추고 를 반복해보면 서킷브레이커가 open 되었다가 다시 close 된것을 확인할 수 있다.</p><figure><a class=lightgallery href=/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif title=/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif data-thumbnail=/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif data-sub-html="<h2>에러가 발생하면 open, 설정한 시간이 지나고 정상 응답이 되면 close</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif data-srcset="/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif, /images/better-rest-template-2-netflix-hystrix/monitor_execute.gif 1.5x, /images/better-rest-template-2-netflix-hystrix/monitor_execute.gif 2x" data-sizes=auto alt=/images/better-rest-template-2-netflix-hystrix/monitor_execute.gif width=80%></a><figcaption class=image-caption>에러가 발생하면 open, 설정한 시간이 지나고 정상 응답이 되면 close</figcaption></figure><h2 id=마치며>마치며</h2><p>물론 위에서 설정한 내용은 서비스에 적용하기도 부끄러울만큼 아주 극단적이고 다양한 상황이 전혀 고려되지 않은 설정값이다. 현 시스템에 맞춰 설정값을 커스터마이징 하며 최적의 설정값을 찾아야 할 것이다. 또한 무조건 &ldquo;설정한 값에 의해서 서킷브레이커가 잘 동작 하겠지&rdquo; 라고 믿는것(?)보다 모니터링을 추가로 설정해서 실제로 언제 서킷브레이커가 작동을 하는지 확인을 해봐야 할 것 같다. 나아가서 이 모니터링 페이지가 있다고 해서 주식 차트 보는것 마냥 계속 보고 있을수는 없는일. 모니터링 페이지를 봐야할 시점이 오게 된다면 자동으로 알림을 받도록 해서 필요할 때만 모니터링을 할 수 있도록 해야 할 것 같다. (이상하게 주식으로 시작해서 주식으로 끝나는 것 같은 느낌은 뭐지&mldr;)</p><p>물론 이번에도 위에서 사용한 코드는 <a href=https://github.com/taetaetae/hystrix target=_blank rel="noopener noreffer">필자의 Github Repo</a>에서 확인이 가능하다.</p><p>참고 url</p><ul><li><a href=https://github.com/Netflix/Hystrix>https://github.com/Netflix/Hystrix</a></li><li><a href=https://spring.io/guides/gs/circuit-breaker/>https://spring.io/guides/gs/circuit-breaker/</a></li><li><a href=https://woowabros.github.io/experience/2017/08/21/hystrix-tunning.html>https://woowabros.github.io/experience/2017/08/21/hystrix-tunning.html</a></li></ul></div><center><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:29px!important;height:30px!important;text-decoration:none!important;display:inline-flex!important;color:#000!important;background-color:#fd0!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#000!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><center><br><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/taetaetae><img src=https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg alt="Buy me a coffee"><span style=margin-left:5px>Buy me a coffee</span></a>
<a href=https://bit.ly/ddbSupport target=_blank><img src=https://i.imgur.com/peaYpjh.png style=height:28px></a></center><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-03-29</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/ data-title="조금 더 괜찮은 Rest Template 2부 - Circuit-breaker" data-hashtags="spring boot,circuit breaker,Netflix,Hystrix,archives-2020"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/ data-hashtag="spring boot"><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2020/03/29/better-rest-template-2-netflix-hystrix/ data-title="조금 더 괜찮은 Rest Template 2부 - Circuit-breaker" data-description><i class="fab fa-blogger fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/spring-boot/>spring boot</a>,&nbsp;<a href=/tags/circuit-breaker/>circuit breaker</a>,&nbsp;<a href=/tags/netflix/>Netflix</a>,&nbsp;<a href=/tags/hystrix/>Hystrix</a>,&nbsp;<a href=/tags/archives-2020/>archives-2020</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2020/03/26/7-years-of-development-1st-day-of-manager/ class=prev rel=prev title="매니저는 정말 개발자의 무덤일까? (리뷰 - 개발자 7년차, 매니저 1일차)"><i class="fas fa-angle-left fa-fw"></i>매니저는 정말 개발자의 무덤일까? (리뷰 - 개발자 7년차, 매니저 1일차)</a>
<a href=/2020/04/06/spring-boot-filter/ class=next rel=next title="스프링 부트에 필터를 '조심해서' 사용하는 두 가지 방법">스프링 부트에 필터를 '조심해서' 사용하는 두 가지 방법<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>태태태</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment","lightTheme":"github-light","repo":"taetaetae/blog-comment"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-86432198-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
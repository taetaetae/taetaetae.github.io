<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>자바 객체 복사하기 ( feat. how to use CloneUtils? ) - 👨‍💻꿈꾸는 태태태의 공간</title><meta name=Description content><meta property="og:title" content="자바 객체 복사하기 ( feat. how to use CloneUtils? )"><meta property="og:description" content="자바(Java)로 개발을 하다보면 한번쯤 객체를 복사하는 로직을 작성할때가 있다. 그때마다 나오는 이야기인 Shalldow Copy 와 Deep Copy. 한국어로 표현하면 얕은 복사와 깊은 복사라고 이야기를 하는데 이 두 개념의 차이는 아주 간단하다. 객체의 주소값을 복사하는지, 아니면 객체의 실제 값(value)를 복사하는지. 이 둘의 차이점을 소개하는 글들은 워낙 많으니 패스하도록 하고 이번 포스팅에서는 Deep Copy를 할때 org.apache.http.client.utils 하위에 있는 CloneUtils 사용법에 대해 정리 하고자 한다.
 그냥 쓰면 되는거 아닌가? 라고 생각했지만 (별거 아니라고 생각했지만) 해보고 안해보고의 차이는 엄청컸고 사용할때 주의점이 몇가지 있어 정리 하려고 한다.
 예제에 앞서 본 포스팅에서 사용할 객체를 간단히 정리하면 다음과 같다. (학교에서 학생 신상정보를 관리한다고 가정해보자.)
public class Student { String name; // 이름 	int age; // 나이 	Family family; // 가족 } public class Family { String name; // 이름 	int age; // 나이 	boolean isOfficeWorkers; // 직장인 여부 } public class PhysicalInformation { int height; // 키 	int weight; // 몸무게 } 객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다. 당연한 이야기가 될수도 있으나 CloneUtils를 사용하기 위해서는 해당 객체는 Cloneable interface 를 implement 해야한다. 그리고 나서 clone 메소드를 override 해야되는데 여기서 가장 중요한점은 외부에서도 호출이 가능해야하기 때문에 public 으로 override를 해야한다. (기본은 protected 로 되어있다.) 우선 간단히 객체를 생성하고 출력부터 해보자. (출력을 이쁘게 하기 위해 ToStringBuilder.reflectionToString을 사용하였다.)
PhysicalInformation physicalInformation = new PhysicalInformation(); physicalInformation.height = 180; physicalInformation.weight = 70; System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); 결과는 당연히
PhysicalInformation@5d6f64b1[height=180,weight=70] 이제 Cloneable interface 를 implement 하고 clone 메소드를 public 으로 override 한뒤, CloneUtils를 사용해서 객체를 복사해보자. 테스트를 하면서 Shalldow Copy도 해보자.
// class setting public class PhysicalInformation implements Cloneable{ int height; int weight; @Override public Object clone() throws CloneNotSupportedException { // public 으로 바꿔주자. 	return super.clone(); } } // test code PhysicalInformation physicalInformation = new PhysicalInformation(); physicalInformation.height = 180; physicalInformation.weight = 70; PhysicalInformation physicalInformationShalldowCopy = physicalInformation; PhysicalInformation physicalInformationDeepCopy = null; try { physicalInformationDeepCopy = (PhysicalInformation)CloneUtils.clone(physicalInformation); } catch (CloneNotSupportedException e) { e.printStackTrace(); } // 원본 System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); // 얕은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE)); // 깊은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE)); // 값 변경 physicalInformation.weight = 80; physicalInformation.height = 170; // 원본 System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); // 얕은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE)); // 깊은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE)); 결과는 원본과 얕은 복사를 한것은 메모리 주소(?)가 같으나 깊은 복사를 한것은 데이터는 같지만 주소가 다르고 값을 변경해도 영향을 주지 않는다. (완전히 서로다른 객체인것을 증명)
PhysicalInformation@1376c05c[height=180,weight=70] PhysicalInformation@1376c05c[height=180,weight=70] PhysicalInformation@1b4fb997[height=180,weight=70] PhysicalInformation@1376c05c[height=170,weight=80] PhysicalInformation@1376c05c[height=170,weight=80] PhysicalInformation@1b4fb997[height=180,weight=70] 만약 위에서 clone을 기본값인 protected로 override를 하게 되면 어떤 결과를 가져올까?
Exception in thread &#34;main&#34; java.lang.NoSuchMethodError: com.PhysicalInformation.clone() at org.apache.http.client.utils.CloneUtils.cloneObject(CloneUtils.java:55) at org.apache.http.client.utils.CloneUtils.clone(CloneUtils.java:77) at com.Test.main(Test.java:16) 접근제한자에서 눈치를 챌수도 있었겠지만 접근을 할수없어 CloneUtils 이 리플렉션을 하는 과정에서 Exception을 발생한다. 꼭! public 으로 override를 해주자.
객체 내에 clone이 안되는 변수는 별도 처리가 필요하다. 객체 내에 있는 멤버 변수는 원시 변수(int, char, float 등) , Immutable Class (String, Boolean, Integer 등) 또는 Enum 형식일 때는 원본의 값을 바로 대입해도 되지만, 그렇지 않을 때는 멤버변수의 clone을 호출하여 복사해야 한다. 말로만 보면 무슨이야기 인지 모르니 예제를 보자.
public class Student implements Cloneable { String name; int age; Family family; @Override public Object clone() throws CloneNotSupportedException { return super.clone(); } } Student 클래스에서 Cloneable 를 implements 하고 clone 메소드를 override 하였다. (여기서 구멍이 있다!"><meta property="og:type" content="article"><meta property="og:url" content="https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/"><meta property="og:image" content="https://taetaetae.github.io/images/how-to-use-cloneUtils/clone_java.jpg"><meta property="article:published_time" content="2018-08-21T18:02:47+00:00"><meta property="article:modified_time" content="2018-08-21T18:02:47+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/how-to-use-cloneUtils/clone_java.jpg"><meta name=twitter:title content="자바 객체 복사하기 ( feat. how to use CloneUtils? )"><meta name=twitter:description content="자바(Java)로 개발을 하다보면 한번쯤 객체를 복사하는 로직을 작성할때가 있다. 그때마다 나오는 이야기인 Shalldow Copy 와 Deep Copy. 한국어로 표현하면 얕은 복사와 깊은 복사라고 이야기를 하는데 이 두 개념의 차이는 아주 간단하다. 객체의 주소값을 복사하는지, 아니면 객체의 실제 값(value)를 복사하는지. 이 둘의 차이점을 소개하는 글들은 워낙 많으니 패스하도록 하고 이번 포스팅에서는 Deep Copy를 할때 org.apache.http.client.utils 하위에 있는 CloneUtils 사용법에 대해 정리 하고자 한다.
 그냥 쓰면 되는거 아닌가? 라고 생각했지만 (별거 아니라고 생각했지만) 해보고 안해보고의 차이는 엄청컸고 사용할때 주의점이 몇가지 있어 정리 하려고 한다.
 예제에 앞서 본 포스팅에서 사용할 객체를 간단히 정리하면 다음과 같다. (학교에서 학생 신상정보를 관리한다고 가정해보자.)
public class Student { String name; // 이름 	int age; // 나이 	Family family; // 가족 } public class Family { String name; // 이름 	int age; // 나이 	boolean isOfficeWorkers; // 직장인 여부 } public class PhysicalInformation { int height; // 키 	int weight; // 몸무게 } 객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다. 당연한 이야기가 될수도 있으나 CloneUtils를 사용하기 위해서는 해당 객체는 Cloneable interface 를 implement 해야한다. 그리고 나서 clone 메소드를 override 해야되는데 여기서 가장 중요한점은 외부에서도 호출이 가능해야하기 때문에 public 으로 override를 해야한다. (기본은 protected 로 되어있다.) 우선 간단히 객체를 생성하고 출력부터 해보자. (출력을 이쁘게 하기 위해 ToStringBuilder.reflectionToString을 사용하였다.)
PhysicalInformation physicalInformation = new PhysicalInformation(); physicalInformation.height = 180; physicalInformation.weight = 70; System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); 결과는 당연히
PhysicalInformation@5d6f64b1[height=180,weight=70] 이제 Cloneable interface 를 implement 하고 clone 메소드를 public 으로 override 한뒤, CloneUtils를 사용해서 객체를 복사해보자. 테스트를 하면서 Shalldow Copy도 해보자.
// class setting public class PhysicalInformation implements Cloneable{ int height; int weight; @Override public Object clone() throws CloneNotSupportedException { // public 으로 바꿔주자. 	return super.clone(); } } // test code PhysicalInformation physicalInformation = new PhysicalInformation(); physicalInformation.height = 180; physicalInformation.weight = 70; PhysicalInformation physicalInformationShalldowCopy = physicalInformation; PhysicalInformation physicalInformationDeepCopy = null; try { physicalInformationDeepCopy = (PhysicalInformation)CloneUtils.clone(physicalInformation); } catch (CloneNotSupportedException e) { e.printStackTrace(); } // 원본 System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); // 얕은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE)); // 깊은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE)); // 값 변경 physicalInformation.weight = 80; physicalInformation.height = 170; // 원본 System.out.println(ToStringBuilder.reflectionToString(physicalInformation, ToStringStyle.DEFAULT_STYLE)); // 얕은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationShalldowCopy, ToStringStyle.DEFAULT_STYLE)); // 깊은 복사 System.out.println(ToStringBuilder.reflectionToString(physicalInformationDeepCopy, ToStringStyle.DEFAULT_STYLE)); 결과는 원본과 얕은 복사를 한것은 메모리 주소(?)가 같으나 깊은 복사를 한것은 데이터는 같지만 주소가 다르고 값을 변경해도 영향을 주지 않는다. (완전히 서로다른 객체인것을 증명)
PhysicalInformation@1376c05c[height=180,weight=70] PhysicalInformation@1376c05c[height=180,weight=70] PhysicalInformation@1b4fb997[height=180,weight=70] PhysicalInformation@1376c05c[height=170,weight=80] PhysicalInformation@1376c05c[height=170,weight=80] PhysicalInformation@1b4fb997[height=180,weight=70] 만약 위에서 clone을 기본값인 protected로 override를 하게 되면 어떤 결과를 가져올까?
Exception in thread &#34;main&#34; java.lang.NoSuchMethodError: com.PhysicalInformation.clone() at org.apache.http.client.utils.CloneUtils.cloneObject(CloneUtils.java:55) at org.apache.http.client.utils.CloneUtils.clone(CloneUtils.java:77) at com.Test.main(Test.java:16) 접근제한자에서 눈치를 챌수도 있었겠지만 접근을 할수없어 CloneUtils 이 리플렉션을 하는 과정에서 Exception을 발생한다. 꼭! public 으로 override를 해주자.
객체 내에 clone이 안되는 변수는 별도 처리가 필요하다. 객체 내에 있는 멤버 변수는 원시 변수(int, char, float 등) , Immutable Class (String, Boolean, Integer 등) 또는 Enum 형식일 때는 원본의 값을 바로 대입해도 되지만, 그렇지 않을 때는 멤버변수의 clone을 호출하여 복사해야 한다. 말로만 보면 무슨이야기 인지 모르니 예제를 보자.
public class Student implements Cloneable { String name; int age; Family family; @Override public Object clone() throws CloneNotSupportedException { return super.clone(); } } Student 클래스에서 Cloneable 를 implements 하고 clone 메소드를 override 하였다. (여기서 구멍이 있다!"><meta name=application-name content="👨‍💻꿈꾸는 태태태의 공간"><meta name=apple-mobile-web-app-title content="👨‍💻꿈꾸는 태태태의 공간"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/><link rel=prev href=https://taetaetae.github.io/2018/08/09/daily-dev-blog-2/><link rel=next href=https://taetaetae.github.io/2018/08/28/pycon-2018/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"자바 객체 복사하기 ( feat. how to use CloneUtils? )","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2018\/08\/21\/how-to-use-cloneutils\/"},"genre":"posts","keywords":"cloneUtils, java deep copy, archives-2018","wordcount":796,"url":"https:\/\/taetaetae.github.io\/2018\/08\/21\/how-to-use-cloneutils\/","datePublished":"2018-08-21T18:02:47+00:00","dateModified":"2018-08-21T18:02:47+00:00","publisher":{"@type":"Organization","name":"태태태"},"author":{"@type":"Person","name":"태태태"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="👨‍💻꿈꾸는 태태태의 공간">👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:260px;height:600px data-ad-client=ca-pub-5788330009690816 data-ad-slot=2248955907></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><article class="page single"><h1 class="single-title animated flipInX">자바 객체 복사하기 ( feat. how to use CloneUtils? )</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>태태태</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-08-21>2018-08-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;796 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/how-to-use-cloneUtils/clone_java.jpg data-srcset="/images/how-to-use-cloneUtils/clone_java.jpg, /images/how-to-use-cloneUtils/clone_java.jpg 1.5x, /images/how-to-use-cloneUtils/clone_java.jpg 2x" data-sizes=auto alt=/images/how-to-use-cloneUtils/clone_java.jpg title=/images/how-to-use-cloneUtils/clone_java.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#객체는-cloneable-interface-를-implement-해야하고-clone-메소드를-public-으로-override-해야한다>객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다.</a></li><li><a href=#객체-내에-clone이-안되는-변수는-별도-처리가-필요하다>객체 내에 clone이 안되는 변수는 별도 처리가 필요하다.</a></li><li><a href=#마치며>마치며</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>자바(Java)로 개발을 하다보면 한번쯤 객체를 복사하는 로직을 작성할때가 있다. 그때마다 나오는 이야기인 <code>Shalldow Copy</code> 와 <code>Deep Copy</code>. 한국어로 표현하면 얕은 복사와 깊은 복사라고 이야기를 하는데 이 두 개념의 차이는 아주 간단하다. 객체의 주소값을 복사하는지, 아니면 객체의 실제 값(value)를 복사하는지. 이 둘의 차이점을 소개하는 글들은 워낙 많으니 패스하도록 하고 이번 포스팅에서는 <code>Deep Copy</code>를 할때 <code>org.apache.http.client.utils</code> 하위에 있는 <code>CloneUtils</code> 사용법에 대해 정리 하고자 한다.</p><blockquote><p>그냥 쓰면 되는거 아닌가? 라고 생각했지만 (별거 아니라고 생각했지만) 해보고 안해보고의 차이는 엄청컸고 사용할때 주의점이 몇가지 있어 정리 하려고 한다.</p></blockquote><p>예제에 앞서 본 포스팅에서 사용할 객체를 간단히 정리하면 다음과 같다. (학교에서 학생 신상정보를 관리한다고 가정해보자.)</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=o>{</span>
	<span class=n>String</span> <span class=n>name</span><span class=o>;</span> <span class=c1>// 이름
</span><span class=c1></span>	<span class=kt>int</span> <span class=n>age</span><span class=o>;</span> <span class=c1>// 나이
</span><span class=c1></span>	<span class=n>Family</span> <span class=n>family</span><span class=o>;</span> <span class=c1>// 가족
</span><span class=c1></span><span class=o>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Family</span> <span class=o>{</span>
	<span class=n>String</span> <span class=n>name</span><span class=o>;</span>  <span class=c1>// 이름
</span><span class=c1></span>	<span class=kt>int</span> <span class=n>age</span><span class=o>;</span> <span class=c1>// 나이
</span><span class=c1></span>	<span class=kt>boolean</span> <span class=n>isOfficeWorkers</span><span class=o>;</span> <span class=c1>// 직장인 여부
</span><span class=c1></span><span class=o>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PhysicalInformation</span> <span class=o>{</span>
	<span class=kt>int</span> <span class=n>height</span><span class=o>;</span> <span class=c1>// 키
</span><span class=c1></span>	<span class=kt>int</span> <span class=n>weight</span><span class=o>;</span> <span class=c1>// 몸무게
</span><span class=c1></span><span class=o>}</span>
</code></pre></div><h3 id=객체는-cloneable-interface-를-implement-해야하고-clone-메소드를-public-으로-override-해야한다>객체는 Cloneable interface 를 implement 해야하고 clone 메소드를 public 으로 override 해야한다.</h3><p>당연한 이야기가 될수도 있으나 <code>CloneUtils</code>를 사용하기 위해서는 해당 객체는 Cloneable interface 를 implement 해야한다. 그리고 나서 clone 메소드를 override 해야되는데 여기서 가장 중요한점은 외부에서도 호출이 가능해야하기 때문에 <code>public</code> 으로 override를 해야한다. (기본은 protected 로 되어있다.) 우선 간단히 객체를 생성하고 출력부터 해보자. (출력을 이쁘게 하기 위해 <code>ToStringBuilder.reflectionToString</code>을 사용하였다.)</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=n>PhysicalInformation</span> <span class=n>physicalInformation</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PhysicalInformation</span><span class=o>();</span>
<span class=n>physicalInformation</span><span class=o>.</span><span class=na>height</span> <span class=o>=</span> <span class=n>180</span><span class=o>;</span>
<span class=n>physicalInformation</span><span class=o>.</span><span class=na>weight</span> <span class=o>=</span> <span class=n>70</span><span class=o>;</span>

<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformation</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
</code></pre></div><p>결과는 당연히</p><pre><code>PhysicalInformation@5d6f64b1[height=180,weight=70]
</code></pre><p>이제 Cloneable interface 를 implement 하고 clone 메소드를 public 으로 override 한뒤, CloneUtils를 사용해서 객체를 복사해보자. 테스트를 하면서 <code>Shalldow Copy</code>도 해보자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=c1>// class setting
</span><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PhysicalInformation</span> <span class=kd>implements</span> <span class=n>Cloneable</span><span class=o>{</span>
	<span class=kt>int</span> <span class=n>height</span><span class=o>;</span>
	<span class=kt>int</span> <span class=n>weight</span><span class=o>;</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span> <span class=c1>// public 으로 바꿔주자.
</span><span class=c1></span>		<span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
	<span class=o>}</span>
<span class=o>}</span>

<span class=c1>// test code
</span><span class=c1></span><span class=n>PhysicalInformation</span> <span class=n>physicalInformation</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PhysicalInformation</span><span class=o>();</span>
<span class=n>physicalInformation</span><span class=o>.</span><span class=na>height</span> <span class=o>=</span> <span class=n>180</span><span class=o>;</span>
<span class=n>physicalInformation</span><span class=o>.</span><span class=na>weight</span> <span class=o>=</span> <span class=n>70</span><span class=o>;</span>

<span class=n>PhysicalInformation</span> <span class=n>physicalInformationShalldowCopy</span> <span class=o>=</span> <span class=n>physicalInformation</span><span class=o>;</span>
<span class=n>PhysicalInformation</span> <span class=n>physicalInformationDeepCopy</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
<span class=k>try</span> <span class=o>{</span>
	<span class=n>physicalInformationDeepCopy</span> <span class=o>=</span> <span class=o>(</span><span class=n>PhysicalInformation</span><span class=o>)</span><span class=n>CloneUtils</span><span class=o>.</span><span class=na>clone</span><span class=o>(</span><span class=n>physicalInformation</span><span class=o>);</span>
<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>CloneNotSupportedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
	<span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
<span class=o>}</span>

<span class=c1>// 원본
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformation</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=c1>// 얕은 복사
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformationShalldowCopy</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=c1>// 깊은 복사
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformationDeepCopy</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>

<span class=c1>// 값 변경
</span><span class=c1></span><span class=n>physicalInformation</span><span class=o>.</span><span class=na>weight</span> <span class=o>=</span> <span class=n>80</span><span class=o>;</span>
<span class=n>physicalInformation</span><span class=o>.</span><span class=na>height</span> <span class=o>=</span> <span class=n>170</span><span class=o>;</span>

<span class=c1>// 원본
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformation</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=c1>// 얕은 복사
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformationShalldowCopy</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=c1>// 깊은 복사
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>physicalInformationDeepCopy</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
</code></pre></div><p>결과는 원본과 얕은 복사를 한것은 메모리 주소(?)가 같으나 깊은 복사를 한것은 데이터는 같지만 주소가 다르고 값을 변경해도 영향을 주지 않는다. (완전히 서로다른 객체인것을 증명)</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>PhysicalInformation@1376c05c[height=180,weight=70]
PhysicalInformation@1376c05c[height=180,weight=70]
PhysicalInformation@1b4fb997[height=180,weight=70]

PhysicalInformation@1376c05c[height=170,weight=80]
PhysicalInformation@1376c05c[height=170,weight=80]
PhysicalInformation@1b4fb997[height=180,weight=70]
</code></pre></div><p>만약 위에서 clone을 기본값인 protected로 override를 하게 되면 어떤 결과를 가져올까?</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>Exception in thread &#34;main&#34; java.lang.NoSuchMethodError: com.PhysicalInformation.clone()
	at org.apache.http.client.utils.CloneUtils.cloneObject(CloneUtils.java:55)
	at org.apache.http.client.utils.CloneUtils.clone(CloneUtils.java:77)
	at com.Test.main(Test.java:16)

</code></pre></div><p>접근제한자에서 눈치를 챌수도 있었겠지만 접근을 할수없어 CloneUtils 이 리플렉션을 하는 과정에서 Exception을 발생한다. 꼭! public 으로 override를 해주자.</p><h3 id=객체-내에-clone이-안되는-변수는-별도-처리가-필요하다>객체 내에 clone이 안되는 변수는 별도 처리가 필요하다.</h3><p>객체 내에 있는 멤버 변수는 원시 변수(int, char, float 등) , Immutable Class (String, Boolean, Integer 등) 또는 Enum 형식일 때는 원본의 값을 바로 대입해도 되지만, 그렇지 않을 때는 멤버변수의 clone을 호출하여 복사해야 한다. 말로만 보면 무슨이야기 인지 모르니 예제를 보자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=kd>implements</span> <span class=n>Cloneable</span> <span class=o>{</span>
	<span class=n>String</span> <span class=n>name</span><span class=o>;</span>
	<span class=kt>int</span> <span class=n>age</span><span class=o>;</span>
	<span class=n>Family</span> <span class=n>family</span><span class=o>;</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span>
		<span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>Student 클래스에서 Cloneable 를 implements 하고 clone 메소드를 override 하였다. (여기서 구멍이 있다!!) 그다음 Family 클래스는 초기 그대로 두고 CloneUtils을 사용해서 객체를 복사하는 코드를 작성해보자.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=n>Student</span> <span class=n>student</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Student</span><span class=o>();</span>
<span class=n>student</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=s>&#34;taetaetae&#34;</span><span class=o>;</span>
<span class=n>student</span><span class=o>.</span><span class=na>age</span> <span class=o>=</span> <span class=n>20</span><span class=o>;</span>

<span class=n>Family</span> <span class=n>family</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Family</span><span class=o>();</span>
<span class=n>family</span><span class=o>.</span><span class=na>age</span> <span class=o>=</span> <span class=n>25</span><span class=o>;</span>
<span class=n>family</span><span class=o>.</span><span class=na>isOfficeWorkers</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
<span class=n>family</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=s>&#34;son&#34;</span><span class=o>;</span>
<span class=n>student</span><span class=o>.</span><span class=na>family</span> <span class=o>=</span> <span class=n>family</span><span class=o>;</span>

<span class=n>Student</span> <span class=n>studentDeepCopy</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
<span class=k>try</span> <span class=o>{</span>
	<span class=n>studentDeepCopy</span> <span class=o>=</span> <span class=o>(</span><span class=n>Student</span><span class=o>)</span><span class=n>CloneUtils</span><span class=o>.</span><span class=na>clone</span><span class=o>(</span><span class=n>student</span><span class=o>);</span>
<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>CloneNotSupportedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
	<span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
<span class=o>}</span>
<span class=c1>// student 객체 복사여부 확인
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>student</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>studentDeepCopy</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=c1>// student 내 family 객체 복사 여부 확인
</span><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>student</span><span class=o>.</span><span class=na>family</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ToStringBuilder</span><span class=o>.</span><span class=na>reflectionToString</span><span class=o>(</span><span class=n>studentDeepCopy</span><span class=o>.</span><span class=na>family</span><span class=o>,</span> <span class=n>ToStringStyle</span><span class=o>.</span><span class=na>DEFAULT_STYLE</span><span class=o>));</span>
</code></pre></div><p>Student 객체 안에 int, String, 그리고 별도로 만든 객체인 Family 가 있는 상황에서 복사를 해보자. 결과는 어떻게 나왔을까?</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>com.Student@1376c05c[name=taetaetae,age=20,family=com.Family@51521cc1]
com.Student@deb6432[name=taetaetae,age=20,family=com.Family@51521cc1]

com.Family@51521cc1[name=son,age=25,isOfficeWorkers=true]
com.Family@51521cc1[name=son,age=25,isOfficeWorkers=true]
</code></pre></div><p>위에서 말했던 구멍의 결과를 볼수 있다. Student 객체는 주소값이 다른걸 보니 깊은 복사가 되었지만 그 안에 있는 Family 형 변수는 얕은 복사가 된것을 확인할수 있다.</p><p>위에서 말한것과 같이 clone이 안되는 경우는 (다시 말하면 원시변수나 Immutable Class, enum 등 clone을 지원하는 객체가 아닐경우) 별도로 clone이 되도록 설정이 필요하다.</p><p>그래서 Family 도 Cloneable 를 implements 하고 clone 메소드를 override 해준다음 최상위 객체였던 Student의 clone 메소드를 아래처럼 조금 수정해주고 나서 테스트를 해보면 이쁘게 깊은 복사가 된것을 확인할수 있다.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=c1>// 복사가 될수있도록 설정
</span><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Family</span> <span class=kd>implements</span> <span class=n>Cloneable</span><span class=o>{</span>
	<span class=n>String</span> <span class=n>name</span><span class=o>;</span>
	<span class=kt>int</span> <span class=n>age</span><span class=o>;</span>
	<span class=kt>boolean</span> <span class=n>isOfficeWorkers</span><span class=o>;</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span>
		<span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
	<span class=o>}</span>
<span class=o>}</span>

<span class=c1>// 일단 복사를 하고, 멤버 객체 자체를 복사한 다음 대입 
</span><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=kd>implements</span> <span class=n>Cloneable</span> <span class=o>{</span>
	<span class=n>String</span> <span class=n>name</span><span class=o>;</span>
	<span class=kt>int</span> <span class=n>age</span><span class=o>;</span>
	<span class=n>Family</span> <span class=n>family</span><span class=o>;</span>

	<span class=nd>@Override</span>
	<span class=kd>public</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span>
		<span class=n>Student</span> <span class=n>student</span> <span class=o>=</span> <span class=o>(</span><span class=n>Student</span><span class=o>)</span><span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
		<span class=n>student</span><span class=o>.</span><span class=na>family</span> <span class=o>=</span> <span class=o>(</span><span class=n>Family</span><span class=o>)</span><span class=n>CloneUtils</span><span class=o>.</span><span class=na>clone</span><span class=o>(</span><span class=n>student</span><span class=o>.</span><span class=na>family</span><span class=o>);</span>
		<span class=k>return</span> <span class=n>student</span><span class=o>;</span>
	<span class=o>}</span>
<span class=o>}</span>

</code></pre></div><p>그러고 테스트를 해보면 내부 멤버 변수도 복사가 된것을 확인할수 있다.</p><div class=highlight><pre class=chroma><code class=language-markdown data-lang=markdown>com.Student@51521cc1[name=taetaetae,age=20,family=com.Family@1b4fb997]
com.Student@28ba21f3[name=taetaetae,age=20,family=com.Family@694f9431]
com.Family@1b4fb997[name=son,age=25,isOfficeWorkers=true]
com.Family@694f9431[name=son,age=25,isOfficeWorkers=true]
</code></pre></div><h3 id=마치며>마치며</h3><p>멤버변수가 List, Map, Set 등 여러 유형으로 복잡하게 만들어졌을경우 각각 복사를 해주는 등 다양한 케이스에 유연하게 대응할수 있어야 하겠다.
객체복사? 그거 그냥 하면 되는거 아냐? 라고 볼수도 있으나 입개발 하는 사람과 직접 구현해보고 내부 코드까지 들여다보는 수고를 하는 사람의 차이는 언젠간 분명히 드러날꺼라 생각한다. (필자가 그랬으니ㅠㅠ)</p></div><center><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:29px!important;height:30px!important;text-decoration:none!important;display:inline-flex!important;color:#000!important;background-color:#fd0!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#000!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><center><br><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/taetaetae><img src=https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg alt="Buy me a coffee"><span style=margin-left:5px>Buy me a coffee</span></a>
<a href=https://bit.ly/ddbSupport target=_blank><img src=https://i.imgur.com/peaYpjh.png style=height:28px></a></center><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2018-08-21</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/ data-title="자바 객체 복사하기 ( feat. how to use CloneUtils? )" data-hashtags="cloneUtils,java deep copy,archives-2018"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/ data-hashtag=cloneUtils><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2018/08/21/how-to-use-cloneutils/ data-title="자바 객체 복사하기 ( feat. how to use CloneUtils? )" data-description><i class="fab fa-blogger fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/cloneutils/>cloneUtils</a>,&nbsp;<a href=/tags/java-deep-copy/>java deep copy</a>,&nbsp;<a href=/tags/archives-2018/>archives-2018</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2018/08/09/daily-dev-blog-2/ class=prev rel=prev title="기술블로그 구독서비스 개발 후기 - 2부"><i class="fas fa-angle-left fa-fw"></i>기술블로그 구독서비스 개발 후기 - 2부</a>
<a href=/2018/08/28/pycon-2018/ class=next rel=next title="2018 Pycon. 그리고 첫 발표를 하다.">2018 Pycon. 그리고 첫 발표를 하다.<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>태태태</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment","lightTheme":"github-light","repo":"taetaetae/blog-comment"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-86432198-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì. - ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</title><meta name=Description content><meta property="og:title" content="ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì."><meta property="og:description" content="apache access log ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ì€ ìƒí™©ì´ ìƒê²¼ë‹¤. ì•„ë‹ˆ ê·¸ë³´ë‹¤ apache accessì— ëŒ€í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ê³ ì‹¶ì—ˆê³ , logë¥¼ ê²€ìƒ‰ & ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ ìœ ì˜ë¯¸í•œ ë¶„ì„ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ ë³´ê³  ì‹¶ì—ˆë‹¤. ê·¸ì— ìƒê°í•œê²ƒì´ (ì—­ì‹œ) ElasticStack.ì²˜ìŒì— ìƒê°í•œ ë°©ì•ˆì€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë‹¨ìˆœí–ˆë‹¤. ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡°&#34; ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡° 
í•˜ì§€ë§Œ, ë‚´ ë‹¨ìˆœí•œ(?) ì˜ˆìƒì€ ì—­ì‹œ ë¹—ë‚˜ê°”ê³  logstashì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ì—ˆë‹¤.
 retrying individual bulk actions that failed or were rejected by the previous bulk request
 requestê°€ ë§ì•„ì§ì— ë”°ë¼ elasticsearchê°€ ë²„ë²…ê±°ë¦¬ë”ë‹ˆ logstashì—ì„œ ëŒ€ëŸ‰ì‘ì—…ì€ ê±°ë¶€í•˜ê² ë‹¤ë©° ì¸ë±ì‹±ì„ ë©ˆì·„ë‹¤. ê³ ë¯¼ê³ ë¯¼í•˜ë‹¤ elasticsearchì— ì¸ë±ì‹±í• ë•Œ ë¶€í•˜ê°€ ë§ì´ ê±¸ë¦¬ëŠ” ìƒí™©ì—ì„œ ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘” ê²½í—˜ì´ ìˆì–´ì„œ facebookê·¸ë£¹ì— ë¬¸ì˜ë¥¼ í•´ë´¤ë‹¤. https://www.facebook.com/groups/elasticsearch.kr/?multi_permalinks=1566735266745641 ì—­ì‹œ ë‚˜ë³´ë‹¤ í•œì°¸ì„ ì•ì„œê°€ì‹œëŠ” ë¶„ë“¤ì€ ì´ë¯¸ ì—ëŸ¬ê°€ ë­”ì§€ ì•Œê³  ìˆìœ¼ì…¨ê³ , ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘ê³  í•˜ë‹ˆ ì˜ëœë‹¤ëŠ” ì˜ê²¬ì´ ìˆì–´ ë‚˜ë„ ë”°ë¼í•´ë´¤ë‹¤. ë¬¼ë¡  ë‹µë³€ì¤‘ì— ë‚˜ì˜¨ redisê°€ ì•„ë‹Œ ê¸°ì¡´ì—ë„ ë¹„ìŠ·í•œ êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë˜ kafkaë¥¼ ì ìš©. ì•„, ê·¸ì „ì— í˜„ì¬êµ¬ì„±ì€ Elasticsearch ë…¸ë“œê°€ ì´ 3ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ë° ë…¸ë“œë¥¼ ì¶”ê°€ë¡œ ëŠ˜ë¦¬ë©° ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ í•´ë³´ê¸°ì „ì— í• ìˆ˜ìˆëŠ” ë§ˆì§€ë§‰ ë°©ë²•ì´ë‹¤ ìƒê°í•˜ê³  ì¤‘ê°„ì— kafkaë¥¼ ë‘¬ì„œ ë¶€í•˜ë¥¼ ì¤„ì—¬ë³´ê³  ì‹¶ì—ˆë‹¤. (ì–¸ì œë¶€í„´ê°€ ë§ˆì¹˜ ì—¬ëŸ¬ê°œì˜ í†±ë‹ˆë°”í€´ê°€ ë§ë¬¼ë ¤ ëŒì•„ê°€ëŠ”ë“¯í•œ ì‹œìŠ¤í…œ ì„¤ê³„ë¥¼ í•˜ëŠ”ê²Œ ì¬ë°Œì—ˆë‹¤.) ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë§ì´ë‹¤.
ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°&#34; ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°  ê·¸ë¬ë”ë‹ˆ ê±°ì§“ë§ ì²˜ëŸ¼ ì—ëŸ¬í•˜ë‚˜ ì—†ì´ ì˜ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. logstashê°€ ì–‘ìª½ì— ìˆëŠ”ê²Œ ì•½ê°„ ê±¸ë¦¬ê¸´ í•˜ì§€ë§Œ, ì²˜ìŒì— ìƒê°í•œ êµ¬ì¡°ë³´ë‹¤ëŠ” ì—ëŸ¬ê°€ ì•ˆë‚˜ë‹ˆ ë‹¤í–‰ì´ë¼ ìƒê°í•œë‹¤.
ì´ êµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ì„œ ì–»ì€ Insightê°€ ìˆê¸°ì—, ê° í•­ëª©ë³„ë¡œ ì ì–´ ë³´ê³ ì í•œë‹¤. ( ì´ê²ƒë§Œ ì ì–´ë†“ê¸°ì—” ë„ˆë¬´ ì—†ì–´ë³´ì—¬ì„œ.. )
access log ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ì—¬ ì¸ë±ì‹± í• ê²ƒì¸ê°€? apache 2.xë¥¼ ì‚¬ìš©í•˜ê³  ë³„ë„ì˜ ë¡œê·¸ í¬ë§·ì„ ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì€ access logê°€ ì°íŒë‹¤. 123.1.1.1 - - [25/Jan/2018:21:55:35 +0900] &#34;GET /api/test?param=12341234 HTTP/1.1&#34; 200 48 1144 &#34;http://www.naver.com/&#34; &#34;Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NAVER(inapp; blog; 100; 4.0.44)&#34; ê·¸ëŸ¼ ì´ ë¡œê·¸ë¥¼ ì•„ë¬´ í¬ë§·íŒ… ì—†ì´ ë¡œê¹…ì„ í•˜ë©´ ê·¸ëƒ¥ í•œì¤„ì˜ í…ìŠ¤íŠ¸ê°€ ì¸ë±ì‹±ì´ ëœë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ elasticsearch ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì¬ê°€ê³µí•˜ê±°ë‚˜ ë³„ë„ì˜ ì‘ì—…ì´ í•„ìš”í• ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì¤‘ê°„ì— ìˆëŠ” logstashì—ê²Œ ì¼ì„ ì‹œì¼œ ì¢€ë” nice í•œ ë°©ë²•ìœ¼ë¡œ ì¸ë±ì‹±ì„ í•´ë³´ì. ë°”ë¡œ logstash ì˜ filter ê¸°ëŠ¥ì´ë‹¤. ê·¸ì¤‘ Grok filter ë¼ëŠ”ê²Œ ìˆëŠ”ë° íŒ¨í„´ì„ ì ìš©í•˜ì—¬ row data ë¥¼ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ ê³ ë§™ê²Œë„ ì•„íŒŒì¹˜ í•„í„° ì˜ˆì œê°€ ìˆì–´ ìˆ˜ì •í•˜ì—¬ ì ìš©í• ìˆ˜ ìˆì—ˆë‹¤. http://grokconstructor.appspot.com/do/match?example=2 ê·¸ë˜ì„œ ì ìš©í•œ í•„í„°ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
filter { grok { match => { message => &#34;%{IP:clientIp} (?:-|) (?:-|) \[%{HTTPDATE:timestamp}\] \&#34;(?:%{WORD:httpMethod} %{URIPATH:uri}%{GREEDYDATA}(?: HTTP/%{NUMBER})?|-)\&#34; %{NUMBER:responseCode} (?:-|%{NUMBER})&#34; } } } ì´ë ‡ê²Œ í•˜ê³  elasticsearch ì— ì¸ë±ì‹±ì„ í•˜ë©´ í‚¤ë°”ë‚˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³¼ìˆ˜ ìˆë‹¤. í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log&#34; í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log 
ê° í•„ë“œê°€ ì•„ë‹Œ í•œì¤„ë¡œ ì¸ë±ì‹±ì´ ë˜ì–´ë²„ë¦°ë‹¤. Elasticsearch ì— ì¸ë±ì‹±ì´ ë˜ê¸´ í•˜ëŠ”ë° ë¡œê·¸ í•œì¤„ì´ í†µì§¸ë¡œ ë“¤ì–´ê°€ ë²„ë¦°ë‹¤. messageë¼ëŠ” ì´ë¦„ìœ¼ë¡œ&mldr; ì•Œê³ ë³´ë‹ˆ í˜„ì¬ êµ¬ì¡°ëŠ” logstashê°€ kafka ì• ë’¤ì— ìˆë‹¤ë³´ë‹ˆ producer logstash ì™€ consumer logstash ì˜ codecì´ ë§ì•„ì•¼ ì œëŒ€ë¡œ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. ë¨¼ì € access logì—ì„œ kafka ë¡œ produce í•˜ëŠ” logstash ì—ì„œëŠ” output í• ë•Œ codec ì„ ë§ì¶°ì£¼ê³ 
output { kafka { bootstrap_servers => &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id => &#34;apache-log&#34; codec => json{} } } kafka ì—ì„œ consume í•˜ëŠ” logstash ì—ì„œëŠ” input ì—ì„œ codec ì„ ë§ì¶°ì¤€ë‹¤.
input { kafka { bootstrap_servers => &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id => &#34;apache-log&#34; codec => json{} } } ê·¸ë ‡ê²Œ ë˜ë©´ codecì´ ë§ì•„ ê° í•„ë“œë¡œ ì´ì˜ê²Œ ì¸ë±ì‹±ì„ í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
í•„ìš”ì—†ëŠ” uriëŠ” ì œì™¸í•˜ê³  ì¸ë±ì‹±í• ìˆ˜ ìˆì„ê¹Œ? /ìœ¼ë¡œëŠ” uri ë¼ë˜ì§€ /server-statusê°™ì´ ì•Œê³ ìˆì§€ë§Œ ì¸ë±ì‹±ì€ í•˜ê¸° ì‹«ì€ ê²½ìš°ëŠ” ê°„ë‹¨í•˜ê²Œ ì•„ë˜ì²˜ëŸ¼ ifë¬¸ìœ¼ë¡œ ì œì™¸ì‹œí‚¬ìˆ˜ ìˆì—ˆë‹¤."><meta property="og:type" content="article"><meta property="og:url" content="https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/"><meta property="og:image" content="https://taetaetae.github.io/images/apache-access-log-to-es/model_1.png"><meta property="article:published_time" content="2018-01-25T21:18:35+00:00"><meta property="article:modified_time" content="2018-01-25T21:18:35+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/apache-access-log-to-es/model_1.png"><meta name=twitter:title content="ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì."><meta name=twitter:description content="apache access log ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ì€ ìƒí™©ì´ ìƒê²¼ë‹¤. ì•„ë‹ˆ ê·¸ë³´ë‹¤ apache accessì— ëŒ€í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ê³ ì‹¶ì—ˆê³ , logë¥¼ ê²€ìƒ‰ & ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ ìœ ì˜ë¯¸í•œ ë¶„ì„ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ ë³´ê³  ì‹¶ì—ˆë‹¤. ê·¸ì— ìƒê°í•œê²ƒì´ (ì—­ì‹œ) ElasticStack.ì²˜ìŒì— ìƒê°í•œ ë°©ì•ˆì€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë‹¨ìˆœí–ˆë‹¤. ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡°&#34; ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡° 
í•˜ì§€ë§Œ, ë‚´ ë‹¨ìˆœí•œ(?) ì˜ˆìƒì€ ì—­ì‹œ ë¹—ë‚˜ê°”ê³  logstashì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ì—ˆë‹¤.
 retrying individual bulk actions that failed or were rejected by the previous bulk request
 requestê°€ ë§ì•„ì§ì— ë”°ë¼ elasticsearchê°€ ë²„ë²…ê±°ë¦¬ë”ë‹ˆ logstashì—ì„œ ëŒ€ëŸ‰ì‘ì—…ì€ ê±°ë¶€í•˜ê² ë‹¤ë©° ì¸ë±ì‹±ì„ ë©ˆì·„ë‹¤. ê³ ë¯¼ê³ ë¯¼í•˜ë‹¤ elasticsearchì— ì¸ë±ì‹±í• ë•Œ ë¶€í•˜ê°€ ë§ì´ ê±¸ë¦¬ëŠ” ìƒí™©ì—ì„œ ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘” ê²½í—˜ì´ ìˆì–´ì„œ facebookê·¸ë£¹ì— ë¬¸ì˜ë¥¼ í•´ë´¤ë‹¤. https://www.facebook.com/groups/elasticsearch.kr/?multi_permalinks=1566735266745641 ì—­ì‹œ ë‚˜ë³´ë‹¤ í•œì°¸ì„ ì•ì„œê°€ì‹œëŠ” ë¶„ë“¤ì€ ì´ë¯¸ ì—ëŸ¬ê°€ ë­”ì§€ ì•Œê³  ìˆìœ¼ì…¨ê³ , ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘ê³  í•˜ë‹ˆ ì˜ëœë‹¤ëŠ” ì˜ê²¬ì´ ìˆì–´ ë‚˜ë„ ë”°ë¼í•´ë´¤ë‹¤. ë¬¼ë¡  ë‹µë³€ì¤‘ì— ë‚˜ì˜¨ redisê°€ ì•„ë‹Œ ê¸°ì¡´ì—ë„ ë¹„ìŠ·í•œ êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë˜ kafkaë¥¼ ì ìš©. ì•„, ê·¸ì „ì— í˜„ì¬êµ¬ì„±ì€ Elasticsearch ë…¸ë“œê°€ ì´ 3ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ë° ë…¸ë“œë¥¼ ì¶”ê°€ë¡œ ëŠ˜ë¦¬ë©° ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ í•´ë³´ê¸°ì „ì— í• ìˆ˜ìˆëŠ” ë§ˆì§€ë§‰ ë°©ë²•ì´ë‹¤ ìƒê°í•˜ê³  ì¤‘ê°„ì— kafkaë¥¼ ë‘¬ì„œ ë¶€í•˜ë¥¼ ì¤„ì—¬ë³´ê³  ì‹¶ì—ˆë‹¤. (ì–¸ì œë¶€í„´ê°€ ë§ˆì¹˜ ì—¬ëŸ¬ê°œì˜ í†±ë‹ˆë°”í€´ê°€ ë§ë¬¼ë ¤ ëŒì•„ê°€ëŠ”ë“¯í•œ ì‹œìŠ¤í…œ ì„¤ê³„ë¥¼ í•˜ëŠ”ê²Œ ì¬ë°Œì—ˆë‹¤.) ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë§ì´ë‹¤.
ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°&#34; ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°  ê·¸ë¬ë”ë‹ˆ ê±°ì§“ë§ ì²˜ëŸ¼ ì—ëŸ¬í•˜ë‚˜ ì—†ì´ ì˜ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. logstashê°€ ì–‘ìª½ì— ìˆëŠ”ê²Œ ì•½ê°„ ê±¸ë¦¬ê¸´ í•˜ì§€ë§Œ, ì²˜ìŒì— ìƒê°í•œ êµ¬ì¡°ë³´ë‹¤ëŠ” ì—ëŸ¬ê°€ ì•ˆë‚˜ë‹ˆ ë‹¤í–‰ì´ë¼ ìƒê°í•œë‹¤.
ì´ êµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ì„œ ì–»ì€ Insightê°€ ìˆê¸°ì—, ê° í•­ëª©ë³„ë¡œ ì ì–´ ë³´ê³ ì í•œë‹¤. ( ì´ê²ƒë§Œ ì ì–´ë†“ê¸°ì—” ë„ˆë¬´ ì—†ì–´ë³´ì—¬ì„œ.. )
access log ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ì—¬ ì¸ë±ì‹± í• ê²ƒì¸ê°€? apache 2.xë¥¼ ì‚¬ìš©í•˜ê³  ë³„ë„ì˜ ë¡œê·¸ í¬ë§·ì„ ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì€ access logê°€ ì°íŒë‹¤. 123.1.1.1 - - [25/Jan/2018:21:55:35 +0900] &#34;GET /api/test?param=12341234 HTTP/1.1&#34; 200 48 1144 &#34;http://www.naver.com/&#34; &#34;Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NAVER(inapp; blog; 100; 4.0.44)&#34; ê·¸ëŸ¼ ì´ ë¡œê·¸ë¥¼ ì•„ë¬´ í¬ë§·íŒ… ì—†ì´ ë¡œê¹…ì„ í•˜ë©´ ê·¸ëƒ¥ í•œì¤„ì˜ í…ìŠ¤íŠ¸ê°€ ì¸ë±ì‹±ì´ ëœë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ elasticsearch ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì¬ê°€ê³µí•˜ê±°ë‚˜ ë³„ë„ì˜ ì‘ì—…ì´ í•„ìš”í• ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì¤‘ê°„ì— ìˆëŠ” logstashì—ê²Œ ì¼ì„ ì‹œì¼œ ì¢€ë” nice í•œ ë°©ë²•ìœ¼ë¡œ ì¸ë±ì‹±ì„ í•´ë³´ì. ë°”ë¡œ logstash ì˜ filter ê¸°ëŠ¥ì´ë‹¤. ê·¸ì¤‘ Grok filter ë¼ëŠ”ê²Œ ìˆëŠ”ë° íŒ¨í„´ì„ ì ìš©í•˜ì—¬ row data ë¥¼ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ ê³ ë§™ê²Œë„ ì•„íŒŒì¹˜ í•„í„° ì˜ˆì œê°€ ìˆì–´ ìˆ˜ì •í•˜ì—¬ ì ìš©í• ìˆ˜ ìˆì—ˆë‹¤. http://grokconstructor.appspot.com/do/match?example=2 ê·¸ë˜ì„œ ì ìš©í•œ í•„í„°ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
filter { grok { match => { message => &#34;%{IP:clientIp} (?:-|) (?:-|) \[%{HTTPDATE:timestamp}\] \&#34;(?:%{WORD:httpMethod} %{URIPATH:uri}%{GREEDYDATA}(?: HTTP/%{NUMBER})?|-)\&#34; %{NUMBER:responseCode} (?:-|%{NUMBER})&#34; } } } ì´ë ‡ê²Œ í•˜ê³  elasticsearch ì— ì¸ë±ì‹±ì„ í•˜ë©´ í‚¤ë°”ë‚˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³¼ìˆ˜ ìˆë‹¤. í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log&#34; í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log 
ê° í•„ë“œê°€ ì•„ë‹Œ í•œì¤„ë¡œ ì¸ë±ì‹±ì´ ë˜ì–´ë²„ë¦°ë‹¤. Elasticsearch ì— ì¸ë±ì‹±ì´ ë˜ê¸´ í•˜ëŠ”ë° ë¡œê·¸ í•œì¤„ì´ í†µì§¸ë¡œ ë“¤ì–´ê°€ ë²„ë¦°ë‹¤. messageë¼ëŠ” ì´ë¦„ìœ¼ë¡œ&mldr; ì•Œê³ ë³´ë‹ˆ í˜„ì¬ êµ¬ì¡°ëŠ” logstashê°€ kafka ì• ë’¤ì— ìˆë‹¤ë³´ë‹ˆ producer logstash ì™€ consumer logstash ì˜ codecì´ ë§ì•„ì•¼ ì œëŒ€ë¡œ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. ë¨¼ì € access logì—ì„œ kafka ë¡œ produce í•˜ëŠ” logstash ì—ì„œëŠ” output í• ë•Œ codec ì„ ë§ì¶°ì£¼ê³ 
output { kafka { bootstrap_servers => &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id => &#34;apache-log&#34; codec => json{} } } kafka ì—ì„œ consume í•˜ëŠ” logstash ì—ì„œëŠ” input ì—ì„œ codec ì„ ë§ì¶°ì¤€ë‹¤.
input { kafka { bootstrap_servers => &#34;123.1.2.3:9092,123.1.2.4:9092&#34; topic_id => &#34;apache-log&#34; codec => json{} } } ê·¸ë ‡ê²Œ ë˜ë©´ codecì´ ë§ì•„ ê° í•„ë“œë¡œ ì´ì˜ê²Œ ì¸ë±ì‹±ì„ í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
í•„ìš”ì—†ëŠ” uriëŠ” ì œì™¸í•˜ê³  ì¸ë±ì‹±í• ìˆ˜ ìˆì„ê¹Œ? /ìœ¼ë¡œëŠ” uri ë¼ë˜ì§€ /server-statusê°™ì´ ì•Œê³ ìˆì§€ë§Œ ì¸ë±ì‹±ì€ í•˜ê¸° ì‹«ì€ ê²½ìš°ëŠ” ê°„ë‹¨í•˜ê²Œ ì•„ë˜ì²˜ëŸ¼ ifë¬¸ìœ¼ë¡œ ì œì™¸ì‹œí‚¬ìˆ˜ ìˆì—ˆë‹¤."><meta name=application-name content="ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„"><meta name=apple-mobile-web-app-title content="ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/><link rel=prev href=https://taetaetae.github.io/2018/01/08/python-2-to-3/><link rel=next href=https://taetaetae.github.io/2018/02/01/linux-selenium/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì.","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2018\/01\/25\/apache-access-log-to-es\/"},"genre":"posts","keywords":"elasticsearch, logstash, kafka, access log, archives-2018","wordcount":720,"url":"https:\/\/taetaetae.github.io\/2018\/01\/25\/apache-access-log-to-es\/","datePublished":"2018-01-25T21:18:35+00:00","dateModified":"2018-01-25T21:18:35+00:00","publisher":{"@type":"Organization","name":"íƒœíƒœíƒœ"},"author":{"@type":"Person","name":"íƒœíƒœíƒœ"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„">ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„">ğŸ‘¨â€ğŸ’»ê¿ˆê¾¸ëŠ” íƒœíƒœíƒœì˜ ê³µê°„</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:inline-block;width:260px;height:600px data-ad-client=ca-pub-5788330009690816 data-ad-slot=2248955907></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div><article class="page single"><h1 class="single-title animated flipInX">ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì.</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>íƒœíƒœíƒœ</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw"></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-01-25>2018-01-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;720 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#access-log-ë¥¼-ì–´ë–»ê²Œ-ë¶„ì„í•˜ì—¬-ì¸ë±ì‹±-í• ê²ƒì¸ê°€>access log ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ì—¬ ì¸ë±ì‹± í• ê²ƒì¸ê°€?</a></li><li><a href=#ê°-í•„ë“œê°€-ì•„ë‹Œ-í•œì¤„ë¡œ-ì¸ë±ì‹±ì´-ë˜ì–´ë²„ë¦°ë‹¤>ê° í•„ë“œê°€ ì•„ë‹Œ í•œì¤„ë¡œ ì¸ë±ì‹±ì´ ë˜ì–´ë²„ë¦°ë‹¤.</a></li><li><a href=#í•„ìš”ì—†ëŠ”-uriëŠ”-ì œì™¸í•˜ê³ -ì¸ë±ì‹±í• ìˆ˜-ìˆì„ê¹Œ>í•„ìš”ì—†ëŠ” uriëŠ” ì œì™¸í•˜ê³  ì¸ë±ì‹±í• ìˆ˜ ìˆì„ê¹Œ?</a></li><li><a href=#í•˜ë‚˜ì˜-indexë¡œëŠ”-ê´€ë¦¬ê°€-í˜ë“ ë°-ë‚˜ëˆŒìˆœ-ì—†ì„ê¹Œ>í•˜ë‚˜ì˜ indexë¡œëŠ” ê´€ë¦¬ê°€ í˜ë“ ë° ë‚˜ëˆŒìˆœ ì—†ì„ê¹Œ?</a></li></ul></nav></div></div><div class=content id=content><p>apache access log ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ì€ ìƒí™©ì´ ìƒê²¼ë‹¤. ì•„ë‹ˆ ê·¸ë³´ë‹¤ apache accessì— ëŒ€í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ê³ ì‹¶ì—ˆê³ , logë¥¼ ê²€ìƒ‰ & ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ ìœ ì˜ë¯¸í•œ ë¶„ì„ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ ë³´ê³  ì‹¶ì—ˆë‹¤. ê·¸ì— ìƒê°í•œê²ƒì´ (ì—­ì‹œ) <code>ElasticStack</code>.</p><p>ì²˜ìŒì— ìƒê°í•œ ë°©ì•ˆì€ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë‹¨ìˆœí–ˆë‹¤.<figure><a class=lightgallery href=/images/apache-access-log-to-es/model_1.png title=/images/apache-access-log-to-es/model_1.png data-thumbnail=/images/apache-access-log-to-es/model_1.png data-sub-html="<h2>ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡°</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/apache-access-log-to-es/model_1.png data-srcset="/images/apache-access-log-to-es/model_1.png, /images/apache-access-log-to-es/model_1.png 1.5x, /images/apache-access-log-to-es/model_1.png 2x" data-sizes=auto alt=/images/apache-access-log-to-es/model_1.png></a><figcaption class=image-caption>ì²˜ìŒ ìƒê°í•œ ë‹¨ìˆœí•œ êµ¬ì¡°</figcaption></figure></p><p>í•˜ì§€ë§Œ, ë‚´ ë‹¨ìˆœí•œ(?) ì˜ˆìƒì€ ì—­ì‹œ ë¹—ë‚˜ê°”ê³  logstashì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ì—ˆë‹¤.</p><blockquote><p>retrying individual bulk actions that failed or were rejected by the previous bulk request</p></blockquote><p>requestê°€ ë§ì•„ì§ì— ë”°ë¼ elasticsearchê°€ ë²„ë²…ê±°ë¦¬ë”ë‹ˆ logstashì—ì„œ ëŒ€ëŸ‰ì‘ì—…ì€ ê±°ë¶€í•˜ê² ë‹¤ë©° ì¸ë±ì‹±ì„ ë©ˆì·„ë‹¤. ê³ ë¯¼ê³ ë¯¼í•˜ë‹¤ elasticsearchì— ì¸ë±ì‹±í• ë•Œ ë¶€í•˜ê°€ ë§ì´ ê±¸ë¦¬ëŠ” ìƒí™©ì—ì„œ ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘” ê²½í—˜ì´ ìˆì–´ì„œ facebookê·¸ë£¹ì— ë¬¸ì˜ë¥¼ í•´ë´¤ë‹¤.
<a href="https://www.facebook.com/groups/elasticsearch.kr/?multi_permalinks=1566735266745641">https://www.facebook.com/groups/elasticsearch.kr/?multi_permalinks=1566735266745641</a>
ì—­ì‹œ ë‚˜ë³´ë‹¤ í•œì°¸ì„ ì•ì„œê°€ì‹œëŠ” ë¶„ë“¤ì€ ì´ë¯¸ ì—ëŸ¬ê°€ ë­”ì§€ ì•Œê³  ìˆìœ¼ì…¨ê³ , ì¤‘ê°„ì— ë²„í¼ë¥¼ ë‘ê³  í•˜ë‹ˆ ì˜ëœë‹¤ëŠ” ì˜ê²¬ì´ ìˆì–´ ë‚˜ë„ ë”°ë¼í•´ë´¤ë‹¤. ë¬¼ë¡  ë‹µë³€ì¤‘ì— ë‚˜ì˜¨ redisê°€ ì•„ë‹Œ ê¸°ì¡´ì—ë„ ë¹„ìŠ·í•œ êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë˜ kafkaë¥¼ ì ìš©.
ì•„, ê·¸ì „ì— í˜„ì¬êµ¬ì„±ì€ Elasticsearch ë…¸ë“œê°€ ì´ 3ëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ë° ë…¸ë“œë¥¼ ì¶”ê°€ë¡œ ëŠ˜ë¦¬ë©° ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ í•´ë³´ê¸°ì „ì— í• ìˆ˜ìˆëŠ” ë§ˆì§€ë§‰ ë°©ë²•ì´ë‹¤ ìƒê°í•˜ê³  ì¤‘ê°„ì— kafkaë¥¼ ë‘¬ì„œ ë¶€í•˜ë¥¼ ì¤„ì—¬ë³´ê³  ì‹¶ì—ˆë‹¤. (ì–¸ì œë¶€í„´ê°€ ë§ˆì¹˜ ì—¬ëŸ¬ê°œì˜ í†±ë‹ˆë°”í€´ê°€ ë§ë¬¼ë ¤ ëŒì•„ê°€ëŠ”ë“¯í•œ ì‹œìŠ¤í…œ ì„¤ê³„ë¥¼ í•˜ëŠ”ê²Œ ì¬ë°Œì—ˆë‹¤.) ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ë§ì´ë‹¤.</p><figure><a class=lightgallery href=/images/apache-access-log-to-es/model_2.png title=/images/apache-access-log-to-es/model_2.png data-thumbnail=/images/apache-access-log-to-es/model_2.png data-sub-html="<h2>ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/apache-access-log-to-es/model_2.png data-srcset="/images/apache-access-log-to-es/model_2.png, /images/apache-access-log-to-es/model_2.png 1.5x, /images/apache-access-log-to-es/model_2.png 2x" data-sizes=auto alt=/images/apache-access-log-to-es/model_2.png></a><figcaption class=image-caption>ê·¸ë‚˜ë§ˆ ì¢€ë” ìƒê°í•œ êµ¬ì¡°</figcaption></figure><p>ê·¸ë¬ë”ë‹ˆ ê±°ì§“ë§ ì²˜ëŸ¼ ì—ëŸ¬í•˜ë‚˜ ì—†ì´ ì˜ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤. logstashê°€ ì–‘ìª½ì— ìˆëŠ”ê²Œ ì•½ê°„ ê±¸ë¦¬ê¸´ í•˜ì§€ë§Œ, ì²˜ìŒì— ìƒê°í•œ êµ¬ì¡°ë³´ë‹¤ëŠ” ì—ëŸ¬ê°€ ì•ˆë‚˜ë‹ˆ ë‹¤í–‰ì´ë¼ ìƒê°í•œë‹¤.</p><p>ì´ êµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ì„œ ì–»ì€ Insightê°€ ìˆê¸°ì—, ê° í•­ëª©ë³„ë¡œ ì ì–´ ë³´ê³ ì í•œë‹¤. ( <del>ì´ê²ƒë§Œ ì ì–´ë†“ê¸°ì—” ë„ˆë¬´ ì—†ì–´ë³´ì—¬ì„œ..</del> )</p><h2 id=access-log-ë¥¼-ì–´ë–»ê²Œ-ë¶„ì„í•˜ì—¬-ì¸ë±ì‹±-í• ê²ƒì¸ê°€>access log ë¥¼ ì–´ë–»ê²Œ ë¶„ì„í•˜ì—¬ ì¸ë±ì‹± í• ê²ƒì¸ê°€?</h2><p>apache 2.xë¥¼ ì‚¬ìš©í•˜ê³  ë³„ë„ì˜ ë¡œê·¸ í¬ë§·ì„ ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì€ access logê°€ ì°íŒë‹¤.
<code>123.1.1.1 - - [25/Jan/2018:21:55:35 +0900] "GET /api/test?param=12341234 HTTP/1.1" 200 48 1144 "http://www.naver.com/" "Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X) AppleWebKit/604.3.5 (KHTML, like Gecko) Mobile/15B202 NAVER(inapp; blog; 100; 4.0.44)"</code>
ê·¸ëŸ¼ ì´ ë¡œê·¸ë¥¼ ì•„ë¬´ í¬ë§·íŒ… ì—†ì´ ë¡œê¹…ì„ í•˜ë©´ ê·¸ëƒ¥ í•œì¤„ì˜ í…ìŠ¤íŠ¸ê°€ ì¸ë±ì‹±ì´ ëœë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ elasticsearch ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì¬ê°€ê³µí•˜ê±°ë‚˜ ë³„ë„ì˜ ì‘ì—…ì´ í•„ìš”í• ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì¤‘ê°„ì— ìˆëŠ” logstashì—ê²Œ ì¼ì„ ì‹œì¼œ ì¢€ë” nice í•œ ë°©ë²•ìœ¼ë¡œ ì¸ë±ì‹±ì„ í•´ë³´ì. ë°”ë¡œ logstash ì˜ filter ê¸°ëŠ¥ì´ë‹¤. ê·¸ì¤‘ Grok filter ë¼ëŠ”ê²Œ ìˆëŠ”ë° íŒ¨í„´ì„ ì ìš©í•˜ì—¬ row data ë¥¼ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì¡°ê¸ˆ ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ ê³ ë§™ê²Œë„ ì•„íŒŒì¹˜ í•„í„° ì˜ˆì œê°€ ìˆì–´ ìˆ˜ì •í•˜ì—¬ ì ìš©í• ìˆ˜ ìˆì—ˆë‹¤. <a href="http://grokconstructor.appspot.com/do/match?example=2">http://grokconstructor.appspot.com/do/match?example=2</a>
ê·¸ë˜ì„œ ì ìš©í•œ í•„í„°ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>filter <span class=o>{</span>
        grok <span class=o>{</span>
                <span class=nv>match</span> <span class=o>=</span>&gt; <span class=o>{</span>
                        <span class=nv>message</span> <span class=o>=</span>&gt; <span class=s2>&#34;%{IP:clientIp} (?:-|) (?:-|) \[%{HTTPDATE:timestamp}\] \&#34;(?:%{WORD:httpMethod} %{URIPATH:uri}%{GREEDYDATA}(?: HTTP/%{NUMBER})?|-)\&#34; %{NUMBER:responseCode} (?:-|%{NUMBER})&#34;</span>
                <span class=o>}</span>
        <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>ì´ë ‡ê²Œ í•˜ê³  elasticsearch ì— ì¸ë±ì‹±ì„ í•˜ë©´ í‚¤ë°”ë‚˜ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³¼ìˆ˜ ìˆë‹¤.<figure><a class=lightgallery href=/images/apache-access-log-to-es/access_log_kibana.png title=/images/apache-access-log-to-es/access_log_kibana.png data-thumbnail=/images/apache-access-log-to-es/access_log_kibana.png data-sub-html="<h2>í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/apache-access-log-to-es/access_log_kibana.png data-srcset="/images/apache-access-log-to-es/access_log_kibana.png, /images/apache-access-log-to-es/access_log_kibana.png 1.5x, /images/apache-access-log-to-es/access_log_kibana.png 2x" data-sizes=auto alt=/images/apache-access-log-to-es/access_log_kibana.png></a><figcaption class=image-caption>í‚¤ë°”ë‚˜ì— ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŒ€ë¡œ ì´ì˜ê²Œ ë“¤ì–´ê°€ ìˆëŠ” access log</figcaption></figure></p><h2 id=ê°-í•„ë“œê°€-ì•„ë‹Œ-í•œì¤„ë¡œ-ì¸ë±ì‹±ì´-ë˜ì–´ë²„ë¦°ë‹¤>ê° í•„ë“œê°€ ì•„ë‹Œ í•œì¤„ë¡œ ì¸ë±ì‹±ì´ ë˜ì–´ë²„ë¦°ë‹¤.</h2><p>Elasticsearch ì— ì¸ë±ì‹±ì´ ë˜ê¸´ í•˜ëŠ”ë° ë¡œê·¸ í•œì¤„ì´ í†µì§¸ë¡œ ë“¤ì–´ê°€ ë²„ë¦°ë‹¤. <code>message</code>ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ&mldr; ì•Œê³ ë³´ë‹ˆ í˜„ì¬ êµ¬ì¡°ëŠ” logstashê°€ kafka ì• ë’¤ì— ìˆë‹¤ë³´ë‹ˆ producer logstash ì™€ consumer logstash ì˜ <code>codec</code>ì´ ë§ì•„ì•¼ ì œëŒ€ë¡œ ì¸ë±ì‹±ì´ ë ìˆ˜ ìˆì—ˆë‹¤.
ë¨¼ì € access logì—ì„œ kafka ë¡œ produce í•˜ëŠ” logstash ì—ì„œëŠ” output í• ë•Œ codec ì„ ë§ì¶°ì£¼ê³ </p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>output <span class=o>{</span>
        kafka <span class=o>{</span>
                <span class=nv>bootstrap_servers</span> <span class=o>=</span>&gt; <span class=s2>&#34;123.1.2.3:9092,123.1.2.4:9092&#34;</span>
                <span class=nv>topic_id</span> <span class=o>=</span>&gt; <span class=s2>&#34;apache-log&#34;</span>
                <span class=nv>codec</span> <span class=o>=</span>&gt; json<span class=o>{}</span>
        <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>kafka ì—ì„œ consume í•˜ëŠ” logstash ì—ì„œëŠ” input ì—ì„œ codec ì„ ë§ì¶°ì¤€ë‹¤.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>input <span class=o>{</span>
        kafka <span class=o>{</span>
                <span class=nv>bootstrap_servers</span> <span class=o>=</span>&gt; <span class=s2>&#34;123.1.2.3:9092,123.1.2.4:9092&#34;</span>
                <span class=nv>topic_id</span> <span class=o>=</span>&gt; <span class=s2>&#34;apache-log&#34;</span>
                <span class=nv>codec</span> <span class=o>=</span>&gt; json<span class=o>{}</span>
        <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>ê·¸ë ‡ê²Œ ë˜ë©´ codecì´ ë§ì•„ ê° í•„ë“œë¡œ <code>ì´ì˜ê²Œ</code> ì¸ë±ì‹±ì„ í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p><h2 id=í•„ìš”ì—†ëŠ”-uriëŠ”-ì œì™¸í•˜ê³ -ì¸ë±ì‹±í• ìˆ˜-ìˆì„ê¹Œ>í•„ìš”ì—†ëŠ” uriëŠ” ì œì™¸í•˜ê³  ì¸ë±ì‹±í• ìˆ˜ ìˆì„ê¹Œ?</h2><p><code>/</code>ìœ¼ë¡œëŠ” uri ë¼ë˜ì§€ <code>/server-status</code>ê°™ì´ ì•Œê³ ìˆì§€ë§Œ ì¸ë±ì‹±ì€ í•˜ê¸° ì‹«ì€ ê²½ìš°ëŠ” ê°„ë‹¨í•˜ê²Œ ì•„ë˜ì²˜ëŸ¼ ifë¬¸ìœ¼ë¡œ ì œì™¸ì‹œí‚¬ìˆ˜ ìˆì—ˆë‹¤.(ë‹¹ì—°í•˜ê²Œ ë³´ì¼ì§„ ëª¨ë¥´ê²Ÿì§€ë§Œ ë‚´ê² ë„ˆë¬´ ìƒê°ë³´ë‹¤ í¸í•˜ê²Œ ì´ìŠˆë¥¼ í•´ê²°í• ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ë‹¤.)</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>output <span class=o>{</span>
        <span class=k>if</span> <span class=o>[</span>uri<span class=o>]</span> <span class=o>=</span>~ /.+/ and <span class=o>[</span>uri<span class=o>]</span> !<span class=o>=</span> <span class=s2>&#34;/server-status&#34;</span> <span class=o>{</span>
                kafka <span class=o>{</span>
                        <span class=nv>bootstrap_servers</span> <span class=o>=</span>&gt; <span class=s2>&#34;123.1.2.3:9092,123.1.2.4:9092&#34;</span>
                        <span class=nv>topic_id</span> <span class=o>=</span>&gt; <span class=s2>&#34;apache-log&#34;</span>
                        <span class=nv>codec</span> <span class=o>=</span>&gt; json<span class=o>{}</span>
                <span class=o>}</span>
        <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><h2 id=í•˜ë‚˜ì˜-indexë¡œëŠ”-ê´€ë¦¬ê°€-í˜ë“ ë°-ë‚˜ëˆŒìˆœ-ì—†ì„ê¹Œ>í•˜ë‚˜ì˜ indexë¡œëŠ” ê´€ë¦¬ê°€ í˜ë“ ë° ë‚˜ëˆŒìˆœ ì—†ì„ê¹Œ?</h2><p>ì‚¬ì‹¤ ì´ í•­ëª©ì€ logstashì— í•´ë‹¹í•˜ëŠ” ì˜µì…˜ì´ê¸´ í•˜ì§€ë§Œ. ê²¸ì‚¬ê²¸ì‚¬ ì ì–´ë³¸ë‹¤.
ì´ë¯¸ ì§€ë‚œ ë¡œê·¸ëŠ” ì§€ì›Œì•¼ í•  ìƒí™©ì´ ì˜¨ë‹¤. ì´ë¥¼í…Œë©´ 1ë…„ì´ ì§€ë‚¬ê±°ë‚˜. ê·¸ëŸ´ê²½ìš° ë§ˆì§€ë§‰ elasticsearch ë¡œ output í•˜ëŠ” logstash ì„¤ì •ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í• ìˆ˜ ìˆë‹¤.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>output<span class=o>{</span>
	elasticsearch <span class=o>{</span>
		<span class=nv>hosts</span> <span class=o>=</span>&gt; <span class=o>[</span><span class=s2>&#34;123.1.2.3:9200&#34;</span>, <span class=s2>&#34;123.1.2.4:9200&#34;</span><span class=o>]</span>
		<span class=nv>index</span> <span class=o>=</span>&gt; <span class=s2>&#34;apache-log-%{+YYYY.MM}&#34;</span>
		<span class=nv>document_type</span> <span class=o>=</span>&gt; <span class=s2>&#34;apache&#34;</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>ì´ë ‡ê²Œ í•˜ê³  apache ë¼ëŠ” í…œí”Œë¦¿ì„ ì§€ì •í•´ ë†“ìœ¼ë©´ ë‹¬ì´ ë°”ë€”ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ í•´ë‹¹ í…œí”Œë¦¿ì— ë§ì¶”ì–´ indexê°€ ë§Œë“¤ì–´ì§€ê²Œ ë˜ê³ , ì›í•˜ëŠ” ë‹¬ ì „ì²´ì˜ ë°ì´í„°ë¥¼ í•œë²ˆì— ì§€ìš¸ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆëŠ”ê²ƒ ê°™ë‹¤.</p><p>ì´ëŸ° ì €ëŸ° ì‚½ì§ˆì˜ ê³¼ì •ì˜ ëì—ëŠ” ë‹¬ì½¤í•œ ë³´ìƒì´ ë”°ë¥´ëŠ”ê²ƒ ê°™ë‹¤.(í•­ìƒ ê·¸ëŸ¬ëŠ”ê±´ ì•„ë‹ˆì§€ë§Œ..) ì•„ë˜ì²˜ëŸ¼ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“¤ì–´ í•œëˆˆì— apache ë‹¨ì—ì„œì˜ requestë¥¼ ë¶„ì„í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ë¬¼ë¡  ì´ë³´ë‹¤ ë” í•œê²ƒë„ í• ìˆ˜ ìˆì„ê²ƒ ê°™ë‹¤.</p><figure><a class=lightgallery href=/images/apache-access-log-to-es/kibana.png title=/images/apache-access-log-to-es/kibana.png data-thumbnail=/images/apache-access-log-to-es/kibana.png data-sub-html="<h2>í‚¤ë°”ë‚˜ ëŒ€ì‹œë³´ë“œ ëª¨ìŠµ</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/apache-access-log-to-es/kibana.png data-srcset="/images/apache-access-log-to-es/kibana.png, /images/apache-access-log-to-es/kibana.png 1.5x, /images/apache-access-log-to-es/kibana.png 2x" data-sizes=auto alt=/images/apache-access-log-to-es/kibana.png></a><figcaption class=image-caption>í‚¤ë°”ë‚˜ ëŒ€ì‹œë³´ë“œ ëª¨ìŠµ</figcaption></figure><p>ë§¤ë²ˆ ìƒˆë¡œìš´ ê¸°ìˆ ì„ ìŠµë“í• ë•Œë§ˆë‹¤ ëŠë¼ëŠ”ê±°ì§€ë§Œ, ê³ ì „ ê¸°ìˆ ë¡œ ì–´ë µê²Œ ì–´ë µê²Œ ì‹œê°„ì„ ì†Œë¹„í•˜ë©° êµ¬ì„±í•˜ëŠ” ê²ƒë³´ë‹¤ ìƒˆë¡œìš´ ê¸°ìˆ ì„ ë¹¨ë¦¬ ìŠµë“í•˜ê³  ì‚½ì§ˆí•  ì‹œê°„ì— ë” ë‹¤ì–‘í•œ ìƒê°ì„ í•´ë³´ëŠ”ê²Œ ì¢‹ì€ê²ƒ ê°™ë‹¤. íŠ¹íˆ ì´ Elasticsearch ëŠ” ì„¤ì • ëª‡ë²ˆë§Œìœ¼ë¡œ ì´ë ‡ê²Œ ê°•ë ¥í•œ(?) êµ¬ì„±ì„ ë§Œë“¤ìˆ˜ ìˆë‹¤ëŠ”ê±°ì— ë„ˆë¬´ ì‹ ê¸°í•˜ë©´ì„œë„ ê°ì‚¬í•˜ë‹¤.</p><p>ì, ë‹¤ìŒì—” ë˜ ì–´ë–¤ê±¸ í•´ë³¼ìˆ˜ ìˆì„ê¹Œ!? ê°€ì¦ˆì•„~</p><ul><li><code>2018. 01. 26 ì¶”ê°€</code></li></ul><pre><code>ê° ë²„ì „ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (esë¥¼ ì–´ì„œ ì—…ê·¸ë ˆì´ë“œ í•´ì•¼í•˜ëŠ”ë°...)
elasticsearch : 2.4.0
logstash : logstash-5.4.3
kafka : 0.11.0.0
apache : 2.2.x
</code></pre></div><center><style>.bmc-button img{width:27px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:29px!important;height:30px!important;text-decoration:none!important;display:inline-flex!important;color:#000!important;background-color:#fd0!important;border-radius:3px!important;border:1px solid transparent!important;padding:1px 9px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#000!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><center><br><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/taetaetae><img src=https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg alt="Buy me a coffee"><span style=margin-left:5px>Buy me a coffee</span></a>
<a href=https://bit.ly/ddbSupport target=_blank><img src=https://i.imgur.com/peaYpjh.png style=height:28px></a></center><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2018-01-25</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/ data-title="ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì." data-hashtags="elasticsearch,logstash,kafka,access log,archives-2018"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/ data-hashtag=elasticsearch><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2018/01/25/apache-access-log-to-es/ data-title="ì•„íŒŒì¹˜ ì—‘ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì— ì¸ë±ì‹± í•´ë³´ì." data-description><i class="fab fa-blogger fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/elasticsearch/>elasticsearch</a>,&nbsp;<a href=/tags/logstash/>logstash</a>,&nbsp;<a href=/tags/kafka/>kafka</a>,&nbsp;<a href=/tags/access-log/>access log</a>,&nbsp;<a href=/tags/archives-2018/>archives-2018</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2018/01/08/python-2-to-3/ class=prev rel=prev title="íŒŒì´ì¬ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ (2.6 > 3.6)"><i class="fas fa-angle-left fa-fw"></i>íŒŒì´ì¬ ë²„ì „ ì—…ê·¸ë ˆì´ë“œ (2.6 > 3.6)</a>
<a href=/2018/02/01/linux-selenium/ class=next rel=next title="linux(centOS)ì—ì„œ selenium ì„¤ì •í•˜ê¸° (feat. python)">linux(centOS)ì—ì„œ selenium ì„¤ì •í•˜ê¸° (feat. python)<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>íƒœíƒœíƒœ</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"Comment","lightTheme":"github-light","repo":"taetaetae/blog-comment"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-86432198-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>
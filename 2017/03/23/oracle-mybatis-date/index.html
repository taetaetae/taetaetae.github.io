<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Oracle + Mybatis 환경에서의 Date 다루기 -</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/"><meta property="og:site_name" content="My cool site"><meta property="og:title" content="Oracle + Mybatis 환경에서의 Date 다루기"><meta property="og:description" content='상황 Oracle, Java 8, mybatis3 환경 Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함. 쿼리에 아무 기능을 추가하지 않고 Date 형태로 Model에 바인딩을 하면 시분초가 없어진 2017-01-01 00:00:00 형태로 남게됨 그래서 아래처럼 쿼리 작성할 때마다 TO_CHAR를 사용해서 포맷에 맞추어 형변환을 시키고 Date 또는 String으로 Model에 바인딩 하곤 했음. SELECT TO_CHAR(reg_ymdt, &#39;YYYY-MM-DD HH24:MI:SS&#39;) AS registDate FROM ... 이렇게 하다보니 query 만들때마다 형변환하는 쿼리를 만들어줘야하고, 자칫 포맷형식을 다르게 적으면 엉뚱한 결과를 초래하거나, Date형을 그대로 받아 사용해야하는 상황에서는 다시 형변환하는 과정(String to Date)을 해줘야만 함. .. 귀차니즘의 시작 : 삽질 1. 삽질의 시작 1-1. 오라클의 DATE형 → java.sql.Date 의 경우 mybatis에서는 자동적으로 org.apache.ibatis.type.SqlDateTypeHandler를 호출하게됨 mybatis 3 문서 참고 해당 핸들러의 내부 데이터 변환 코드는 다음과 같음 @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { return rs.getDate(columnName); } java.sql.ResultSet.getDate()메소드를 호출하면 실제 ‘yyyy-mm-dd’ 만 가져와 리턴하게됨 (여기서 디버깅 해보면 rs.getTimestamp(columnName)값은 시분초까지 다 들어가 있음) 따라서 시간값이 없는 yyyy-mm-dd 형태로 리턴이 됨 1-2. 오라클의 DATE형 → java.util.Date 의 경우 mybatis에서는 자동적으로 org.apache.ibatis.type.DateOnlyTypeHandler를 호출하게됨 mybatis 3 문서 참고 해당 핸들러의 내부 데이터 변환 코드는 다음과 같음 @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { java.sql.Date sqlDate = rs.getDate(columnName); if (sqlDate != null) { return new java.util.Date(sqlDate.getTime()); } return null; } 위의 org.apache.ibatis.type.SqlDateTypeHandler 변환코드에서 발생한 문제점과 같이 yyyy-mm-dd 만 가져와서 java.sql.Date 객체를 만들고, 이 정보를 토대로 java.util.Date 객체를 만들게 되는데 앞서 시간값을 뺀 정보로 만들어졌기 때문에 결국 동일하게 yyyy-mm-dd 형태로 리턴이 됨 2. 삽질완료, 해결의 시작 오라클 + mybatis 환경에서 Date타입을 다루기 위해서는 타입핸들러를 명시적으로 만들어줘야 한다는걸 알게됨. 2-1. 오라클의 DATE형 → java.sql.Date 의 경우 아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다. mybatis-config.xml <typeHandlers> <typeHandler handler="com.naver.dbill.admin.common.handler.CustomDateHandler"/> </typeHandlers> CustomDateHandler.java ... import java.sql.Date; ... public class CustomDateHandler extends BaseTypeHandler<Date> { ... @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { Timestamp sqlTimestamp = rs.getTimestamp(columnName); if (sqlTimestamp != null) { return new Date(sqlTimestamp.getTime()); } return null; } ... } 위 코드를 작성하고 실행해보면 정상적으로 시분초 값이 있는 완전한 Date 형태를 볼수 있다. 2-2. 오라클의 DATE형 → java.util.Date 의 경우 아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다. 단, mybatis 3 문서를 보면 java.sql.Date 와는 다르게 기본으로 설정된 typeHandler가 JDBC에 따라 3가지가 있다. 따라서 작성한 커스텀 핸들러를 적용하기 위해서는 명시적으로 자바타입 과 JDBC타입 을 적어줘야 정상적으로 오버라이딩이 되어 해당 핸들러를 사용하게 된다. mybatis-config.xml <typeHandlers> <typeHandler handler="com.naver.dbill.admin.common.handler.CustomDateHandler" javaType="java.util.Date" jdbcType="DATE"/> </typeHandlers> CustomDateHandler.java 는 위와 동일하다. ( import java.util.Date; 사용으로 변경 ) 삽질하며 알게된 보너스 지식 java.sql.Date 는 java.util.Date 을 상속받았다. public class Date extends java.util.Date { } 검색을 하다보면 알수있겠지만 java.sql.Date 는 JDBC등을 이용해서 데이터베이스의 데이터를 사용하는데 적합하고, java.util.Date 은 보다 범용적인 날짜나 시각정보를 다룰때 적합하다고 한다. toString 메소드의 리턴 Format 형태 java.sql.Date : yyyy-mm-dd java.util.Date : EEE MMM dd HH:mm:ss zzz yyyy mybatis 에서 형변환은 mybatis 3 문서에 나와있는 자바타입과 JDBC타입이 일치할 경우에 해당 타입 핸들러를 기본으로 사용하게 된다. 정상혁 님 조언 ( http://d2.naver.com/helloworld/645609 작성하신분 ) Oracle의 JDBC 드라이버가 예상 밖으로 동작하네요. Oracle의 DATE 타입도 문서를 보니 시분초까지 저장하게 되어 있는데, Oracle JDBC 구현체가 DATE 타입의 철학을 오해한게 아닌가하는 생각도 듭니다. 참고로 java.sql.Date, java.sql.TimeStamp는 잘못된 설계라는 비판이 많습니다. 저도 Java의 날짜와 시간 API 라는 글에서 아래와 같이 적은 적이 있습니다. java.sql.Date 클래스는 상위 클래스인 java.util.Date 클래스와 이름이 같다. 이 클래스를 두고 Java 플랫폼 설계자는 클래스 이름을 지으면서 깜빡 존 듯하다는 조롱까지 나왔다.[24]'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-23T11:16:05+00:00"><meta property="article:modified_time" content="2017-03-23T11:16:05+00:00"><meta property="article:tag" content="Mybatis"><meta property="article:tag" content="Date"><meta property="article:tag" content="Oracle"><meta property="article:tag" content="Archives-2017"><meta property="og:image" content="https://taetaetae.github.io/images/oracle-mybatis-date/oracle_mybatis_date.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://taetaetae.github.io/images/oracle-mybatis-date/oracle_mybatis_date.png"><meta name=twitter:title content="Oracle + Mybatis 환경에서의 Date 다루기"><meta name=twitter:description content='상황 Oracle, Java 8, mybatis3 환경 Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함. 쿼리에 아무 기능을 추가하지 않고 Date 형태로 Model에 바인딩을 하면 시분초가 없어진 2017-01-01 00:00:00 형태로 남게됨 그래서 아래처럼 쿼리 작성할 때마다 TO_CHAR를 사용해서 포맷에 맞추어 형변환을 시키고 Date 또는 String으로 Model에 바인딩 하곤 했음. SELECT TO_CHAR(reg_ymdt, &#39;YYYY-MM-DD HH24:MI:SS&#39;) AS registDate FROM ... 이렇게 하다보니 query 만들때마다 형변환하는 쿼리를 만들어줘야하고, 자칫 포맷형식을 다르게 적으면 엉뚱한 결과를 초래하거나, Date형을 그대로 받아 사용해야하는 상황에서는 다시 형변환하는 과정(String to Date)을 해줘야만 함. .. 귀차니즘의 시작 : 삽질 1. 삽질의 시작 1-1. 오라클의 DATE형 → java.sql.Date 의 경우 mybatis에서는 자동적으로 org.apache.ibatis.type.SqlDateTypeHandler를 호출하게됨 mybatis 3 문서 참고 해당 핸들러의 내부 데이터 변환 코드는 다음과 같음 @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { return rs.getDate(columnName); } java.sql.ResultSet.getDate()메소드를 호출하면 실제 ‘yyyy-mm-dd’ 만 가져와 리턴하게됨 (여기서 디버깅 해보면 rs.getTimestamp(columnName)값은 시분초까지 다 들어가 있음) 따라서 시간값이 없는 yyyy-mm-dd 형태로 리턴이 됨 1-2. 오라클의 DATE형 → java.util.Date 의 경우 mybatis에서는 자동적으로 org.apache.ibatis.type.DateOnlyTypeHandler를 호출하게됨 mybatis 3 문서 참고 해당 핸들러의 내부 데이터 변환 코드는 다음과 같음 @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { java.sql.Date sqlDate = rs.getDate(columnName); if (sqlDate != null) { return new java.util.Date(sqlDate.getTime()); } return null; } 위의 org.apache.ibatis.type.SqlDateTypeHandler 변환코드에서 발생한 문제점과 같이 yyyy-mm-dd 만 가져와서 java.sql.Date 객체를 만들고, 이 정보를 토대로 java.util.Date 객체를 만들게 되는데 앞서 시간값을 뺀 정보로 만들어졌기 때문에 결국 동일하게 yyyy-mm-dd 형태로 리턴이 됨 2. 삽질완료, 해결의 시작 오라클 + mybatis 환경에서 Date타입을 다루기 위해서는 타입핸들러를 명시적으로 만들어줘야 한다는걸 알게됨. 2-1. 오라클의 DATE형 → java.sql.Date 의 경우 아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다. mybatis-config.xml <typeHandlers> <typeHandler handler="com.naver.dbill.admin.common.handler.CustomDateHandler"/> </typeHandlers> CustomDateHandler.java ... import java.sql.Date; ... public class CustomDateHandler extends BaseTypeHandler<Date> { ... @Override public Date getNullableResult(ResultSet rs, String columnName) throws SQLException { Timestamp sqlTimestamp = rs.getTimestamp(columnName); if (sqlTimestamp != null) { return new Date(sqlTimestamp.getTime()); } return null; } ... } 위 코드를 작성하고 실행해보면 정상적으로 시분초 값이 있는 완전한 Date 형태를 볼수 있다. 2-2. 오라클의 DATE형 → java.util.Date 의 경우 아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다. 단, mybatis 3 문서를 보면 java.sql.Date 와는 다르게 기본으로 설정된 typeHandler가 JDBC에 따라 3가지가 있다. 따라서 작성한 커스텀 핸들러를 적용하기 위해서는 명시적으로 자바타입 과 JDBC타입 을 적어줘야 정상적으로 오버라이딩이 되어 해당 핸들러를 사용하게 된다. mybatis-config.xml <typeHandlers> <typeHandler handler="com.naver.dbill.admin.common.handler.CustomDateHandler" javaType="java.util.Date" jdbcType="DATE"/> </typeHandlers> CustomDateHandler.java 는 위와 동일하다. ( import java.util.Date; 사용으로 변경 ) 삽질하며 알게된 보너스 지식 java.sql.Date 는 java.util.Date 을 상속받았다. public class Date extends java.util.Date { } 검색을 하다보면 알수있겠지만 java.sql.Date 는 JDBC등을 이용해서 데이터베이스의 데이터를 사용하는데 적합하고, java.util.Date 은 보다 범용적인 날짜나 시각정보를 다룰때 적합하다고 한다. toString 메소드의 리턴 Format 형태 java.sql.Date : yyyy-mm-dd java.util.Date : EEE MMM dd HH:mm:ss zzz yyyy mybatis 에서 형변환은 mybatis 3 문서에 나와있는 자바타입과 JDBC타입이 일치할 경우에 해당 타입 핸들러를 기본으로 사용하게 된다. 정상혁 님 조언 ( http://d2.naver.com/helloworld/645609 작성하신분 ) Oracle의 JDBC 드라이버가 예상 밖으로 동작하네요. Oracle의 DATE 타입도 문서를 보니 시분초까지 저장하게 되어 있는데, Oracle JDBC 구현체가 DATE 타입의 철학을 오해한게 아닌가하는 생각도 듭니다. 참고로 java.sql.Date, java.sql.TimeStamp는 잘못된 설계라는 비판이 많습니다. 저도 Java의 날짜와 시간 API 라는 글에서 아래와 같이 적은 적이 있습니다. java.sql.Date 클래스는 상위 클래스인 java.util.Date 클래스와 이름이 같다. 이 클래스를 두고 Java 플랫폼 설계자는 클래스 이름을 지으면서 깜빡 존 듯하다는 조롱까지 나왔다.[24]'><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><meta name=naver-site-verification content="2d1cdbb963ba178aa7cbf58500afc668cae1e645"><meta name=google-site-verification content="vvFCdv0-GuQhEWG8vtNJfA7YSY2HYQ1hpHh9P-a6Pv8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/><link rel=prev href=https://taetaetae.github.io/2017/03/12/spring-parameter/><link rel=next href=https://taetaetae.github.io/2017/04/04/mybatis-use-generated-keys/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Oracle + Mybatis 환경에서의 Date 다루기","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/taetaetae.github.io\/2017\/03\/23\/oracle-mybatis-date\/"},"genre":"posts","keywords":"mybatis, date, oracle, archives-2017","wordcount":674,"url":"https:\/\/taetaetae.github.io\/2017\/03\/23\/oracle-mybatis-date\/","datePublished":"2017-03-23T11:16:05+00:00","dateModified":"2017-03-23T11:16:05+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"태태태"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>👨‍💻꿈꾸는 태태태의 공간</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Oracle + Mybatis 환경에서의 Date 다루기</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://taetaetae.github.io/resume title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>태태태</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tech/><i class="far fa-folder fa-fw" aria-hidden=true></i>Tech</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2017-03-23>2017-03-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;674 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/oracle-mybatis-date/oracle_mybatis_date.png data-srcset="/images/oracle-mybatis-date/oracle_mybatis_date.png, /images/oracle-mybatis-date/oracle_mybatis_date.png 1.5x, /images/oracle-mybatis-date/oracle_mybatis_date.png 2x" data-sizes=auto alt=/images/oracle-mybatis-date/oracle_mybatis_date.png title=/images/oracle-mybatis-date/oracle_mybatis_date.png></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#상황>상황</a></li><li><a href=#1-삽질의-시작>1. 삽질의 시작</a><ul><li><a href=#1-1-오라클의-date형--javasqldate-의-경우>1-1. <code>오라클의 DATE형</code> → <code>java.sql.Date</code> 의 경우</a></li><li><a href=#1-2-오라클의-date형--javautildate-의-경우>1-2. <code>오라클의 DATE형</code> → <code>java.util.Date</code> 의 경우</a></li></ul></li><li><a href=#2-삽질완료-해결의-시작>2. 삽질완료, 해결의 시작</a><ul><li></li><li><a href=#삽질하며-알게된-보너스-지식>삽질하며 알게된 보너스 지식</a></li><li><a href=#정상혁-님-조언---작성하신분->정상혁 님 조언 ( <a href=http://d2.naver.com/helloworld/645609>http://d2.naver.com/helloworld/645609</a> 작성하신분 )</a></li></ul></li><li><a href=#마치며>마치며</a></li></ul></nav></div></div><div class=content id=content><h2 id=상황>상황</h2><ul><li>Oracle, Java 8, mybatis3 환경</li><li>Date컬럼에 데이터가 있는데 이를 select query로 조회하여 Model에 바인딩 시키고자 함.</li></ul><ul><li>쿼리에 아무 기능을 추가하지 않고 Date 형태로 Model에 바인딩을 하면 시분초가 없어진 <code>2017-01-01 00:00:00</code> 형태로 남게됨</li><li>그래서 아래처럼 쿼리 작성할 때마다 TO_CHAR를 사용해서 포맷에 맞추어 형변환을 시키고 Date 또는 String으로 Model에 바인딩 하곤 했음.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>TO_CHAR</span><span class=p>(</span><span class=n>reg_ymdt</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>registDate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><ul><li>이렇게 하다보니 query 만들때마다 형변환하는 쿼리를 만들어줘야하고, 자칫 포맷형식을 다르게 적으면 엉뚱한 결과를 초래하거나, Date형을 그대로 받아 사용해야하는 상황에서는 다시 형변환하는 과정(<code>String to Date</code>)을 해줘야만 함. .. <code>귀차니즘의 시작 : 삽질</code></li></ul><h2 id=1-삽질의-시작>1. 삽질의 시작</h2><h3 id=1-1-오라클의-date형--javasqldate-의-경우>1-1. <code>오라클의 DATE형</code> → <code>java.sql.Date</code> 의 경우</h3><ul><li>mybatis에서는 자동적으로 <code>org.apache.ibatis.type.SqlDateTypeHandler</code>를 호출하게됨 <a href=http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers target=_blank rel="noopener noreffer">mybatis 3 문서 참고</a></li><li>해당 핸들러의 내부 데이터 변환 코드는 다음과 같음</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=nf>getNullableResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w>  </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getDate</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>java.sql.ResultSet.getDate()</code>메소드를 호출하면 실제 &lsquo;yyyy-mm-dd&rsquo; 만 가져와 리턴하게됨 (여기서 디버깅 해보면 rs.getTimestamp(columnName)값은 시분초까지 다 들어가 있음)</li><li>따라서 시간값이 없는 <code>yyyy-mm-dd</code> 형태로 리턴이 됨</li></ul><h3 id=1-2-오라클의-date형--javautildate-의-경우>1-2. <code>오라클의 DATE형</code> → <code>java.util.Date</code> 의 경우</h3><ul><li>mybatis에서는 자동적으로 <code>org.apache.ibatis.type.DateOnlyTypeHandler</code>를 호출하게됨 <a href=http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers target=_blank rel="noopener noreffer">mybatis 3 문서 참고</a></li><li>해당 핸들러의 내부 데이터 변환 코드는 다음과 같음</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=nf>getNullableResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w>  </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>java</span><span class=p>.</span><span class=na>sql</span><span class=p>.</span><span class=na>Date</span><span class=w> </span><span class=n>sqlDate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getDate</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sqlDate</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>Date</span><span class=p>(</span><span class=n>sqlDate</span><span class=p>.</span><span class=na>getTime</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>위의 <code>org.apache.ibatis.type.SqlDateTypeHandler</code> 변환코드에서 발생한 문제점과 같이 <code>yyyy-mm-dd</code> 만 가져와서 java.sql.Date 객체를 만들고, 이 정보를 토대로 java.util.Date 객체를 만들게 되는데 앞서 시간값을 뺀 정보로 만들어졌기 때문에 결국 동일하게 <code>yyyy-mm-dd</code> 형태로 리턴이 됨</li></ul><h2 id=2-삽질완료-해결의-시작>2. 삽질완료, 해결의 시작</h2><ul><li>오라클 + mybatis 환경에서 Date타입을 다루기 위해서는 타입핸들러를 명시적으로 만들어줘야 한다는걸 알게됨.</li></ul><h4 id=2-1-오라클의-date형--javasqldate-의-경우>2-1. <code>오라클의 DATE형</code> → <code>java.sql.Date</code> 의 경우</h4><ul><li>아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.</li><li>mybatis-config.xml</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;typeHandlers&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;typeHandler</span> <span class=na>handler=</span><span class=s>&#34;com.naver.dbill.admin.common.handler.CustomDateHandler&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/typeHandlers&gt;</span>
</span></span></code></pre></div><ul><li>CustomDateHandler.java</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.sql.Date</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CustomDateHandler</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>BaseTypeHandler</span><span class=o>&lt;</span><span class=n>Date</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>public</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=nf>getNullableResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>Timestamp</span><span class=w> </span><span class=n>sqlTimestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sqlTimestamp</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>(</span><span class=n>sqlTimestamp</span><span class=p>.</span><span class=na>getTime</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>위 코드를 작성하고 실행해보면 정상적으로 시분초 값이 있는 완전한 Date 형태를 볼수 있다.</li></ul><h4 id=2-2-오라클의-date형--javautildate-의-경우>2-2. <code>오라클의 DATE형</code> → <code>java.util.Date</code> 의 경우</h4><ul><li>아래처럼 코드를 작성하여 커스텀 핸들러를 만들어 등록을 시켜준다.</li><li>단, <a href=http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers target=_blank rel="noopener noreffer">mybatis 3 문서</a>를 보면 <code>java.sql.Date</code> 와는 다르게 기본으로 설정된 typeHandler가 JDBC에 따라 3가지가 있다.</li><li>따라서 작성한 커스텀 핸들러를 적용하기 위해서는 명시적으로 <code>자바타입</code> 과 <code>JDBC타입</code> 을 적어줘야 정상적으로 오버라이딩이 되어 해당 핸들러를 사용하게 된다.</li><li>mybatis-config.xml</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;typeHandlers&gt;</span>
</span></span><span class=line><span class=cl>		<span class=nt>&lt;typeHandler</span> <span class=na>handler=</span><span class=s>&#34;com.naver.dbill.admin.common.handler.CustomDateHandler&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.util.Date&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;DATE&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/typeHandlers&gt;</span>
</span></span></code></pre></div><ul><li>CustomDateHandler.java 는 위와 동일하다. ( import java.util.Date; 사용으로 변경 )</li></ul><h3 id=삽질하며-알게된-보너스-지식>삽질하며 알게된 보너스 지식</h3><ul><li><code>java.sql.Date</code> 는 <code>java.util.Date</code> 을 상속받았다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Date</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>Date</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>검색을 하다보면 알수있겠지만 <code>java.sql.Date</code> 는 JDBC등을 이용해서 데이터베이스의 데이터를 사용하는데 적합하고, <code>java.util.Date</code> 은 보다 범용적인 날짜나 시각정보를 다룰때 적합하다고 한다.</li><li>toString 메소드의 리턴 Format 형태<ul><li><code>java.sql.Date</code> : yyyy-mm-dd</li><li><code>java.util.Date</code> : EEE MMM dd HH:mm:ss zzz yyyy</li></ul></li><li>mybatis 에서 형변환은 <a href=http://www.mybatis.org/mybatis-3/ko/configuration.html#typeHandlers target=_blank rel="noopener noreffer">mybatis 3 문서</a>에 나와있는 자바타입과 JDBC타입이 일치할 경우에 해당 타입 핸들러를 기본으로 사용하게 된다.</li></ul><h3 id=정상혁-님-조언---작성하신분->정상혁 님 조언 ( <a href=http://d2.naver.com/helloworld/645609 target=_blank rel="noopener noreffer">http://d2.naver.com/helloworld/645609</a> 작성하신분 )</h3><ul><li>Oracle의 JDBC 드라이버가 예상 밖으로 동작하네요. Oracle의 DATE 타입도 문서를 보니 시분초까지 저장하게 되어 있는데, Oracle JDBC 구현체가 DATE 타입의 철학을 오해한게 아닌가하는 생각도 듭니다.</li><li>참고로 java.sql.Date, java.sql.TimeStamp는 잘못된 설계라는 비판이 많습니다.</li><li>저도 Java의 날짜와 시간 API 라는 글에서 아래와 같이 적은 적이 있습니다.</li></ul><blockquote><p>java.sql.Date 클래스는 상위 클래스인 java.util.Date 클래스와 이름이 같다. 이 클래스를 두고 Java 플랫폼 설계자는 클래스 이름을 지으면서 깜빡 존 듯하다는 조롱까지 나왔다.[24]</p></blockquote><blockquote><p>그리고 이 클래스는 Comparable 인터페이스에 대한 정의를 클래스 선언에서 하지 않았기 때문에 Comparable과 관련된 Generics 선언을 복잡하게 만들었다.[25]</p></blockquote><blockquote><p>java.sql.TimeStamp 클래스는 java.util.Date 클래스에 나노초(nanosecond) 필드를 더한 클래스이다. 이 클래스는 equals() 선언의 대칭성을 어겼다. Date 타입과 TimeStamp 타입을 섞어 쓰면 a.equals(b)가 true라도 b.equals(a)는 false인 경우가 생길 수 있다.[26]</p></blockquote><ul><li>이런 이유 때문에 저는 가급적 Java8에 나온 ZonedDateTime 류를 모델객체에서는 쓰고 있기는합니다. 하지만 그 클래스도 JDBC 레벨에서 제대로 매핑을 안 해주는 경우가 있어서 converter, typeHandler류를 따로 만들어야합니다. 참고로 Spring JDBC에서는 아래와 같이 Converter를 만들어서 해결했습니다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ZonedDateTimeConverter</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Converter</span><span class=o>&lt;</span><span class=n>Timestamp</span><span class=p>,</span><span class=w> </span><span class=n>ZonedDateTime</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>ZonedDateTime</span><span class=w> </span><span class=nf>convert</span><span class=p>(</span><span class=n>Timestamp</span><span class=w> </span><span class=n>source</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>ZonedDateTime</span><span class=p>.</span><span class=na>ofInstant</span><span class=p>(</span><span class=n>source</span><span class=p>.</span><span class=na>toInstant</span><span class=p>(),</span><span class=w> </span><span class=n>ZoneId</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;UTC&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>java.sql.Date vs java.util.Date 둘 중에 선택한다면 모델 객체에서는 java.util.Date가 더 어울린다는 생각이 듭니다. 모델에 java.sql.Date가 있는 것은 Controller에서 SqlException이 있는 것 같은 비슷한 느낌이랄까요..^^;</li></ul><h2 id=마치며>마치며</h2><ul><li>삽질을 하더라도 가급적이면 영양가 있는 삽질이 되야 할것같다. (하루종일 이것 붙잡다가 업무를 못해버리는;;)</li><li>API문서, 블로그문서, 검색결과에 맹신하지말고 실제 소스까지 들어가봐서 확신을 갖자.</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2017-03-23</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-title="Oracle + Mybatis 환경에서의 Date 다루기" data-hashtags=mybatis,date,oracle,archives-2017><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-hashtag=mybatis><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-title="Oracle + Mybatis 환경에서의 Date 다루기"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-title="Oracle + Mybatis 환경에서의 Date 다루기"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-title="Oracle + Mybatis 환경에서의 Date 다루기" data-image=/images/oracle-mybatis-date/oracle_mybatis_date.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://taetaetae.github.io/2017/03/23/oracle-mybatis-date/ data-title="Oracle + Mybatis 환경에서의 Date 다루기" data-description><i class="fab fa-blogger fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/mybatis/>Mybatis</a>,&nbsp;<a href=/tags/date/>Date</a>,&nbsp;<a href=/tags/oracle/>Oracle</a>,&nbsp;<a href=/tags/archives-2017/>Archives-2017</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2017/03/12/spring-parameter/ class=prev rel=prev title="스프링환경에서의 파라미터 관련 정리"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>스프링환경에서의 파라미터 관련 정리</a>
<a href=/2017/04/04/mybatis-use-generated-keys/ class=next rel=next title="mybatis insert/update 쿼리실행후 결과 가져오기">mybatis insert/update 쿼리실행후 결과 가져오기<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.147.9">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2016 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://taetaetae.github.io/resume target=_blank>태태태</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:500},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"Comment",lightTheme:"github-light",repo:"taetaetae/blog-comment"}},lightgallery:!0}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-86432198-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-86432198-1" async></script></body></html>